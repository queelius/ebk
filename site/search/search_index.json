{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"ebk - eBook Library Manager","text":"<p>Welcome to the ebk documentation! ebk is a powerful eBook metadata management tool with SQLAlchemy + SQLite backend, comprehensive Python API, rich CLI, and AI-powered features.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>\ud83d\uddc4\ufe0f SQLAlchemy + SQLite Backend - Robust database with full-text search (FTS5)</li> <li>\ud83d\udcda Fluent Python API - Comprehensive programmatic interface with method chaining</li> <li>\ud83c\udfa8 Rich CLI - Beautiful terminal interface powered by Typer and Rich</li> <li>\ud83c\udf10 Web Server - FastAPI-based interface for browsing and managing your library</li> <li>\ud83e\udd16 AI-Powered Enrichment - Automatic metadata enhancement using LLMs</li> <li>\ud83d\udce5 Multiple Import Sources - Calibre, raw ebooks, batch imports</li> <li>\ud83d\udd0d Advanced Search - Full-text search with FTS5 indexing</li> <li>\ud83d\udce4 Flexible Export - Hugo sites, ZIP archives, JSON</li> <li>\ud83d\udd27 Configuration System - Centralized config at <code>~/.config/ebk/config.json</code></li> <li>\ud83c\udff7\ufe0f Personal Organization - Tags, ratings, reading status, notes</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>from pathlib import Path\nfrom ebk.library_db import Library\n\n# Open library\nlib = Library.open(Path(\"~/ebooks\"))\n\n# Fluent query interface\nrecent_python = (lib.query()\n    .filter_by_language(\"en\")\n    .filter_by_subject(\"Python\")\n    .order_by(\"publication_date\", desc=True)\n    .limit(20)\n    .all())\n\n# Full-text search\nresults = lib.search(\"machine learning algorithms\")\n\n# Update reading status\nlib.update_reading_status(book_id=42, status=\"reading\", rating=5)\n\nlib.close()\n</code></pre>"},{"location":"#new-in-latest-version","title":"New in Latest Version","text":""},{"location":"#configuration-system","title":"Configuration System","text":"<p>Centralized configuration at <code>~/.config/ebk/config.json</code>:</p> <pre><code># Initialize configuration\nebk config init\n\n# Set defaults\nebk config set library.default_path ~/my-ebooks\nebk config set server.port 8000\nebk config set llm.model llama3.2\n</code></pre>"},{"location":"#llm-powered-features","title":"LLM-Powered Features","text":"<p>Enrich your library metadata using AI:</p> <pre><code># Setup Ollama\nollama pull llama3.2\n\n# Configure ebk\nebk config set llm.provider ollama\nebk config set llm.model llama3.2\n\n# Enrich metadata\nebk enrich ~/library --generate-tags --categorize\n</code></pre>"},{"location":"#web-server","title":"Web Server","text":"<p>Browse your library with a modern web interface:</p> <pre><code># Start server\nebk serve ~/library\n\n# Or with auto-open\nebk config set server.auto_open_browser true\nebk serve ~/library\n</code></pre>"},{"location":"#getting-started","title":"Getting Started","text":"<ul> <li>Installation - Install ebk and optional features</li> <li>Quick Start - Get up and running in minutes</li> <li>CLI Reference - Complete command reference</li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<p>ebk follows a clean, modular architecture:</p> <pre><code>graph TD\n    A[Core Library&lt;br/&gt;ebk.library] --&gt; B[CLI&lt;br/&gt;ebk.cli]\n    A --&gt; C[Import/Export&lt;br/&gt;Modules]\n    A --&gt; D[Integrations&lt;br/&gt;Optional]\n    D --&gt; E[Streamlit&lt;br/&gt;Web UI]\n    D --&gt; F[MCP Server&lt;br/&gt;AI Assistants]\n    D --&gt; G[Visualizations&lt;br/&gt;Network Graphs]</code></pre>"},{"location":"#support","title":"Support","text":"<ul> <li>\ud83d\udc1b Report Issues</li> <li>\ud83d\udcac Discussions</li> <li>\ud83d\udce7 Contact</li> </ul>"},{"location":"API_GUIDE/","title":"ebk Fluent API Guide","text":"<p>The ebk library provides a comprehensive, fluent API for programmatic ebook library management.</p>"},{"location":"API_GUIDE/#quick-start","title":"Quick Start","text":"<pre><code>from ebk import Library\n\n# Open or create a library\nlib = Library.open(\"/path/to/library\")\n# or\nlib = Library.create(\"/path/to/new/library\")\n\n# Add books\nlib.add_entry(\n    title=\"The Python Book\",\n    creators=[\"John Doe\", \"Jane Smith\"],\n    subjects=[\"Programming\", \"Python\"],\n    language=\"en\",\n    date=\"2023-01-15\"\n).save()\n\n# Search and query\npython_books = lib.search(\"Python\")\nrecent_books = lib.query().where(\"date\", \"2023\", \"&gt;=\").execute()\n</code></pre>"},{"location":"API_GUIDE/#core-concepts","title":"Core Concepts","text":""},{"location":"API_GUIDE/#library","title":"Library","text":"<p>The <code>Library</code> class is the main entry point for all operations:</p> <pre><code>from ebk import Library\n\n# Create from different sources\nlib = Library.create(\"/path/to/library\")\nlib = Library.from_calibre(\"/calibre/library\", \"/output/path\")\nlib = Library.from_ebooks(\"/ebooks/folder\", \"/output/path\")\n\n# Basic operations\nprint(f\"Library has {len(lib)} entries\")\n\n# Iterate over entries\nfor entry in lib:\n    print(f\"{entry.title} by {', '.join(entry.creators)}\")\n</code></pre>"},{"location":"API_GUIDE/#entry","title":"Entry","text":"<p>Individual books are represented as <code>Entry</code> objects with fluent methods:</p> <pre><code># Get an entry\nentry = lib[0]  # By index\nentry = lib.find(\"unique-id-here\")  # By ID\n\n# Access properties\nprint(entry.title)\nprint(entry.creators)\nprint(entry.subjects)\n\n# Modify with chaining\nentry.set(\"publisher\", \"Tech Press\") \\\n     .add_creator(\"Co Author\") \\\n     .add_subject(\"Advanced Topics\") \\\n     .save()\n\n# Update multiple fields\nentry.update(\n    edition=\"2nd\",\n    pages=450,\n    isbn=\"978-1234567890\"\n)\n</code></pre>"},{"location":"API_GUIDE/#querybuilder","title":"QueryBuilder","text":"<p>The query builder provides powerful, chainable search capabilities:</p> <pre><code># Simple queries\nenglish_books = lib.query().where(\"language\", \"en\").execute()\n\n# Complex queries with operators\nresults = (lib.query()\n    .where(\"language\", \"en\")\n    .where(\"date\", \"2020\", \"&gt;=\")\n    .where(\"subjects\", \"Python\", \"contains\")\n    .order_by(\"title\")\n    .take(10)\n    .execute())\n\n# Custom filters\nresults = lib.query().where_lambda(\n    lambda e: len(e.get(\"creators\", [])) &gt; 1 and e.get(\"pages\", 0) &gt; 300\n).execute()\n\n# Search across multiple fields\nresults = lib.query().where_any(\n    [\"title\", \"description\", \"subjects\"], \n    \"machine learning\"\n).execute()\n\n# Count and existence\ncount = lib.query().where(\"language\", \"en\").count()\nhas_french = lib.query().where(\"language\", \"fr\").exists()\nfirst_match = lib.query().where(\"publisher\", \"O'Reilly\").first()\n</code></pre>"},{"location":"API_GUIDE/#common-operations","title":"Common Operations","text":""},{"location":"API_GUIDE/#adding-books","title":"Adding Books","text":"<pre><code># Single entry\nentry = lib.add_entry(\n    title=\"Deep Learning\",\n    creators=[\"Ian Goodfellow\", \"Yoshua Bengio\"],\n    subjects=[\"AI\", \"Machine Learning\", \"Neural Networks\"],\n    language=\"en\",\n    date=\"2016-11-18\",\n    isbn=\"9780262035613\",\n    publisher=\"MIT Press\"\n)\n\n# Multiple entries\nentries = [\n    {\"title\": \"Book 1\", \"creators\": [\"Author 1\"]},\n    {\"title\": \"Book 2\", \"creators\": [\"Author 2\"]}\n]\nlib.add_entries(entries).save()\n\n# From files (requires actual file handling)\nentry = lib.add_entry(\n    title=\"My Book\",\n    creators=[\"Me\"],\n    file_paths=[\"book.pdf\", \"book.epub\"],\n    cover_path=\"cover.jpg\"\n)\n</code></pre>"},{"location":"API_GUIDE/#searching-and-filtering","title":"Searching and Filtering","text":"<pre><code># Simple text search\nresults = lib.search(\"Python\")\nresults = lib.search(\"Doe\", fields=[\"creators\"])\n\n# Find specific entries\nbooks = lib.find_by_title(\"Python Programming\")\nentry = lib.find(\"unique-id-123\")\n\n# Filter with predicates\nfiltered = lib.filter(lambda e: e.get(\"year\", 0) &gt; 2020)\npython_books = lib.filter(lambda e: \"Python\" in e.get(\"subjects\", []))\n\n# Query builder for complex searches\nquery = (lib.query()\n    .where(\"language\", \"en\")\n    .where(\"subjects\", \"Programming\", \"contains\")\n    .where_lambda(lambda e: e.get(\"pages\", 0) &gt; 200)\n    .order_by(\"date\", descending=True))\n\nresults = query.execute()\ncount = query.count()\nfirst = query.first()\n</code></pre>"},{"location":"API_GUIDE/#modifying-entries","title":"Modifying Entries","text":"<pre><code># Update single entry\nentry = lib.find(\"some-id\")\nentry.title = \"Updated Title\"\nentry.add_creator(\"New Author\")\nentry.add_subject(\"New Topic\")\nentry.save()\n\n# Update multiple entries\nlib.update_all(lambda e: e.set(\"reviewed\", True))\nlib.update_all(lambda e: e.add_subject(\"ebook\") if e.get(\"format\") == \"pdf\" else None)\n\n# Batch tagging\nlib.tag_all(\"to-read\")\nlib.filter(lambda e: e.get(\"year\") == \"2023\").tag_all(\"recent\")\n\n# Remove entries\nlib.remove(\"unique-id\")\nlib.remove_where(lambda e: e.get(\"language\") == \"unknown\")\n</code></pre>"},{"location":"API_GUIDE/#batch-operations","title":"Batch Operations","text":"<pre><code># Queue multiple operations\n(lib.batch()\n    .add_entry(title=\"Book 1\", creators=[\"Author 1\"])\n    .add_entry(title=\"Book 2\", creators=[\"Author 2\"])\n    .update(\"some-id\", publisher=\"New Publisher\")\n    .remove(\"old-id\")\n    .execute())\n</code></pre>"},{"location":"API_GUIDE/#transactions","title":"Transactions","text":"<pre><code># Automatic rollback on error\ntry:\n    with lib.transaction() as txn_lib:\n        txn_lib.add_entry(title=\"Book 1\", creators=[\"Author\"])\n        txn_lib.remove(\"some-id\")\n        # If error occurs here, all changes are rolled back\n        raise Exception(\"Something went wrong\")\nexcept:\n    # Library remains unchanged\n    pass\n</code></pre>"},{"location":"API_GUIDE/#advanced-features","title":"Advanced Features","text":""},{"location":"API_GUIDE/#merging-libraries","title":"Merging Libraries","text":"<pre><code>lib1 = Library.open(\"/library1\")\nlib2 = Library.open(\"/library2\")\n\n# Different merge operations\nmerged = lib1.union(lib2)        # All unique entries\nmerged = lib1.intersect(lib2)    # Common entries only\nmerged = lib1.difference(lib2)   # In lib1 but not lib2\n\n# Generic merge\nmerged = lib1.merge(lib2, operation=\"symdiff\")\n</code></pre>"},{"location":"API_GUIDE/#statistics-and-analysis","title":"Statistics and Analysis","text":"<pre><code># Get library statistics\nstats = lib.stats()\nprint(f\"Total books: {stats['total_entries']}\")\nprint(f\"Languages: {stats['languages']}\")\nprint(f\"Top authors: {list(stats['creators'].items())[:5]}\")\nprint(f\"Popular subjects: {list(stats['subjects'].items())[:10]}\")\n\n# Group entries\nby_language = lib.group_by(\"language\")\nby_year = lib.group_by(\"year\")\nby_author = lib.group_by(\"creators\")\n\n# Find duplicates\nduplicate_titles = lib.duplicates(by=\"title\")\nfor title, entries in duplicate_titles:\n    print(f\"'{title}' has {len(entries)} copies\")\n</code></pre>"},{"location":"API_GUIDE/#exporting","title":"Exporting","text":"<pre><code># Export to different formats\nlib.export_to_zip(\"/path/to/library.zip\")\n\nlib.export_to_hugo(\n    \"/path/to/hugo/site\",\n    organize_by=\"year\"  # or \"language\", \"subject\", \"creator\", \"flat\"\n)\n\n# Export as navigable symlink DAG\nlib.export_to_symlink_dag(\n    \"/path/to/dag\",\n    tag_field=\"subjects\",    # Field to use for hierarchy\n    include_files=True,      # Copy actual ebook files\n    create_index=True        # Generate HTML indexes\n)\n\n# Export as graph (co-authorship or subject networks)\nlib.export_graph(\n    \"library.graphml\",       # Supports .graphml, .gexf, .json\n    graph_type=\"coauthor\",   # or \"subject\"\n    min_connections=2        # Filter edges with fewer connections\n)\n\n# Chain operations before export\n(lib.filter(lambda e: e.get(\"language\") == \"en\")\n    .tag_all(\"english\")\n    .export_to_hugo(\"/hugo/site\", organize_by=\"subject\"))\n</code></pre>"},{"location":"API_GUIDE/#jmespath-queries","title":"JMESPath Queries","text":"<pre><code># Use JMESPath for complex queries\nresults = lib.query().jmespath(\n    \"[?language=='en' &amp;&amp; contains(subjects, 'Python')]\"\n).execute()\n\nresults = lib.query().jmespath(\n    \"[?year &gt; `2020`].{title: title, authors: creators}\"\n).execute()\n</code></pre>"},{"location":"API_GUIDE/#finding-similar-books-and-recommendations","title":"Finding Similar Books and Recommendations","text":"<pre><code># Find books similar to a specific entry\nsimilar = lib.find_similar(\"book_unique_id\", threshold=0.7)\n# or by Entry object\nentry = lib.find(\"book_unique_id\")\nsimilar = lib.find_similar(entry, threshold=0.5)\n\n# Get recommendations\n# Random from highly-rated or popular books\nrecommended = lib.recommend(limit=10)\n\n# Based on specific books (collaborative filtering style)\nrecommended = lib.recommend(\n    based_on=[\"book_id_1\", \"book_id_2\", \"book_id_3\"],\n    limit=20\n)\n\n# Analyze reading patterns\nanalysis = lib.analyze_reading_patterns()\nprint(f\"Subject diversity (entropy): {analysis['reading_diversity']['subject_entropy']}\")\nprint(f\"Top genres: {analysis['reading_diversity']['subject_concentration']}\")\nprint(f\"Books per author: {analysis['reading_diversity']['books_per_author']}\")\n</code></pre>"},{"location":"API_GUIDE/#real-world-examples","title":"Real-World Examples","text":""},{"location":"API_GUIDE/#symlink-dag-navigation","title":"Symlink DAG Navigation","text":"<pre><code># Create a browsable view of your library organized by hierarchical tags\nlib = Library.open(\"/my/ebook-library\")\n\n# Basic export with subject hierarchy\nlib.export_to_symlink_dag(\"/my/browsable-library\")\n\n# Organize by authors instead of subjects\nlib.export_to_symlink_dag(\n    \"/my/author-organized-library\",\n    tag_field=\"creators\"\n)\n\n# Filter and export only programming books\n(lib.filter(lambda e: \"Programming\" in e.get(\"subjects\", []))\n    .export_to_symlink_dag(\"/my/programming-books\"))\n</code></pre> <p>This creates a structure like: <pre><code>Programming/\n  Python/\n    Web/\n      Django Web Development \u2192 ../../../_books/book_123\n    Machine Learning/\n      ML with Python \u2192 ../../../_books/book_456\n</code></pre></p>"},{"location":"API_GUIDE/#building-a-reading-list","title":"Building a Reading List","text":"<pre><code># Create a reading list from multiple criteria\nreading_list = Library.create(\"/my/reading-list\")\n\n# Add highly rated Python books from main library\npython_books = (main_lib.query()\n    .where(\"subjects\", \"Python\", \"contains\")\n    .where(\"rating\", 4, \"&gt;=\")\n    .execute())\n\nreading_list.add_entries(python_books)\n\n# Add recent AI books\nai_books = (main_lib.query()\n    .where(\"subjects\", \"Artificial Intelligence\", \"contains\")\n    .where(\"year\", \"2022\", \"&gt;=\")\n    .execute())\n\nreading_list.add_entries(ai_books)\n\n# Tag and export\nreading_list.tag_all(\"to-read\") \\\n           .export_to_hugo(\"/my/website\", organize_by=\"subject\")\n</code></pre>"},{"location":"API_GUIDE/#library-maintenance","title":"Library Maintenance","text":"<pre><code># Clean up library\nlib = Library.open(\"/my/library\")\n\n# Remove entries without files\nlib.remove_where(lambda e: not e.get(\"file_paths\"))\n\n# Fix common issues\nlib.update_all(lambda e: \n    e.set(\"language\", \"en\") if not e.get(\"language\") else None\n)\n\n# Normalize subjects\ndef normalize_subjects(entry):\n    subjects = entry.get(\"subjects\", [])\n    normalized = []\n    for subject in subjects:\n        # Normalize case and spacing\n        normalized.append(subject.strip().title())\n    entry.subjects = normalized\n\nlib.update_all(normalize_subjects)\n\n# Find and handle duplicates\nfor title, duplicates in lib.duplicates(by=\"title\"):\n    print(f\"\\nFound {len(duplicates)} copies of '{title}':\")\n    for i, dup in enumerate(duplicates):\n        print(f\"  {i+1}. ID: {dup.id}, Authors: {dup.creators}\")\n    # Optionally remove duplicates keeping the first\n    for dup in duplicates[1:]:\n        lib.remove(dup.id)\n\nlib.save()\n</code></pre>"},{"location":"API_GUIDE/#creating-a-catalog-website","title":"Creating a Catalog Website","text":"<pre><code># Generate a website with books organized by multiple criteria\nlib = Library.open(\"/my/library\")\n\n# Create different views\nbase_path = Path(\"/my/hugo-site\")\n\n# By year for recent additions\n(lib.filter(lambda e: e.get(\"year\", 0) &gt;= 2020)\n    .export_to_hugo(base_path / \"recent\", organize_by=\"year\"))\n\n# By language\nlib.export_to_hugo(base_path / \"languages\", organize_by=\"language\")\n\n# By subject for browsing\nlib.export_to_hugo(base_path / \"subjects\", organize_by=\"subject\")\n\n# Featured collection\nfeatured = lib.filter(lambda e: \n    e.get(\"rating\", 0) &gt;= 4.5 or \"Award Winner\" in e.get(\"subjects\", [])\n)\nfeatured.export_to_hugo(base_path / \"featured\", organize_by=\"flat\")\n</code></pre>"},{"location":"API_GUIDE/#best-practices","title":"Best Practices","text":"<ol> <li>Always save changes: Use <code>.save()</code> after modifications</li> <li>Use transactions for multi-step operations that should be atomic</li> <li>Chain operations for cleaner code</li> <li>Filter before export to create focused collections</li> <li>Use batch operations for better performance with many changes</li> <li>Handle missing fields with <code>.get()</code> and defaults</li> <li>Use symlink DAG for filesystem-based navigation of tag hierarchies</li> <li>Leverage similarity for discovery and recommendations</li> </ol>"},{"location":"API_GUIDE/#performance-tips","title":"Performance Tips","text":"<ul> <li>Use <code>query()</code> for read-only operations (doesn't modify library)</li> <li>Use <code>filter()</code> when you need a new library instance</li> <li>Batch operations are more efficient than individual updates</li> <li>For large libraries, use <code>.take()</code> and <code>.skip()</code> for pagination</li> <li>JMESPath queries can be faster for complex conditions</li> </ul>"},{"location":"piping-implementation-summary/","title":"Piping Implementation Summary","text":""},{"location":"piping-implementation-summary/#overview","title":"Overview","text":"<p>Successfully implemented Unix-like piping and text processing utilities for the ebk shell. Users can now chain commands together to perform complex operations on their ebook library.</p>"},{"location":"piping-implementation-summary/#what-was-implemented","title":"What Was Implemented","text":""},{"location":"piping-implementation-summary/#1-pipeline-infrastructure-ebkreplshellpy","title":"1. Pipeline Infrastructure (<code>ebk/repl/shell.py</code>)","text":"<p>Pipeline Class - Handles parsing and execution of piped commands: - Splits command line on <code>|</code> separator - Executes commands sequentially - Passes stdout from one command as stdin to the next - Stops execution if any command fails</p> <p>execute_command Method - New method for pipeline execution: - Takes command name, args, and optional stdin - Returns command output as string - Enables commands to be called from pipelines</p> <p>Modified execute Method - Detects pipes and routes to pipeline: <pre><code>if \"|\" in line:\n    pipeline = Pipeline(line)\n    output = pipeline.execute(self)\n    if output:\n        self.console.print(output)\n</code></pre></p>"},{"location":"piping-implementation-summary/#2-text-utility-commands-ebkrepltext_utilspy","title":"2. Text Utility Commands (<code>ebk/repl/text_utils.py</code>)","text":"<p>Six new text processing utilities following Unix conventions:</p> <p>head - Show first N lines (default: 10) <pre><code>head [-n NUM] [file]\ncat text | head -20\n</code></pre></p> <p>tail - Show last N lines (default: 10) <pre><code>tail [-n NUM] [file]\ncat text | tail -20\n</code></pre></p> <p>wc - Count lines, words, characters <pre><code>wc [-l|-w|-c] [file]\nfind author:Knuth | wc -l\n</code></pre></p> <p>sort - Sort lines alphabetically <pre><code>sort [-r] [file]\ncat authors | sort\n</code></pre></p> <p>uniq - Remove duplicate adjacent lines <pre><code>uniq [-c] [file]\ncat subjects | sort | uniq -c\n</code></pre></p> <p>more - Paginate output with Rich pager <pre><code>more [file]\ncat text | more\n</code></pre></p>"},{"location":"piping-implementation-summary/#3-updated-commands-for-piping","title":"3. Updated Commands for Piping","text":"<p>All existing commands now support the dual-mode interface:</p> <p>Signature Pattern: <pre><code>def cmd_name(self, args: List[str], stdin: Optional[str] = None) -&gt; Optional[str]:\n</code></pre></p> <p>Commands Updated: - <code>cat</code> - Returns content, passes through stdin - <code>grep</code> - Searches stdin when provided, returns matches - <code>find</code> - Returns tab-separated book info - <code>ls</code> - Returns tab-separated directory listing - <code>pwd</code> - Returns current path - <code>cd</code>, <code>help</code>, <code>exit</code>, <code>quit</code> - Accept stdin parameter (mostly ignored)</p> <p>Text utility commands - All support both file and stdin input: - <code>head</code>, <code>tail</code>, <code>wc</code>, <code>sort</code>, <code>uniq</code>, <code>more</code></p>"},{"location":"piping-implementation-summary/#usage-examples","title":"Usage Examples","text":""},{"location":"piping-implementation-summary/#basic-piping","title":"Basic Piping","text":"<pre><code># Preview file\nebk:/books/42 $ cat text | head -20\n\n# Count lines\nebk:/books/42 $ cat text | wc -l\n\n# Paginate output\nebk:/books/42 $ cat text | more\n\n# Count search results\nebk:/ $ find author:Knuth | wc -l\n</code></pre>"},{"location":"piping-implementation-summary/#complex-workflows","title":"Complex Workflows","text":"<pre><code># Find unique subjects, sorted\nebk:/ $ cat /books/*/subjects | sort | uniq\n\n# Count occurrences of each subject\nebk:/ $ cat /books/*/subjects | sort | uniq -c | sort -r\n\n# Find and filter\nebk:/ $ find subject:python | grep -i machine | head -10\n\n# Search and count\nebk:/books/42 $ cat text | grep algorithm | wc -l\n\n# Most common words (requires external commands in pipeline)\nebk:/books/42 $ cat text | grep -o '\\w\\+' | sort | uniq -c | sort -rn | head -20\n</code></pre>"},{"location":"piping-implementation-summary/#chaining-multiple-commands","title":"Chaining Multiple Commands","text":"<pre><code># Three-stage pipeline\nebk:/books/42 $ cat text | grep \"theorem\" | head -50 | more\n\n# Find, filter, count\nebk:/ $ find author:Knuth | grep \"Art\" | wc -l\n\n# Complex text analysis\nebk:/books/42 $ cat text | grep -i \"machine learning\" | sort | uniq | wc -l\n</code></pre>"},{"location":"piping-implementation-summary/#architecture","title":"Architecture","text":""},{"location":"piping-implementation-summary/#pipeline-execution-flow","title":"Pipeline Execution Flow","text":"<pre><code>Input: \"cat text | grep python | head -20\"\n\n1. Parse: Split on '|'\n   \u2192 [\"cat text\", \"grep python\", \"head -20\"]\n\n2. Execute first command:\n   cmd: cat text\n   stdin: None\n   stdout: \"Chapter 1\\nIntro to Python\\n...\"\n\n3. Execute second command:\n   cmd: grep python\n   stdin: \"Chapter 1\\nIntro to Python\\n...\"\n   stdout: \"Intro to Python\\nPython is...\\n...\"\n\n4. Execute third command:\n   cmd: head -20\n   stdin: \"Intro to Python\\nPython is...\\n...\"\n   stdout: (first 20 lines)\n\n5. Display final output to console\n</code></pre>"},{"location":"piping-implementation-summary/#command-interface-design","title":"Command Interface Design","text":"<p>Commands follow a dual-mode pattern:</p> <pre><code>def cmd_grep(self, args: List[str], stdin: Optional[str] = None) -&gt; Optional[str]:\n    if stdin:\n        # Pipeline mode: process stdin\n        return grep_on_string(pattern, stdin)\n    else:\n        # Standalone mode: read from VFS files\n        return grep_on_files(pattern, paths)\n</code></pre> <p>This allows commands to work both: - Standalone: <code>grep pattern file1 file2</code> - In pipelines: <code>cat file | grep pattern</code></p>"},{"location":"piping-implementation-summary/#implementation-stats","title":"Implementation Stats","text":"<ul> <li>Total lines added: ~500 lines</li> <li>New files: 1 (<code>ebk/repl/text_utils.py</code>)</li> <li>Modified files: 1 (<code>ebk/repl/shell.py</code>)</li> <li>New commands: 6 (head, tail, wc, sort, uniq, more)</li> <li>Commands updated for piping: 8 (cat, grep, find, ls, pwd, cd, help, exit/quit)</li> </ul>"},{"location":"piping-implementation-summary/#design-decisions","title":"Design Decisions","text":""},{"location":"piping-implementation-summary/#what-we-implemented","title":"What We Implemented","text":"<p>\u2705 Basic piping with <code>|</code> operator \u2705 6 essential text utilities \u2705 String-based stdin/stdout \u2705 Synchronous execution \u2705 Error propagation in pipelines</p>"},{"location":"piping-implementation-summary/#what-we-explicitly-did-not-implement","title":"What We Explicitly Did NOT Implement","text":"<p>\u274c Redirection (<code>&gt;</code>, <code>&gt;&gt;</code>, <code>&lt;</code>) - VFS is read-only \u274c Job control (<code>&amp;</code>, <code>fg</code>, <code>bg</code>) - No background jobs \u274c Scripting (variables, loops, functions) - Use Python API instead \u274c Subshells, command substitution - Too complex \u274c Binary data handling - Text-only is sufficient \u274c Advanced sorting options (<code>sort -n</code>, <code>-k</code>) - Diminishing returns \u274c Advanced grep context (<code>-A</code>, <code>-B</code>, <code>-C</code>) - Already complex enough</p>"},{"location":"piping-implementation-summary/#rationale","title":"Rationale","text":"<ul> <li>Bounded scope: 80% value for 20% effort</li> <li>Maintainability: Simple code, simple tests</li> <li>Focus: Enhanced library browsing, not general shell</li> <li>Composability: Commands chain naturally via text streams</li> </ul>"},{"location":"piping-implementation-summary/#error-handling","title":"Error Handling","text":""},{"location":"piping-implementation-summary/#pipeline-errors","title":"Pipeline Errors","text":"<ul> <li>If any command in pipeline fails, execution stops immediately</li> <li>Error from failing command is displayed</li> <li>Remaining commands are not executed</li> </ul> <p>Example: <pre><code>ebk:/ $ cat nonexistent | grep foo\ncat: nonexistent: No such file or directory\n# (grep never executes)\n</code></pre></p>"},{"location":"piping-implementation-summary/#command-errors","title":"Command Errors","text":"<ul> <li>Invalid flags: Show usage message</li> <li>Missing arguments: Show usage message</li> <li>File not found: Show error, return None</li> <li>Stdin required but not provided: Show error</li> </ul>"},{"location":"piping-implementation-summary/#testing","title":"Testing","text":""},{"location":"piping-implementation-summary/#manual-testing-completed","title":"Manual Testing Completed","text":"<p>\u2705 Text utilities work standalone \u2705 Text utilities work with simulated piping \u2705 All utility flags work correctly \u2705 Edge cases handled (empty input, no matches)</p>"},{"location":"piping-implementation-summary/#tests-still-needed","title":"Tests Still Needed","text":"<ul> <li>Unit tests for Pipeline class</li> <li>Unit tests for each text utility</li> <li>Integration tests for command piping</li> <li>Edge case tests (empty stdin, very long lines, Unicode)</li> <li>Performance tests for large files</li> </ul>"},{"location":"piping-implementation-summary/#next-steps","title":"Next Steps","text":"<ol> <li>Add comprehensive test suite</li> <li>Unit tests for text_utils.py</li> <li>Integration tests for piping</li> <li> <p>Edge case coverage</p> </li> <li> <p>User testing</p> </li> <li>Test with real library</li> <li>Gather feedback on UX</li> <li> <p>Identify missing features</p> </li> <li> <p>Documentation updates</p> </li> <li>Update README with piping examples</li> <li>Add tutorial for complex workflows</li> <li> <p>Document pipeline behavior</p> </li> <li> <p>Potential enhancements (if needed)</p> </li> <li>Add more text utilities (cut, paste, tr)</li> <li>Optimize for very large files</li> <li>Add progress indicators for long pipelines</li> </ol>"},{"location":"piping-implementation-summary/#conclusion","title":"Conclusion","text":"<p>The piping implementation provides a powerful, Unix-like interface for exploring ebook libraries. Users can now compose complex queries by chaining simple commands together. The implementation is clean, maintainable, and stays within the project's scope.</p> <p>Key Achievement: Professional shell experience with ~500 lines of code, following Unix philosophy of composable tools.</p>"},{"location":"shell-piping-design/","title":"Shell Piping and Text Utilities - Design Document","text":""},{"location":"shell-piping-design/#motivation","title":"Motivation","text":"<p>The ebk shell provides a Unix-like interface for navigating the ebook library through a Virtual File System (VFS). However, without piping and basic text utilities, users cannot compose commands to explore their library effectively.</p>"},{"location":"shell-piping-design/#problem","title":"Problem","text":"<p>Current limitations: <pre><code># \u274c Cannot paginate large outputs\nebk:/books/42 $ cat text\n# (outputs 10,000 lines with no way to page)\n\n# \u274c Cannot count results\nebk:/ $ find author:Knuth\n# (displays results but no count)\n\n# \u274c Cannot preview files\nebk:/books/42 $ cat description\n# (shows full text, can't see just first 10 lines)\n\n# \u274c Cannot chain operations\nebk:/ $ find subject:python\n# (can't pipe to grep to filter further)\n</code></pre></p>"},{"location":"shell-piping-design/#solution","title":"Solution","text":"<p>Implement a minimal but powerful set of text utilities and piping:</p> <p>Text Utilities: - <code>head</code> - Show first N lines - <code>tail</code> - Show last N lines - <code>wc</code> - Count lines, words, characters - <code>sort</code> - Sort lines alphabetically - <code>uniq</code> - Remove duplicate lines - <code>more</code> - Paginate output</p> <p>Piping: - <code>cmd1 | cmd2 | cmd3</code> - Chain commands via stdout \u2192 stdin</p> <p>After implementation: <pre><code># \u2705 Paginate large files\nebk:/books/42 $ cat text | more\n\n# \u2705 Count results\nebk:/ $ find author:Knuth | wc -l\n5 books found\n\n# \u2705 Preview files\nebk:/books/42 $ cat description | head -10\n\n# \u2705 Chain operations\nebk:/ $ find subject:python | grep -i \"machine\" | wc -l\n\n# \u2705 Complex queries\nebk:/ $ cat text | grep \"theorem\" | sort | uniq | head -20\n</code></pre></p>"},{"location":"shell-piping-design/#design-principles","title":"Design Principles","text":""},{"location":"shell-piping-design/#1-unix-philosophy","title":"1. Unix Philosophy","text":"<ul> <li>Do one thing well - Each utility has a single, clear purpose</li> <li>Text as universal interface - Everything is text streams</li> <li>Composability - Commands chain naturally via pipes</li> </ul>"},{"location":"shell-piping-design/#2-bounded-scope","title":"2. Bounded Scope","text":"<p>What we implement: - Piping (<code>|</code>) for command chaining - 6 essential text utilities - String-based stdin/stdout</p> <p>What we explicitly DON'T implement: - Redirection (<code>&gt;</code>, <code>&gt;&gt;</code>, <code>&lt;</code>) - VFS is read-only, use <code>!bash</code> if needed - Job control (<code>&amp;</code>, <code>fg</code>, <code>bg</code>) - No background jobs needed - Scripting (variables, loops, functions) - Use Python API instead - Subshells, command substitution - Too complex - Binary data handling - Text-only is sufficient</p>"},{"location":"shell-piping-design/#3-simplicity-over-completeness","title":"3. Simplicity Over Completeness","text":"<ul> <li>Implement core flags only (e.g., <code>head -n</code>, not <code>head -c</code>)</li> <li>String processing, not byte processing</li> <li>Synchronous execution, no concurrency</li> <li>Clear error messages over POSIX compliance</li> </ul>"},{"location":"shell-piping-design/#4-familiar-ux","title":"4. Familiar UX","text":"<ul> <li>Match common Unix behavior where possible</li> <li>Use standard flag names (<code>-n</code>, <code>-r</code>, <code>-l</code>)</li> <li>Sensible defaults (head defaults to 10 lines)</li> </ul>"},{"location":"shell-piping-design/#architecture","title":"Architecture","text":""},{"location":"shell-piping-design/#component-overview","title":"Component Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  LibraryShell                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502           Command Executor                    \u2502 \u2502\n\u2502  \u2502  \u2022 Parse command line                         \u2502 \u2502\n\u2502  \u2502  \u2022 Detect pipes (|)                           \u2502 \u2502\n\u2502  \u2502  \u2022 Route to pipeline or single execution     \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502           \u2502                         \u2502               \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502    \u2502  Pipeline   \u2502         \u2502 Single Command \u2502     \u2502\n\u2502    \u2502  Executor   \u2502         \u2502   Executor     \u2502     \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502           \u2502                                         \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502    \u2502      Text Utilities Module          \u2502        \u2502\n\u2502    \u2502  \u2022 head, tail, wc, sort, uniq, more \u2502        \u2502\n\u2502    \u2502  \u2022 stdin/stdout interface           \u2502        \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"shell-piping-design/#pipeline-execution-flow","title":"Pipeline Execution Flow","text":"<pre><code>Input: \"cat text | grep python | head -20\"\n\n1. Parse: Split on '|'\n   \u2192 [\"cat text\", \"grep python\", \"head -20\"]\n\n2. Execute first command:\n   cmd: cat text\n   stdin: None\n   stdout: \"Chapter 1\\nIntro to Python\\n...\"\n\n3. Execute second command:\n   cmd: grep python\n   stdin: \"Chapter 1\\nIntro to Python\\n...\"\n   stdout: \"Intro to Python\\nPython is...\\n...\"\n\n4. Execute third command:\n   cmd: head -20\n   stdin: \"Intro to Python\\nPython is...\\n...\"\n   stdout: (first 20 lines)\n\n5. Display final output to console\n</code></pre>"},{"location":"shell-piping-design/#command-interface","title":"Command Interface","text":"<p>All commands must support dual-mode execution:</p> <pre><code>def cmd_grep(self, args: List[str], stdin: Optional[str] = None) -&gt; str:\n    \"\"\"Execute grep with optional stdin.\n\n    Args:\n        args: Command arguments (e.g., [\"-i\", \"pattern\", \"file\"])\n        stdin: Optional input from previous command in pipeline\n\n    Returns:\n        Command output as string\n    \"\"\"\n    if stdin:\n        # Process stdin (pipeline mode)\n        return self._grep_string(pattern, stdin, flags)\n    else:\n        # Process VFS files (standalone mode)\n        return self._grep_files(pattern, paths, flags)\n</code></pre>"},{"location":"shell-piping-design/#text-utilities-specification","title":"Text Utilities Specification","text":""},{"location":"shell-piping-design/#1-head-show-first-n-lines","title":"1. head - Show first N lines","text":"<p>Syntax: <pre><code>head [-n NUM] [file]\n</code></pre></p> <p>Flags: - <code>-n NUM</code> - Show first NUM lines (default: 10)</p> <p>Examples: <pre><code>head -n 5 title        # First 5 lines of title file\ncat text | head        # First 10 lines of piped input\ncat text | head -n 100 # First 100 lines\n</code></pre></p> <p>Implementation: - Split on <code>\\n</code> - Return first N lines - ~30 lines of code</p>"},{"location":"shell-piping-design/#2-tail-show-last-n-lines","title":"2. tail - Show last N lines","text":"<p>Syntax: <pre><code>tail [-n NUM] [file]\n</code></pre></p> <p>Flags: - <code>-n NUM</code> - Show last NUM lines (default: 10)</p> <p>Examples: <pre><code>tail -n 20 description  # Last 20 lines\ncat text | tail         # Last 10 lines of piped input\n</code></pre></p> <p>Implementation: - Split on <code>\\n</code> - Return last N lines - ~30 lines of code</p>"},{"location":"shell-piping-design/#3-wc-count-lines-words-characters","title":"3. wc - Count lines, words, characters","text":"<p>Syntax: <pre><code>wc [-l|-w|-c] [file]\n</code></pre></p> <p>Flags: - <code>-l</code> - Count lines only - <code>-w</code> - Count words only - <code>-c</code> - Count characters only - (no flag) - Show all three</p> <p>Examples: <pre><code>wc text                    # Lines, words, chars\nwc -l text                # Line count only\nfind author:Knuth | wc -l # Count search results\n</code></pre></p> <p>Output format: <pre><code>  123  4567  89012  filename  # lines words chars\n</code></pre></p> <p>Implementation: - Count <code>\\n</code>, split on whitespace, len() - ~40 lines of code</p>"},{"location":"shell-piping-design/#4-sort-sort-lines-alphabetically","title":"4. sort - Sort lines alphabetically","text":"<p>Syntax: <pre><code>sort [-r] [file]\n</code></pre></p> <p>Flags: - <code>-r</code> - Reverse sort (Z to A)</p> <p>Examples: <pre><code>cat authors | sort        # Alphabetical\ncat authors | sort -r     # Reverse alphabetical\n</code></pre></p> <p>Implementation: - <code>sorted(lines)</code> or <code>sorted(lines, reverse=True)</code> - ~20 lines of code</p>"},{"location":"shell-piping-design/#5-uniq-remove-duplicate-adjacent-lines","title":"5. uniq - Remove duplicate adjacent lines","text":"<p>Syntax: <pre><code>uniq [-c] [file]\n</code></pre></p> <p>Flags: - <code>-c</code> - Prefix lines with occurrence count</p> <p>Examples: <pre><code>cat subjects | sort | uniq       # Unique subjects\ncat subjects | sort | uniq -c    # Count each subject\n</code></pre></p> <p>Output with <code>-c</code>: <pre><code>   3 Python\n   5 Machine Learning\n   1 Algorithms\n</code></pre></p> <p>Implementation: - Compare adjacent lines - With <code>-c</code>: count occurrences - ~30 lines of code</p>"},{"location":"shell-piping-design/#6-more-paginate-output","title":"6. more - Paginate output","text":"<p>Syntax: <pre><code>more [file]\n</code></pre></p> <p>Behavior: - Display one page at a time - Use Rich's <code>Pager</code> for consistent UX - Space to advance, q to quit</p> <p>Examples: <pre><code>cat text | more\nmore description\n</code></pre></p> <p>Implementation: - Use <code>console.pager()</code> from Rich - ~40 lines of code</p>"},{"location":"shell-piping-design/#pipeline-implementation","title":"Pipeline Implementation","text":""},{"location":"shell-piping-design/#pipeline-parser","title":"Pipeline Parser","text":"<pre><code>class Pipeline:\n    \"\"\"Execute a series of piped commands.\"\"\"\n\n    def __init__(self, command_line: str):\n        \"\"\"Parse pipeline from command line.\n\n        Args:\n            command_line: Full command with pipes, e.g., \"cat x | grep y\"\n        \"\"\"\n        self.commands = [cmd.strip() for cmd in command_line.split('|')]\n\n    def execute(self, shell: 'LibraryShell') -&gt; str:\n        \"\"\"Execute pipeline, passing stdout between commands.\n\n        Args:\n            shell: Shell instance for command execution\n\n        Returns:\n            Final output as string\n        \"\"\"\n        output = None\n\n        for cmd_str in self.commands:\n            # Parse command\n            parts = shlex.split(cmd_str)\n            cmd_name = parts[0]\n            args = parts[1:] if len(parts) &gt; 1 else []\n\n            # Execute with stdin from previous command\n            output = shell.execute_command(cmd_name, args, stdin=output)\n\n            if output is None:\n                # Command failed\n                return None\n\n        return output\n</code></pre>"},{"location":"shell-piping-design/#command-execution-updates","title":"Command Execution Updates","text":"<p>Modify <code>LibraryShell.execute()</code>:</p> <pre><code>def execute(self, line: str):\n    \"\"\"Execute command line with optional piping.\"\"\"\n\n    # Check for pipes\n    if '|' in line:\n        pipeline = Pipeline(line)\n        output = pipeline.execute(self)\n        if output:\n            self.console.print(output)\n    else:\n        # Existing single command execution\n        self._execute_single(line)\n</code></pre> <p>Update command methods to accept <code>stdin</code>:</p> <pre><code>def execute_command(self, cmd_name: str, args: List[str],\n                   stdin: Optional[str] = None) -&gt; Optional[str]:\n    \"\"\"Execute a command with optional stdin.\n\n    Args:\n        cmd_name: Command name\n        args: Command arguments\n        stdin: Optional input from previous command\n\n    Returns:\n        Command output as string, or None on error\n    \"\"\"\n    if cmd_name in self.commands:\n        return self.commands[cmd_name](args, stdin=stdin)\n    else:\n        self.console.print(f\"[red]Unknown command: {cmd_name}[/red]\")\n        return None\n</code></pre>"},{"location":"shell-piping-design/#usage-examples","title":"Usage Examples","text":""},{"location":"shell-piping-design/#basic-piping","title":"Basic Piping","text":"<pre><code># Paginate long output\nebk:/books/42 $ cat text | more\n\n# Preview file\nebk:/books/42 $ cat description | head -10\n\n# Count lines\nebk:/books/42 $ cat text | wc -l\n1247 lines\n\n# Find and count\nebk:/ $ find author:Knuth | wc -l\n5 books\n</code></pre>"},{"location":"shell-piping-design/#complex-workflows","title":"Complex Workflows","text":"<pre><code># Most common words in a book\nebk:/books/42 $ cat text | tr ' ' '\\n' | sort | uniq -c | sort -rn | head -20\n\n# Find books with \"algorithm\" in title\nebk:/ $ find title:algorithm | head -5\n\n# Unique subjects, sorted\nebk:/ $ find subject:* | sort | uniq\n\n# Count authors with &gt; 5 books\nebk:/ $ find author:* | uniq | wc -l\n\n# Preview search results\nebk:/ $ grep -r \"machine learning\" /books | head -50 | more\n</code></pre>"},{"location":"shell-piping-design/#vfs-navigation-piping","title":"VFS Navigation + Piping","text":"<pre><code># Count files in current book\nebk:/books/42 $ ls files | wc -l\n\n# Show similar books\nebk:/books/42 $ ls similar | head -5\n\n# Sorted author list\nebk:/authors $ ls | sort\n</code></pre>"},{"location":"shell-piping-design/#error-handling","title":"Error Handling","text":""},{"location":"shell-piping-design/#pipeline-errors","title":"Pipeline Errors","text":"<ul> <li>If any command in pipeline fails, stop execution</li> <li>Show error from failing command</li> <li>Don't execute remaining commands</li> </ul> <pre><code>ebk:/ $ cat nonexistent | grep foo\ncat: nonexistent: No such file or directory\n# (grep never executes)\n</code></pre>"},{"location":"shell-piping-design/#command-errors","title":"Command Errors","text":"<ul> <li>Invalid flags: Show usage</li> <li>Missing arguments: Show usage</li> <li>File not found: Show error, return None</li> <li>Stdin required but not provided: Show error</li> </ul>"},{"location":"shell-piping-design/#testing-strategy","title":"Testing Strategy","text":""},{"location":"shell-piping-design/#unit-tests","title":"Unit Tests","text":"<p>Each utility gets comprehensive tests:</p> <pre><code>def test_head_basic():\n    \"\"\"Test head with default 10 lines.\"\"\"\n\ndef test_head_custom_lines():\n    \"\"\"Test head with -n flag.\"\"\"\n\ndef test_head_stdin():\n    \"\"\"Test head reading from stdin.\"\"\"\n\ndef test_head_empty_input():\n    \"\"\"Test head with empty input.\"\"\"\n</code></pre>"},{"location":"shell-piping-design/#integration-tests","title":"Integration Tests","text":"<p>Test piping combinations:</p> <pre><code>def test_pipeline_cat_grep():\n    \"\"\"Test cat | grep.\"\"\"\n\ndef test_pipeline_find_wc():\n    \"\"\"Test find | wc -l.\"\"\"\n\ndef test_pipeline_sort_uniq():\n    \"\"\"Test sort | uniq.\"\"\"\n\ndef test_pipeline_three_commands():\n    \"\"\"Test cat | grep | head.\"\"\"\n</code></pre>"},{"location":"shell-piping-design/#edge-cases","title":"Edge Cases","text":"<ul> <li>Empty stdin</li> <li>Very long lines (&gt;10k chars)</li> <li>Unicode handling</li> <li>Commands with no output</li> <li>Invalid command in pipeline</li> </ul>"},{"location":"shell-piping-design/#performance-considerations","title":"Performance Considerations","text":""},{"location":"shell-piping-design/#string-processing","title":"String Processing","text":"<ul> <li>Python strings are efficient for text processing</li> <li>No need for streaming (library files are manageable size)</li> <li>Max file size: ~10MB (typical ebook text)</li> </ul>"},{"location":"shell-piping-design/#pipeline-buffering","title":"Pipeline Buffering","text":"<ul> <li>Buffer entire output between commands</li> <li>No streaming needed (text files are small)</li> <li>Trade memory for simplicity</li> </ul>"},{"location":"shell-piping-design/#optimization-opportunities","title":"Optimization Opportunities","text":"<p>If needed later: - Lazy evaluation with generators - Streaming for very large files - Parallel pipeline execution (probably overkill)</p>"},{"location":"shell-piping-design/#future-extensions-out-of-scope","title":"Future Extensions (Out of Scope)","text":"<p>These are explicitly NOT being implemented:</p> <ul> <li>Advanced sorting (<code>sort -n</code>, <code>-k</code>, <code>-t</code>) - Diminishing returns</li> <li>Advanced grep (<code>-A</code>, <code>-B</code>, <code>-C</code> context) - Already complex enough</li> <li>Redirection (<code>&gt;</code>, <code>&gt;&gt;</code>, <code>&lt;</code>) - VFS is read-only</li> <li>Tee command - Not needed for read-only exploration</li> <li>Xargs - Interesting but adds complexity</li> <li>Awk/sed - Way too complex, use Python instead</li> <li>Cut/paste - Niche use cases</li> <li>Regex in other commands - Keep grep for that</li> </ul>"},{"location":"shell-piping-design/#summary","title":"Summary","text":"<p>This design provides:</p> <p>\u2705 Familiar UX - Unix users feel at home \u2705 Composability - Commands chain naturally \u2705 Power - Complex queries possible \u2705 Simplicity - ~500 lines total code \u2705 Maintainability - Clear boundaries, well-tested \u2705 Focused - Enhanced library browsing, not general shell</p> <p>The scope is deliberately limited to avoid:</p> <p>\u274c Scope creep (no scripting, job control, etc.) \u274c Complexity explosion (no subshells, variables, etc.) \u274c Maintenance burden (simple code, simple tests)</p> <p>Result: A shell that feels professional and powerful while remaining focused on its core purpose - exploring ebook libraries.</p>"},{"location":"tags-complete-implementation/","title":"Hierarchical Tags - Complete Implementation Summary","text":""},{"location":"tags-complete-implementation/#overview","title":"Overview","text":"<p>Successfully implemented a complete hierarchical tagging system for organizing ebooks in the ebk library manager. This feature allows users to create nested tags (e.g., <code>Work/Project-2024/Backend</code>) and manage them through both an interactive shell and CLI commands.</p>"},{"location":"tags-complete-implementation/#implementation-timeline","title":"Implementation Timeline","text":"<p>All four phases completed:</p> <ol> <li>Phase 1: Database Schema &amp; Core Tag Support \u2705</li> <li>Phase 2: VFS Read-Only Navigation \u2705</li> <li>Phase 3: Tag Write Operations in Shell \u2705</li> <li>Phase 4: CLI Commands for Tag Management \u2705</li> </ol>"},{"location":"tags-complete-implementation/#key-features","title":"Key Features","text":""},{"location":"tags-complete-implementation/#hierarchical-organization","title":"Hierarchical Organization","text":"<p>Tags support unlimited nesting depth: <pre><code>Work/\n\u251c\u2500\u2500 Project-2024/\n\u2502   \u251c\u2500\u2500 Backend/\n\u2502   \u2514\u2500\u2500 Frontend/\n\u2514\u2500\u2500 Reference/\nReading-List/\n\u251c\u2500\u2500 To-Read/\n\u2514\u2500\u2500 Currently-Reading/\nArchive/\n</code></pre></p>"},{"location":"tags-complete-implementation/#dual-interface","title":"Dual Interface","text":"<p>Interactive Shell (<code>ebk shell ~/library</code>): - Navigate tags like directories: <code>cd /tags/Work/Project-2024/</code> - Browse contents: <code>ls</code>, <code>cat stats</code> - Add tags: <code>cp /books/42 /tags/Work/</code> - Move tags: <code>mv /tags/Work/42 /tags/Archive/</code> - Remove tags: <code>rm /tags/Work/42</code></p> <p>Command Line (<code>ebk tag &lt;command&gt;</code>): - List tags: <code>ebk tag list ~/library</code> - Show tree: <code>ebk tag tree ~/library</code> - Add tag: <code>ebk tag add 42 Work ~/library</code> - Remove tag: <code>ebk tag remove 42 Work ~/library</code> - Rename tag: <code>ebk tag rename Work Archive ~/library</code> - Delete tag: <code>ebk tag delete OldTag ~/library -r</code> - Statistics: <code>ebk tag stats ~/library</code></p>"},{"location":"tags-complete-implementation/#separation-from-subjects","title":"Separation from Subjects","text":"<p>Subjects (bibliographic metadata): - What the book is about - Read-only (from metadata) - Flat structure - Controlled vocabulary</p> <p>Tags (user organization): - How you use/organize the book - Editable by user - Hierarchical structure - Freeform</p>"},{"location":"tags-complete-implementation/#technical-architecture","title":"Technical Architecture","text":""},{"location":"tags-complete-implementation/#database-layer","title":"Database Layer","text":"<p>Tag Model (<code>ebk/db/models.py</code>): <pre><code>class Tag(Base):\n    id = Column(Integer, primary_key=True)\n    name = Column(String(200))                    # Name at this level\n    path = Column(String(500), unique=True)       # Full hierarchical path\n    parent_id = Column(Integer, ForeignKey('tags.id'))\n    description = Column(Text)\n    color = Column(String(7))                     # Hex color\n    created_at = Column(DateTime)\n\n    # Relationships\n    parent = relationship('Tag', remote_side=[id])\n    children = relationship('Tag', backref='parent')\n    books = relationship('Book', secondary=book_tags)\n</code></pre></p> <p>Key Features: - Self-referential parent/child relationships - Path-based storage for fast lookups - Cascade deletion - Many-to-many with books</p>"},{"location":"tags-complete-implementation/#service-layer","title":"Service Layer","text":"<p>TagService (<code>ebk/services/tag_service.py</code>): - <code>get_or_create_tag()</code> - Auto-creates full hierarchy - <code>get_tag()</code>, <code>get_all_tags()</code>, <code>get_root_tags()</code>, <code>get_children()</code> - <code>delete_tag()</code>, <code>rename_tag()</code> - Updates entire subtree - <code>add_tag_to_book()</code>, <code>remove_tag_from_book()</code> - <code>get_books_with_tag()</code> - Optionally includes subtags - <code>get_tag_stats()</code> - Comprehensive statistics</p>"},{"location":"tags-complete-implementation/#vfs-layer","title":"VFS Layer","text":"<p>Tag Nodes (<code>ebk/vfs/nodes/tags.py</code>): - <code>TagsDirectoryNode</code> - <code>/tags/</code> entry point - <code>TagNode</code> - Individual tag directory - <code>TagDescriptionFile</code> - Metadata file - <code>TagColorFile</code> - Metadata file - <code>TagStatsFile</code> - Metadata file</p> <p>VFS Structure: <pre><code>/\n\u251c\u2500\u2500 books/\n\u251c\u2500\u2500 authors/\n\u251c\u2500\u2500 subjects/\n\u2514\u2500\u2500 tags/\n    \u251c\u2500\u2500 Work/\n    \u2502   \u251c\u2500\u2500 Project-2024/\n    \u2502   \u2502   \u251c\u2500\u2500 42 -&gt; /books/42     # Book symlinks\n    \u2502   \u2502   \u251c\u2500\u2500 stats               # Metadata files\n    \u2502   \u2502   \u2514\u2500\u2500 color\n    \u2502   \u2514\u2500\u2500 Reference/\n    \u2514\u2500\u2500 Reading-List/\n</code></pre></p>"},{"location":"tags-complete-implementation/#shell-commands","title":"Shell Commands","text":"<p>Write Operations (<code>ebk/repl/shell.py</code>): - <code>cp &lt;src&gt; &lt;dest&gt;</code> - Add tag to book - <code>mv &lt;src&gt; &lt;dest&gt;</code> - Move book between tags - <code>rm [-r] &lt;path&gt;</code> - Remove tag or delete tag</p> <p>Features: - Auto-creates tag hierarchy - Robust path parsing - Clear error messages - Silent mode for piping</p>"},{"location":"tags-complete-implementation/#cli-commands","title":"CLI Commands","text":"<p>Tag Management (<code>ebk/cli.py</code>): - <code>ebk tag list [--tag TAG] [--subtags]</code> - List tags/books - <code>ebk tag tree [--root TAG]</code> - Show hierarchy - <code>ebk tag add BOOK TAG [--description] [--color]</code> - Add tag - <code>ebk tag remove BOOK TAG</code> - Remove tag - <code>ebk tag rename OLD NEW</code> - Rename tag - <code>ebk tag delete TAG [-r] [-f]</code> - Delete tag - <code>ebk tag stats [--tag TAG]</code> - Show statistics</p> <p>Features: - Rich table formatting - Tree visualization - Confirmation prompts - Batch operation support</p>"},{"location":"tags-complete-implementation/#usage-examples","title":"Usage Examples","text":""},{"location":"tags-complete-implementation/#creating-and-using-tags","title":"Creating and Using Tags","text":"<pre><code># Via shell\nebk shell ~/library\nebk:/$ cp /books/42 /tags/Work/Project-2024/\n\u2713 Added tag 'Work/Project-2024' to book 42\n\n# Via CLI\nebk tag add 42 Work/Project-2024 ~/library -d \"2024 projects\"\n\u2713 Added tag 'Work/Project-2024' to book 42\n  Book: The Art of Computer Programming\n</code></pre>"},{"location":"tags-complete-implementation/#browsing-tags","title":"Browsing Tags","text":"<pre><code># Via shell\nebk:/$ cd /tags/\nebk:/tags$ ls\nWork/\nReading-List/\nArchive/\n\nebk:/tags$ cd Work/\nebk:/tags/Work$ ls\nProject-2024/\nReference/\n42\n137\nstats\n\nebk:/tags/Work$ cat stats\nTag: Work\nDepth: 0\nBooks: 2\nSubtags: 2\n\n# Via CLI\nebk tag tree ~/library\nTag Tree\n\n\u251c\u2500\u2500 Work (5 books)\n\u2502   \u251c\u2500\u2500 Project-2024 (3 books)\n\u2502   \u2514\u2500\u2500 Reference (2 books)\n\u2514\u2500\u2500 Reading-List (10 books)\n</code></pre>"},{"location":"tags-complete-implementation/#managing-tags","title":"Managing Tags","text":"<pre><code># Move book between tags (shell)\nebk:/$ mv /tags/Work/42 /tags/Archive/\n\u2713 Moved book 42 from 'Work' to 'Archive'\n\n# Rename tag (CLI)\nebk tag rename Work/Project-2024 Work/Completed ~/library\n\u2713 Renamed tag 'Work/Project-2024' \u2192 'Work/Completed'\n  Subtags updated: 2\n\n# Delete tag (CLI)\nebk tag delete OldProject ~/library -r\nAbout to delete tag: OldProject\n  Books: 5\n  Subtags: 2\nAre you sure? [y/N]: y\n\u2713 Deleted tag 'OldProject'\n</code></pre>"},{"location":"tags-complete-implementation/#querying-tags","title":"Querying Tags","text":"<pre><code># List books with tag, including subtags (CLI)\nebk tag list ~/library -t Work -s\nBooks with tag 'Work'\n\u250c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 ID \u2502 Title                           \u2502 Authors      \u2502\n\u251c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 42 \u2502 The Art of Computer Programming \u2502 Knuth        \u2502\n\u2502 137\u2502 Concrete Mathematics            \u2502 Knuth et al. \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n# Show tag statistics (CLI)\nebk tag stats ~/library\nTag Statistics\n\nTotal tags:    25\nRoot tags:     5\nTagged books:  42\n\nMost Popular Tags:\n  Work/Project-2024                           12 books\n  Reading-List/To-Read                        10 books\n</code></pre>"},{"location":"tags-complete-implementation/#testing","title":"Testing","text":""},{"location":"tags-complete-implementation/#test-coverage","title":"Test Coverage","text":"<p>120 comprehensive tests across 3 test files:</p> <ol> <li><code>tests/test_tag_service.py</code> (40 tests)</li> <li>Tag creation and hierarchy</li> <li>Tag retrieval and queries</li> <li>Tag deletion and renaming</li> <li>Book tagging operations</li> <li> <p>Edge cases</p> </li> <li> <p><code>tests/test_tag_model.py</code> (34 tests)</p> </li> <li>Model properties (depth, ancestors, etc.)</li> <li>Relationships</li> <li>Database constraints</li> <li> <p>Cascade deletion</p> </li> <li> <p><code>tests/test_tag_vfs.py</code> (46 tests)</p> </li> <li>VFS node navigation</li> <li>Hierarchical browsing</li> <li>Metadata files</li> <li>Empty tags and edge cases</li> </ol> <p>Coverage: 100% on tag-specific modules - <code>ebk/services/tag_service.py</code>: 100% (92/92 statements) - <code>ebk/vfs/nodes/tags.py</code>: 100% (99/99 statements) - Tag model in <code>ebk/db/models.py</code>: 100%</p>"},{"location":"tags-complete-implementation/#all-tests-passing","title":"All Tests Passing","text":"<pre><code>$ pytest tests/test_tag_*.py -v\n======= 120 passed in 13.42s =======\n</code></pre>"},{"location":"tags-complete-implementation/#migration-path","title":"Migration Path","text":""},{"location":"tags-complete-implementation/#for-new-libraries","title":"For New Libraries","text":"<p>Tags table created automatically: <pre><code>ebk init ~/my-library\n# Tags support included\n</code></pre></p>"},{"location":"tags-complete-implementation/#for-existing-libraries","title":"For Existing Libraries","text":"<p>Run migration to add tags support: <pre><code># Check if migration needed\nebk migrate ~/my-library --check\nMigrations needed:\n  \u2022 add_tags\n\n# Apply migration\nebk migrate ~/my-library\nRunning migrations on /home/user/my-library...\n\u2713 Migrations completed successfully:\n  \u2022 add_tags\n</code></pre></p> <p>No data loss - Migration only adds new tables.</p>"},{"location":"tags-complete-implementation/#files-createdmodified","title":"Files Created/Modified","text":""},{"location":"tags-complete-implementation/#created-8-files","title":"Created (8 files):","text":"<ol> <li><code>ebk/services/tag_service.py</code> - Tag service layer (274 lines)</li> <li><code>ebk/db/migrations.py</code> - Migration system (145 lines)</li> <li><code>ebk/vfs/nodes/tags.py</code> - VFS tag nodes (269 lines)</li> <li><code>tests/test_tag_service.py</code> - Service tests (670 lines)</li> <li><code>tests/test_tag_model.py</code> - Model tests (450 lines)</li> <li><code>tests/test_tag_vfs.py</code> - VFS tests (642 lines)</li> <li><code>docs/tags-phase1-summary.md</code> - Phase 1 docs</li> <li><code>docs/tags-phase2-summary.md</code> - Phase 2 docs</li> <li><code>docs/tags-phase3-summary.md</code> - Phase 3 docs</li> <li><code>docs/tags-phase4-summary.md</code> - Phase 4 docs</li> <li><code>docs/tags-complete-implementation.md</code> - This document</li> </ol>"},{"location":"tags-complete-implementation/#modified-6-files","title":"Modified (6 files):","text":"<ol> <li><code>ebk/db/models.py</code> - Added Tag model, book_tags table</li> <li><code>ebk/db/__init__.py</code> - Exported Tag and migration functions</li> <li><code>ebk/cli.py</code> - Added tag command group (490 lines), migrate command</li> <li><code>ebk/vfs/nodes/root.py</code> - Added /tags/ directory</li> <li><code>ebk/vfs/nodes/__init__.py</code> - Exported tag nodes</li> <li><code>ebk/repl/shell.py</code> - Added cp/mv/rm commands (277 lines), updated help</li> </ol>"},{"location":"tags-complete-implementation/#statistics","title":"Statistics","text":"<ul> <li>Total Code: ~2000 lines</li> <li>Total Tests: 120 tests (100% passing)</li> <li>Test Coverage: 100% on tag modules</li> <li>Documentation: 5 comprehensive markdown files</li> <li>Development Time: 4 phases</li> <li>Commands Added: 10 (3 shell + 7 CLI)</li> </ul>"},{"location":"tags-complete-implementation/#design-principles","title":"Design Principles","text":""},{"location":"tags-complete-implementation/#1-unix-philosophy","title":"1. Unix Philosophy","text":"<p>Tags follow Unix principles: - Simple, composable commands - Text streams (piping support) - Do one thing well - Everything is a file (VFS)</p>"},{"location":"tags-complete-implementation/#2-user-friendly","title":"2. User-Friendly","text":"<p>Intuitive interface: - Familiar commands (cp/mv/rm) - Clear error messages - Helpful hints - Confirmation prompts for destructive operations</p>"},{"location":"tags-complete-implementation/#3-hierarchical-first","title":"3. Hierarchical First","text":"<p>Full support for hierarchy: - Unlimited nesting - Auto-create parents - Cascade updates (rename, delete) - Hierarchical queries (include subtags)</p>"},{"location":"tags-complete-implementation/#4-separation-of-concerns","title":"4. Separation of Concerns","text":"<p>Tags distinct from subjects: - Different semantics - Different storage - Different workflows - Can use both independently</p>"},{"location":"tags-complete-implementation/#5-safety","title":"5. Safety","text":"<p>Protection against mistakes: - Confirmations for deletes - Warnings for edge cases - Transaction-based operations - Cascade flags required</p>"},{"location":"tags-complete-implementation/#future-enhancements","title":"Future Enhancements","text":"<p>Potential improvements:</p> <ol> <li>Import/Export Integration</li> <li>Preserve tags in exports</li> <li> <p>Import tags from metadata</p> </li> <li> <p>Smart Queries</p> </li> <li>Filter books by tag in <code>ebk list</code></li> <li> <p>Search within tagged books</p> </li> <li> <p>Bulk Operations</p> </li> <li>Add tag to multiple books</li> <li> <p>Copy books between tags</p> </li> <li> <p>Tag Aliases</p> </li> <li>Shortcuts for long paths</li> <li> <p>Quick navigation</p> </li> <li> <p>Tag Templates</p> </li> <li>Predefined hierarchies</li> <li> <p>Project workflows</p> </li> <li> <p>Color Visualization</p> </li> <li>Show colors in tree</li> <li>Color-coded organization</li> </ol>"},{"location":"tags-complete-implementation/#conclusion","title":"Conclusion","text":"<p>The hierarchical tagging system is complete and production-ready:</p> <p>\u2705 Phase 1: Database schema and service layer with 100% test coverage \u2705 Phase 2: VFS navigation for browsing tags as directories \u2705 Phase 3: Shell write operations (cp/mv/rm) for tag management \u2705 Phase 4: Comprehensive CLI commands for all tag operations</p> <p>Users can now: - Create hierarchical tag structures - Navigate tags like directories in the shell - Manage tags via intuitive Unix-like commands - Query and visualize tag hierarchies - Organize their ebook libraries with flexible, user-defined tags</p> <p>The implementation is well-tested, documented, and integrates seamlessly with the existing ebk architecture.</p> <p>Total: ~2000 lines of production code, 120 tests, 4 phases, 1 complete feature.</p>"},{"location":"tags-phase1-summary/","title":"Hierarchical Tags - Phase 1 Implementation Summary","text":""},{"location":"tags-phase1-summary/#overview","title":"Overview","text":"<p>Completed Phase 1 of hierarchical tagging system: Database schema and core tag support.</p> <p>Tags provide user-defined organization separate from bibliographic subjects: - Subjects: What the book is about (bibliographic metadata, controlled vocabulary, read-only) - Tags: How you use/organize the book (user-defined, freeform, editable)</p>"},{"location":"tags-phase1-summary/#what-was-implemented","title":"What Was Implemented","text":""},{"location":"tags-phase1-summary/#1-database-schema-ebkdbmodelspy","title":"1. Database Schema (<code>ebk/db/models.py</code>)","text":"<p>Tag Model (lines 168-222): <pre><code>class Tag(Base):\n    \"\"\"User-defined hierarchical tags for organizing books.\"\"\"\n    __tablename__ = 'tags'\n\n    # Core fields\n    id = Column(Integer, primary_key=True)\n    name = Column(String(200), nullable=False, index=True)  # Name at this level\n    path = Column(String(500), nullable=False, unique=True, index=True)  # Full path\n    parent_id = Column(Integer, ForeignKey('tags.id', ondelete='CASCADE'))\n\n    # Optional metadata\n    description = Column(Text)\n    color = Column(String(7))  # Hex color code\n    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)\n\n    # Relationships\n    parent = relationship('Tag', remote_side=[id], backref='children')\n    books = relationship('Book', secondary=book_tags, back_populates='tags')\n</code></pre></p> <p>Key Features: - Path-based hierarchy (e.g., \"Work/Project-2024\") - Self-referential parent/child relationships - Helper properties: <code>depth</code>, <code>ancestors</code>, <code>full_path_parts</code> - Indexed for efficient querying</p> <p>book_tags Association Table (lines 42-48): <pre><code>book_tags = Table(\n    'book_tags',\n    Base.metadata,\n    Column('book_id', Integer, ForeignKey('books.id', ondelete='CASCADE'), primary_key=True),\n    Column('tag_id', Integer, ForeignKey('tags.id', ondelete='CASCADE'), primary_key=True),\n    Column('created_at', DateTime, default=datetime.utcnow)\n)\n</code></pre></p> <p>Book Model Update (line 88): - Added <code>tags</code> relationship for many-to-many association</p>"},{"location":"tags-phase1-summary/#2-tag-service-ebkservicestag_servicepy","title":"2. Tag Service (<code>ebk/services/tag_service.py</code>)","text":"<p>Complete CRUD operations for hierarchical tags:</p> <p>Hierarchy Management: - <code>get_or_create_tag(path, description, color)</code> - Creates full hierarchy from path - <code>get_tag(path)</code> - Get tag by path - <code>get_all_tags()</code> - Get all tags ordered by path - <code>get_root_tags()</code> - Get top-level tags (no parent) - <code>get_children(tag)</code> - Get immediate children</p> <p>Tag Operations: - <code>delete_tag(path, delete_children)</code> - Delete with validation - <code>rename_tag(old_path, new_path)</code> - Rename and update entire subtree</p> <p>Book-Tag Association: - <code>add_tag_to_book(book, tag_path)</code> - Add tag to book - <code>remove_tag_from_book(book, tag_path)</code> - Remove tag from book</p> <p>Querying: - <code>get_books_with_tag(tag_path, include_subtags)</code> - Get books, optionally including descendants - <code>get_tag_stats(tag_path)</code> - Get book_count, subtag_count, depth, created_at</p>"},{"location":"tags-phase1-summary/#3-database-migration-system-ebkdbmigrationspy","title":"3. Database Migration System (<code>ebk/db/migrations.py</code>)","text":"<p>Migration Infrastructure: - <code>migrate_add_tags(library_path, dry_run)</code> - Add tags and book_tags tables - <code>run_all_migrations(library_path, dry_run)</code> - Run all pending migrations - <code>check_migrations(library_path)</code> - Check which migrations are needed - Extensible architecture for future migrations</p> <p>Migration Features: - Detects if migration is needed - Dry-run mode for checking without applying - Transaction-based execution - Error handling and logging</p>"},{"location":"tags-phase1-summary/#4-cli-migration-command-ebkclipy","title":"4. CLI Migration Command (<code>ebk/cli.py</code>)","text":"<p>New Command: <code>ebk migrate</code></p> <pre><code># Run all pending migrations\nebk migrate ~/my-library\n\n# Check which migrations are needed without applying\nebk migrate ~/my-library --check\n</code></pre> <p>Output: - Shows which migrations were applied - Confirms if database is up-to-date - Clear error messages if migration fails</p>"},{"location":"tags-phase1-summary/#5-module-exports-ebkdb__init__py","title":"5. Module Exports (<code>ebk/db/__init__.py</code>)","text":"<p>Added to public API: - <code>Tag</code> model class - <code>run_all_migrations</code> function - <code>check_migrations</code> function</p>"},{"location":"tags-phase1-summary/#usage-examples","title":"Usage Examples","text":""},{"location":"tags-phase1-summary/#creating-tags","title":"Creating Tags","text":"<pre><code>from ebk.library_db import Library\nfrom ebk.services.tag_service import TagService\n\nlib = Library.open(\"~/my-library\")\nsession = lib.session\ntag_service = TagService(session)\n\n# Create hierarchical tag (creates \"Work\" and \"Work/Project-2024\")\ntag = tag_service.get_or_create_tag(\n    \"Work/Project-2024\",\n    description=\"Books for 2024 project\",\n    color=\"#FF5733\"\n)\n\n# Add tag to book\nbook = session.query(Book).first()\ntag_service.add_tag_to_book(book, \"Work/Project-2024\")\n\n# Get all books with tag (including subtags)\nbooks = tag_service.get_books_with_tag(\"Work\", include_subtags=True)\n\nlib.close()\n</code></pre>"},{"location":"tags-phase1-summary/#running-migration","title":"Running Migration","text":"<pre><code># For existing libraries, run migration to add tags support\n$ ebk migrate ~/my-library\nRunning migrations on /home/user/my-library...\n\u2713 Migrations completed successfully:\n  \u2022 add_tags\n</code></pre>"},{"location":"tags-phase1-summary/#database-schema","title":"Database Schema","text":""},{"location":"tags-phase1-summary/#tags-table","title":"Tags Table","text":"<pre><code>CREATE TABLE tags (\n    id INTEGER PRIMARY KEY,\n    name VARCHAR(200) NOT NULL,           -- Name at this level\n    path VARCHAR(500) NOT NULL UNIQUE,    -- Full hierarchical path\n    parent_id INTEGER,                    -- Self-referential FK\n    description TEXT,\n    color VARCHAR(7),                     -- Hex color code\n    created_at DATETIME NOT NULL,\n    FOREIGN KEY(parent_id) REFERENCES tags (id) ON DELETE CASCADE\n);\n\nCREATE INDEX idx_tag_path ON tags (path);\nCREATE INDEX idx_tag_parent ON tags (parent_id);\nCREATE INDEX ix_tags_name ON tags (name);\n</code></pre>"},{"location":"tags-phase1-summary/#book_tags-association-table","title":"book_tags Association Table","text":"<pre><code>CREATE TABLE book_tags (\n    book_id INTEGER NOT NULL,\n    tag_id INTEGER NOT NULL,\n    created_at DATETIME,\n    PRIMARY KEY (book_id, tag_id),\n    FOREIGN KEY(book_id) REFERENCES books (id) ON DELETE CASCADE,\n    FOREIGN KEY(tag_id) REFERENCES tags (id) ON DELETE CASCADE\n);\n</code></pre>"},{"location":"tags-phase1-summary/#key-design-decisions","title":"Key Design Decisions","text":""},{"location":"tags-phase1-summary/#path-based-storage","title":"Path-Based Storage","text":"<ul> <li>Store full path in <code>path</code> column (e.g., \"Work/Project-2024\")</li> <li>Enables fast lookups by path</li> <li>Simplifies querying descendants using LIKE queries</li> </ul>"},{"location":"tags-phase1-summary/#automatic-hierarchy-creation","title":"Automatic Hierarchy Creation","text":"<ul> <li><code>get_or_create_tag(\"Work/Project-2024\")</code> automatically creates:</li> <li>\"Work\" (if doesn't exist)</li> <li>\"Work/Project-2024\" (if doesn't exist)</li> <li>Ensures referential integrity</li> <li>Prevents orphaned tags</li> </ul>"},{"location":"tags-phase1-summary/#cascade-deletion","title":"Cascade Deletion","text":"<ul> <li>Deleting parent tag cascades to children (configurable)</li> <li>Deleting tag removes book-tag associations</li> <li>Prevents orphaned data</li> </ul>"},{"location":"tags-phase1-summary/#separation-from-subjects","title":"Separation from Subjects","text":"<ul> <li>Tags and Subjects serve different purposes:</li> <li>Subjects: Bibliographic (what book is about)</li> <li>Tags: Organizational (how you use it)</li> <li>Different tables, different workflows</li> <li>Can filter by both independently</li> </ul>"},{"location":"tags-phase1-summary/#testing","title":"Testing","text":"<p>Migration system includes: - Dry-run mode for safe checking - Duplicate detection (won't re-run migrations) - Transaction-based execution - Clear error messages</p>"},{"location":"tags-phase1-summary/#next-steps-phase-2","title":"Next Steps (Phase 2)","text":"<p>Phase 1 is complete. Ready to proceed to Phase 2: VFS Read-Only Navigation</p> <p>Phase 2 Tasks: 1. Create VFS nodes for <code>/tags/</code> hierarchy 2. Map tag hierarchy to directory structure 3. Show books under each tag as files 4. Implement <code>ls /tags/Work/</code> to show subtags and books 5. Support <code>cd /tags/Work/Project-2024</code></p> <p>Phase 3 Tasks (after Phase 2): 1. Implement tag write operations 2. <code>cp /books/42 /tags/Work/</code> \u2192 adds tag 3. <code>mv /books/42 /tags/Archive/</code> \u2192 moves tag 4. <code>rm /tags/Work/Project-2024</code> \u2192 removes tag</p> <p>Phase 4 Tasks (final): 1. Add CLI commands for tag management 2. <code>ebk tag add &lt;book-id&gt; &lt;tag-path&gt;</code> 3. <code>ebk tag remove &lt;book-id&gt; &lt;tag-path&gt;</code> 4. <code>ebk tag list</code> / <code>ebk tag tree</code> 5. <code>ebk tag rename &lt;old&gt; &lt;new&gt;</code></p>"},{"location":"tags-phase1-summary/#files-modifiedcreated","title":"Files Modified/Created","text":""},{"location":"tags-phase1-summary/#created","title":"Created:","text":"<ol> <li><code>ebk/services/tag_service.py</code> - Tag CRUD operations (274 lines)</li> <li><code>ebk/db/migrations.py</code> - Migration system (145 lines)</li> <li><code>docs/tags-phase1-summary.md</code> - This document</li> </ol>"},{"location":"tags-phase1-summary/#modified","title":"Modified:","text":"<ol> <li><code>ebk/db/models.py</code> - Added Tag model and book_tags table</li> <li><code>ebk/db/__init__.py</code> - Exported Tag and migration functions</li> <li><code>ebk/cli.py</code> - Added <code>migrate</code> command</li> </ol>"},{"location":"tags-phase1-summary/#migration-path","title":"Migration Path","text":"<p>For users with existing libraries:</p> <ol> <li>New libraries: Tags table created automatically during <code>ebk init</code></li> <li>Existing libraries: Run <code>ebk migrate ~/my-library</code> to add tags support</li> <li>Check first: Use <code>ebk migrate ~/my-library --check</code> to see if migration is needed</li> </ol> <p>No data loss - migration only adds new tables, doesn't modify existing data.</p>"},{"location":"tags-phase2-summary/","title":"Hierarchical Tags - Phase 2 Implementation Summary","text":""},{"location":"tags-phase2-summary/#overview","title":"Overview","text":"<p>Completed Phase 2 of hierarchical tagging system: VFS read-only navigation.</p> <p>Users can now browse hierarchical tags as nested folders in the shell, just like they browse books, authors, and subjects.</p>"},{"location":"tags-phase2-summary/#what-was-implemented","title":"What Was Implemented","text":""},{"location":"tags-phase2-summary/#1-tag-vfs-nodes-ebkvfsnodestagspy","title":"1. Tag VFS Nodes (<code>ebk/vfs/nodes/tags.py</code>)","text":"<p>Created comprehensive VFS node hierarchy for tags:</p>"},{"location":"tags-phase2-summary/#tagsdirectorynode-tags","title":"TagsDirectoryNode - <code>/tags/</code>","text":"<p>Entry point for tag browsing. Lists root-level tags as children.</p> <pre><code>class TagsDirectoryNode(VirtualNode):\n    \"\"\"Virtual directory with hierarchical tag structure.\"\"\"\n\n    def list_children(self) -&gt; List[Node]:\n        \"\"\"List root-level tags (tags with no parent).\"\"\"\n        root_tags = self.tag_service.get_root_tags()\n        # Returns TagNode instances\n\n    def get_child(self, name: str) -&gt; Optional[Node]:\n        \"\"\"Get root-level tag by name.\"\"\"\n        # e.g., \"Work\", \"Reading-List\"\n</code></pre> <p>Features: - Dynamically lists root tags from database - Shows count of total tags and root tags in stats</p>"},{"location":"tags-phase2-summary/#tagnode-tagswork-or-tagsworkproject-2024","title":"TagNode - <code>/tags/Work/</code> or <code>/tags/Work/Project-2024/</code>","text":"<p>Represents a single tag in the hierarchy. Contains: - Child tags (subdirectories) - Books with this tag (symlinks to <code>/books/ID</code>) - Metadata files (description, color, stats)</p> <pre><code>class TagNode(VirtualNode):\n    \"\"\"A tag directory in the hierarchy.\"\"\"\n\n    def list_children(self) -&gt; List[Node]:\n        \"\"\"List child tags, books, and metadata files.\"\"\"\n        # Returns:\n        # - TagNode for child tags\n        # - SymlinkNode for books\n        # - FileNode for metadata (description, color, stats)\n\n    def get_child(self, name: str) -&gt; Optional[Node]:\n        \"\"\"Get child tag, book, or metadata file by name.\"\"\"\n</code></pre> <p>Features: - Hierarchical navigation (tags can have child tags) - Books appear as symlinks to <code>/books/ID</code> - Metadata files for tag info</p>"},{"location":"tags-phase2-summary/#metadata-file-nodes","title":"Metadata File Nodes","text":"<p>Three special files appear in tag directories:</p> <p>TagDescriptionFile - <code>description</code> Shows the tag's description text.</p> <p>TagColorFile - <code>color</code> Shows the tag's hex color code.</p> <p>TagStatsFile - <code>stats</code> Shows comprehensive tag statistics: <pre><code>Tag: Work/Project-2024\nName: Project-2024\nDepth: 1\nBooks: 5\nSubtags: 0\nDescription: Books for 2024 project\nColor: #FF5733\nCreated: 2025-01-15T10:30:00\n</code></pre></p>"},{"location":"tags-phase2-summary/#2-root-node-integration-ebkvfsnodesrootpy","title":"2. Root Node Integration (<code>ebk/vfs/nodes/root.py</code>)","text":"<p>Updated root node to include <code>/tags/</code> directory:</p> <pre><code>def _build_children(self) -&gt; None:\n    \"\"\"Build top-level directory nodes.\"\"\"\n    from ebk.vfs.nodes.tags import TagsDirectoryNode\n\n    self._children_cache = {\n        \"books\": BooksDirectoryNode(self.library, parent=self),\n        \"authors\": AuthorsDirectoryNode(self.library, parent=self),\n        \"subjects\": SubjectsDirectoryNode(self.library, parent=self),\n        \"tags\": TagsDirectoryNode(self.library, parent=self),  # NEW\n    }\n</code></pre> <p>Updated root stats: - Added <code>total_tags</code> count to root directory info</p>"},{"location":"tags-phase2-summary/#3-module-exports-ebkvfsnodes__init__py","title":"3. Module Exports (<code>ebk/vfs/nodes/__init__.py</code>)","text":"<p>Exported new tag node classes: - <code>TagsDirectoryNode</code> - <code>TagNode</code> - <code>TagDescriptionFile</code> - <code>TagColorFile</code> - <code>TagStatsFile</code></p>"},{"location":"tags-phase2-summary/#4-shell-help-update-ebkreplshellpy","title":"4. Shell Help Update (<code>ebk/repl/shell.py</code>)","text":"<p>Updated help command to document <code>/tags/</code> directory:</p> <pre><code>VFS Structure:\n  /books/       - All books\n  /books/42/    - Book with ID 42\n  /authors/     - Browse by author\n  /subjects/    - Browse by subject\n  /tags/        - Browse by user-defined hierarchical tags\n</code></pre>"},{"location":"tags-phase2-summary/#usage-examples","title":"Usage Examples","text":""},{"location":"tags-phase2-summary/#browsing-tags","title":"Browsing Tags","text":"<pre><code># List root-level tags\nebk:/$ ls tags/\nWork/\nReading-List/\nTo-Read/\nArchive/\n\n# Navigate into a tag\nebk:/$ cd tags/Work/\nebk:/tags/Work$ ls\nProject-2024/\nReference/\n42\n137\nstats\ndescription\n\n# View tag metadata\nebk:/tags/Work$ cat description\nWork-related books and references\n\nebk:/tags/Work$ cat stats\nTag: Work\nName: Work\nDepth: 0\nBooks: 2\nSubtags: 2\nDescription: Work-related books and references\nColor: #3498db\nCreated: 2025-01-15T10:30:00\n\n# Navigate into nested tag\nebk:/tags/Work$ cd Project-2024/\nebk:/tags/Work/Project-2024$ ls\n42\n137\n198\nstats\ncolor\n\n# Books appear as symlinks to /books/ID\nebk:/tags/Work/Project-2024$ ls -l\n42 -&gt; /books/42\n137 -&gt; /books/137\n198 -&gt; /books/198\n</code></pre>"},{"location":"tags-phase2-summary/#combining-with-other-commands","title":"Combining with Other Commands","text":"<pre><code># Count books in a tag\nebk:/tags/Work$ find . | wc -l\n5\n\n# Search within tagged books\nebk:/tags/Work/Project-2024$ cat /books/42/text | grep algorithm\n\n# List all tags\nebk:/$ ls -R tags/\n\n# Find books with specific tag\nebk:/$ cd /tags/Reading-List\nebk:/tags/Reading-List$ ls\n23\n45\n67\n</code></pre>"},{"location":"tags-phase2-summary/#vfs-structure","title":"VFS Structure","text":"<pre><code>/\n\u251c\u2500\u2500 books/\n\u2502   \u251c\u2500\u2500 42/\n\u2502   \u2514\u2500\u2500 137/\n\u251c\u2500\u2500 authors/\n\u251c\u2500\u2500 subjects/\n\u2514\u2500\u2500 tags/              # NEW\n    \u251c\u2500\u2500 Work/          # Root tag\n    \u2502   \u251c\u2500\u2500 Project-2024/    # Child tag\n    \u2502   \u2502   \u251c\u2500\u2500 42 -&gt; /books/42\n    \u2502   \u2502   \u251c\u2500\u2500 137 -&gt; /books/137\n    \u2502   \u2502   \u251c\u2500\u2500 stats\n    \u2502   \u2502   \u2514\u2500\u2500 color\n    \u2502   \u251c\u2500\u2500 Reference/       # Child tag\n    \u2502   \u251c\u2500\u2500 42 -&gt; /books/42\n    \u2502   \u251c\u2500\u2500 stats\n    \u2502   \u2514\u2500\u2500 description\n    \u251c\u2500\u2500 Reading-List/  # Root tag\n    \u2502   \u251c\u2500\u2500 23 -&gt; /books/23\n    \u2502   \u2514\u2500\u2500 45 -&gt; /books/45\n    \u2514\u2500\u2500 Archive/       # Root tag\n        \u2514\u2500\u2500 ...\n</code></pre>"},{"location":"tags-phase2-summary/#architecture","title":"Architecture","text":""},{"location":"tags-phase2-summary/#hierarchical-navigation","title":"Hierarchical Navigation","text":"<p>Tags support unlimited nesting: - <code>/tags/Work/</code> - Depth 0 (root tag) - <code>/tags/Work/Project-2024/</code> - Depth 1 - <code>/tags/Work/Project-2024/Backend/</code> - Depth 2 - And so on...</p>"},{"location":"tags-phase2-summary/#dynamic-children","title":"Dynamic Children","text":"<p>TagNode dynamically computes children on each access: 1. Child tags: Query database for tags with <code>parent_id == this_tag.id</code> 2. Books: Get books from <code>tag.books</code> relationship 3. Metadata files: Create file nodes for description, color, stats</p>"},{"location":"tags-phase2-summary/#book-symlinks","title":"Book Symlinks","text":"<p>Books appear as symlinks to <code>/books/ID</code>: - Easy to navigate to book details - Consistent with <code>/subjects/</code> and <code>/authors/</code> patterns - Works with all shell commands (cat, grep, etc.)</p>"},{"location":"tags-phase2-summary/#design-decisions","title":"Design Decisions","text":""},{"location":"tags-phase2-summary/#why-not-copy-subjects-pattern","title":"Why Not Copy Subjects Pattern?","text":"<p>Subjects use flat slugs: <code>/subjects/machine-learning/</code></p> <p>Tags use hierarchical paths: <code>/tags/Work/Project-2024/</code></p> <p>Rationale: - Tags are hierarchical by design (parent/child relationships) - Users expect nested folders for hierarchical data - Matches mental model of file organization</p>"},{"location":"tags-phase2-summary/#why-include-metadata-files","title":"Why Include Metadata Files?","text":"<p>Each tag directory has optional files: - <code>description</code> - Tag description - <code>color</code> - Hex color code - <code>stats</code> - Comprehensive statistics</p> <p>Benefits: - Discoverable (appear in <code>ls</code>) - Readable with <code>cat</code> - Consistent with Unix philosophy (everything is a file) - No special commands needed</p>"},{"location":"tags-phase2-summary/#why-books-as-symlinks","title":"Why Books as Symlinks?","text":"<p>Books appear as symlinks (<code>42 -&gt; /books/42</code>) instead of full directories.</p> <p>Benefits: - Avoids duplication (book data lives in <code>/books/</code>) - Single source of truth - Consistent with subjects/authors pattern - Shell naturally follows symlinks</p>"},{"location":"tags-phase2-summary/#limitations-by-design","title":"Limitations (By Design)","text":""},{"location":"tags-phase2-summary/#read-only-phase-2","title":"Read-Only (Phase 2)","text":"<p>Currently tags are read-only in the shell: - \u2705 Can navigate: <code>cd /tags/Work/</code> - \u2705 Can list: <code>ls /tags/Work/</code> - \u2705 Can read metadata: <code>cat /tags/Work/description</code> - \u274c Cannot create tags via shell (yet) - \u274c Cannot add books to tags via shell (yet) - \u274c Cannot delete tags via shell (yet)</p> <p>Phase 3 will add write operations: - <code>cp /books/42 /tags/Work/</code> - Add tag to book - <code>mv /books/42 /tags/Archive/</code> - Move tag (remove old, add new) - <code>rm /tags/Work/Project-2024</code> - Remove tag</p>"},{"location":"tags-phase2-summary/#no-tag-creation-via-mkdir","title":"No Tag Creation via <code>mkdir</code>","text":"<p>Currently cannot do: <code>mkdir /tags/Work/NewProject/</code></p> <p>Rationale: - Tags need to be added to books (not just created) - <code>mkdir</code> doesn't specify which books to tag - Use dedicated CLI commands instead (Phase 4)</p>"},{"location":"tags-phase2-summary/#no-inline-editing","title":"No Inline Editing","text":"<p>Cannot edit tag metadata with <code>vim</code> or similar: - <code>cat /tags/Work/description</code> works \u2705 - <code>vim /tags/Work/description</code> doesn't work \u274c</p> <p>Rationale: - VFS is read-only view of database - Direct editing would bypass validation - Use CLI commands for editing (Phase 4)</p>"},{"location":"tags-phase2-summary/#files-modifiedcreated","title":"Files Modified/Created","text":""},{"location":"tags-phase2-summary/#created","title":"Created:","text":"<ol> <li><code>ebk/vfs/nodes/tags.py</code> - Tag VFS nodes (269 lines)</li> <li><code>docs/tags-phase2-summary.md</code> - This document</li> </ol>"},{"location":"tags-phase2-summary/#modified","title":"Modified:","text":"<ol> <li><code>ebk/vfs/nodes/root.py</code> - Added TagsDirectoryNode to root</li> <li><code>ebk/vfs/nodes/__init__.py</code> - Exported tag node classes</li> <li><code>ebk/repl/shell.py</code> - Updated help to mention <code>/tags/</code></li> </ol>"},{"location":"tags-phase2-summary/#testing","title":"Testing","text":""},{"location":"tags-phase2-summary/#manual-testing-needed","title":"Manual Testing Needed","text":"<p>Test the following scenarios:</p> <ol> <li> <p>Basic navigation:    <pre><code>cd /tags/\nls\ncd Work/\nls\n</code></pre></p> </li> <li> <p>Nested tags:    <pre><code>cd /tags/Work/Project-2024/\nls\n</code></pre></p> </li> <li> <p>Metadata files:    <pre><code>cat /tags/Work/stats\ncat /tags/Work/description\n</code></pre></p> </li> <li> <p>Book symlinks:    <pre><code>cd /tags/Work/\nls 42\ncat 42/title\n</code></pre></p> </li> <li> <p>Empty tags:    <pre><code># Tag with no books or children\ncd /tags/EmptyTag/\nls\n</code></pre></p> </li> <li> <p>Piping with tags:    <pre><code>ls /tags/ | wc -l\nfind /tags/Work/ | grep \"42\"\n</code></pre></p> </li> </ol>"},{"location":"tags-phase2-summary/#automated-tests-future","title":"Automated Tests (Future)","text":"<p>Add to test suite: - <code>tests/test_tag_vfs.py</code> - VFS node tests - Test navigation, listing, metadata files - Test edge cases (empty tags, deep nesting)</p>"},{"location":"tags-phase2-summary/#next-steps-phase-3","title":"Next Steps (Phase 3)","text":"<p>Phase 2 is complete. Ready to proceed to Phase 3: Tag Write Operations</p> <p>Phase 3 Tasks: 1. Implement <code>cp /books/42 /tags/Work/</code> - Add tag to book 2. Implement <code>mv /books/42 /tags/Archive/</code> - Move tag (add new tag) 3. Implement <code>rm /tags/Work/42</code> - Remove tag from book 4. Handle edge cases:    - Tag creation when copying to non-existent tag    - Validation and error messages    - Confirmation prompts for destructive operations</p> <p>Phase 4 Tasks (final): 1. Add CLI commands: <code>ebk tag add</code>, <code>ebk tag remove</code>, <code>ebk tag list</code> 2. Add <code>ebk tag tree</code> for hierarchical visualization 3. Add <code>ebk tag rename</code> for renaming tags 4. Add <code>ebk tag stats</code> for tag statistics 5. Integration with import/export (preserve tags)</p>"},{"location":"tags-phase2-summary/#summary","title":"Summary","text":"<p>Phase 2 successfully implements read-only VFS navigation for hierarchical tags:</p> <p>\u2705 Users can browse tags as nested folders \u2705 Navigate with <code>cd /tags/Work/Project-2024/</code> \u2705 List contents with <code>ls</code> \u2705 Read metadata with <code>cat stats</code> \u2705 Books appear as symlinks to <code>/books/ID</code> \u2705 Unlimited nesting depth supported \u2705 Integrated with existing shell commands</p> <p>The tag browsing experience is now on par with authors and subjects, but with the added power of hierarchical organization!</p>"},{"location":"tags-phase3-summary/","title":"Hierarchical Tags - Phase 3 Implementation Summary","text":""},{"location":"tags-phase3-summary/#overview","title":"Overview","text":"<p>Completed Phase 3 of hierarchical tagging system: Tag write operations in shell.</p> <p>Users can now manage tags directly through the shell using familiar Unix commands (<code>cp</code>, <code>mv</code>, <code>rm</code>), making tag management intuitive and integrated with the VFS.</p>"},{"location":"tags-phase3-summary/#what-was-implemented","title":"What Was Implemented","text":""},{"location":"tags-phase3-summary/#new-shell-commands-ebkreplshellpy","title":"New Shell Commands (<code>ebk/repl/shell.py</code>)","text":""},{"location":"tags-phase3-summary/#1-cp-add-tag-to-book","title":"1. cp - Add Tag to Book","text":"<p>Copy command adds a tag to a book without removing existing tags.</p> <p>Signature: <pre><code>def cmd_cp(self, args: List[str], stdin: Optional[str] = None, silent: bool = False) -&gt; Optional[str]\n</code></pre></p> <p>Usage: <pre><code>cp /books/42 /tags/Work/\ncp /books/42 /tags/Work/Project-2024/\ncp /tags/Archive/42 /tags/Reading-List/  # Can copy from one tag to another\n</code></pre></p> <p>Behavior: - Extracts book ID from source path (handles <code>/books/42</code> or <code>/tags/Work/42</code>) - Extracts tag path from destination (<code>/tags/Work/</code> \u2192 <code>Work</code>) - Calls <code>tag_service.add_tag_to_book(book, tag_path)</code> - Creates tag hierarchy automatically if doesn't exist - Shows success message with book title</p> <p>Error Handling: - Source not found - Invalid source (must be a book) - Invalid destination (must be <code>/tags/...</code>) - Book not found in database - Database errors</p>"},{"location":"tags-phase3-summary/#2-mv-move-book-between-tags","title":"2. mv - Move Book Between Tags","text":"<p>Move command removes one tag and adds another (atomic operation).</p> <p>Signature: <pre><code>def cmd_mv(self, args: List[str], stdin: Optional[str] = None, silent: bool = False) -&gt; Optional[str]\n</code></pre></p> <p>Usage: <pre><code>mv /tags/Work/42 /tags/Archive/\nmv /tags/Work/Project-2024/42 /tags/Work/Reference/\n</code></pre></p> <p>Behavior: - Requires both source and destination to be tag paths - Extracts source tag path and book ID from source - Removes old tag from book - Adds new tag to book - Shows warning if book didn't have source tag - Shows success message</p> <p>Error Handling: - Source must be tag path with book ID - Destination must be tag path - Invalid book ID - Book not found - Database errors</p>"},{"location":"tags-phase3-summary/#3-rm-remove-tag-or-delete-tag","title":"3. rm - Remove Tag or Delete Tag","text":"<p>Remove command has dual behavior: - Remove tag from book: <code>rm /tags/Work/42</code> - Delete tag entirely: <code>rm /tags/Work/</code> (with <code>-r</code> for children)</p> <p>Signature: <pre><code>def cmd_rm(self, args: List[str], stdin: Optional[str] = None, silent: bool = False) -&gt; Optional[str]\n</code></pre></p> <p>Usage: <pre><code># Remove tag from specific book\nrm /tags/Work/42\n\n# Delete tag (only if no children)\nrm /tags/OldTag/\n\n# Delete tag and all children recursively\nrm -r /tags/OldProject/\n</code></pre></p> <p>Behavior: - Parses <code>-r</code> flag for recursive deletion - Determines if path is book (ends with number) or tag (directory) - If book: Removes tag from that specific book - If tag: Deletes the tag itself   - Checks for children if no <code>-r</code> flag   - Cascades deletion if <code>-r</code> flag set</p> <p>Error Handling: - Path must be tag path - Tag with children requires <code>-r</code> flag - Tag not found - Book not found - Database errors - Helpful hints for common mistakes</p>"},{"location":"tags-phase3-summary/#command-registration","title":"Command Registration","text":"<p>Added to command registry in <code>__init__</code>: <pre><code>self.commands = {\n    # ... existing commands ...\n    \"cp\": self.cmd_cp,\n    \"mv\": self.cmd_mv,\n    \"rm\": self.cmd_rm,\n    # ...\n}\n</code></pre></p>"},{"location":"tags-phase3-summary/#help-documentation","title":"Help Documentation","text":"<p>Updated help command to document new commands: <pre><code>cp &lt;src&gt; &lt;dest&gt;    Add tag to book (cp /books/42 /tags/Work/)\nmv &lt;src&gt; &lt;dest&gt;    Move book between tags\nrm [-r] &lt;path&gt;     Remove tag from book or delete tag\n</code></pre></p>"},{"location":"tags-phase3-summary/#usage-examples","title":"Usage Examples","text":""},{"location":"tags-phase3-summary/#adding-tags-to-books","title":"Adding Tags to Books","text":"<pre><code># Add \"Work\" tag to book 42\nebk:/$ cp /books/42 /tags/Work/\n\u2713 Added tag 'Work' to book 42\n  Book: The Art of Computer Programming\n\n# Add nested tag (creates hierarchy automatically)\nebk:/$ cp /books/42 /tags/Work/Project-2024/\n\u2713 Added tag 'Work/Project-2024' to book 42\n  Book: The Art of Computer Programming\n\n# Copy from one tag to another\nebk:/tags/Work$ cp 42 /tags/Reading-List/\n\u2713 Added tag 'Reading-List' to book 42\n  Book: The Art of Computer Programming\n</code></pre>"},{"location":"tags-phase3-summary/#moving-books-between-tags","title":"Moving Books Between Tags","text":"<pre><code># Move book from Work to Archive\nebk:/$ mv /tags/Work/42 /tags/Archive/\n\u2713 Moved book 42 from 'Work' to 'Archive'\n  Book: The Art of Computer Programming\n\n# Move between nested tags\nebk:/$ mv /tags/Work/Project-2024/42 /tags/Work/Completed/\n\u2713 Moved book 42 from 'Work/Project-2024' to 'Work/Completed'\n  Book: The Art of Computer Programming\n\n# Warning if book didn't have source tag\nebk:/$ mv /tags/NonExistent/42 /tags/Work/\nWarning: Book didn't have tag 'NonExistent'\n\u2713 Moved book 42 from 'NonExistent' to 'Work'\n</code></pre>"},{"location":"tags-phase3-summary/#removing-tags","title":"Removing Tags","text":"<pre><code># Remove tag from specific book\nebk:/$ rm /tags/Work/42\n\u2713 Removed tag 'Work' from book 42\n  Book: The Art of Computer Programming\n\n# Book didn't have that tag\nebk:/$ rm /tags/Work/99\nBook 99 didn't have tag 'Work'\n\n# Delete empty tag\nebk:/$ rm /tags/EmptyTag/\n\u2713 Deleted tag 'EmptyTag'\n\n# Try to delete tag with children (fails)\nebk:/$ rm /tags/Work/\nError: Tag 'Work' has 2 children. Use delete_children=True to delete them too.\nHint: Use 'rm -r /tags/Work/' to delete tag and its children\n\n# Delete tag with children recursively\nebk:/$ rm -r /tags/OldProject/\n\u2713 Deleted tag 'OldProject'\n</code></pre>"},{"location":"tags-phase3-summary/#complex-workflows","title":"Complex Workflows","text":"<pre><code># Find books and add tag to all matches\nebk:/$ find author:Knuth\n42    The Art of Computer Programming, Vol. 1\n137   The Art of Computer Programming, Vol. 2\nebk:/$ cp /books/42 /tags/Reference/\nebk:/$ cp /books/137 /tags/Reference/\n\n# Reorganize tags\nebk:/$ mv /tags/To-Read/42 /tags/Reading-List/\nebk:/$ mv /tags/Reading-List/42 /tags/Currently-Reading/\nebk:/$ mv /tags/Currently-Reading/42 /tags/Finished/\n\n# Clean up old tags\nebk:/$ rm -r /tags/2023-Projects/\n</code></pre>"},{"location":"tags-phase3-summary/#design-decisions","title":"Design Decisions","text":""},{"location":"tags-phase3-summary/#why-cp-for-adding-tags","title":"Why <code>cp</code> for Adding Tags?","text":"<p>In Unix, <code>cp</code> creates a copy without removing the original. For tags, this translates to: - Book remains in original location (<code>/books/42</code>) - Tag is \"copied\" to the book (book now has this tag) - Book can have multiple tags (like being in multiple places)</p> <p>Alternative considered: <code>ln</code> (link) command - Rejected: More confusing metaphor for users - <code>cp</code> is more familiar and intuitive</p>"},{"location":"tags-phase3-summary/#why-mv-for-changing-tags","title":"Why <code>mv</code> for Changing Tags?","text":"<p><code>mv</code> removes from one location and adds to another: - Removes source tag - Adds destination tag - Atomic operation (both succeed or both fail)</p> <p>Use case: Reorganizing tags, moving books between categories</p>"},{"location":"tags-phase3-summary/#why-dual-behavior-for-rm","title":"Why Dual Behavior for <code>rm</code>?","text":"<p>Unix <code>rm</code> removes files or directories. For tags: - File-like: Book within tag \u2192 Remove tag from book - Directory-like: Tag itself \u2192 Delete tag</p> <p>Path determines behavior: - <code>/tags/Work/42</code> (ends with number) \u2192 Remove tag from book - <code>/tags/Work/</code> (directory) \u2192 Delete tag</p> <p>Recursive flag: - <code>-r</code> required to delete tag with children (safety measure)</p>"},{"location":"tags-phase3-summary/#why-auto-create-tags-in-cp","title":"Why Auto-Create Tags in <code>cp</code>?","text":"<p>When copying to non-existent tag path: <pre><code>cp /books/42 /tags/NewTag/SubTag/\n</code></pre></p> <p>Behavior: Creates <code>NewTag</code> and <code>NewTag/SubTag</code> automatically</p> <p>Rationale: - Matches <code>get_or_create_tag()</code> service method - Reduces friction (no need to pre-create tags) - Consistent with mkdir -p behavior - User-friendly for workflow</p>"},{"location":"tags-phase3-summary/#error-messages-and-hints","title":"Error Messages and Hints","text":"<p>All commands provide: - Clear error messages: What went wrong - Helpful hints: How to fix it - Success confirmations: What was done - Context: Book title when available</p> <p>Examples: <pre><code>Error: Tag 'Work' has 2 children. Use delete_children=True to delete them too.\nHint: Use 'rm -r /tags/Work/' to delete tag and its children\n</code></pre></p>"},{"location":"tags-phase3-summary/#implementation-details","title":"Implementation Details","text":""},{"location":"tags-phase3-summary/#path-parsing","title":"Path Parsing","text":"<p>All commands parse VFS paths to extract: - Book ID (integer at end of path or after <code>/books/</code>) - Tag path (everything after <code>/tags/</code>)</p> <p>Robust parsing: <pre><code># Extract book ID from various formats\npath_parts = source_path.strip('/').split('/')\n\nif path_parts[0] == 'books' and len(path_parts) &gt;= 2:\n    book_id = int(path_parts[1])  # /books/42\nelif path_parts[0] == 'tags':\n    book_id = int(path_parts[-1])  # /tags/Work/42\n</code></pre></p>"},{"location":"tags-phase3-summary/#silent-mode-support","title":"Silent Mode Support","text":"<p>All commands support <code>silent</code> parameter: - Used in pipelines to suppress intermediate output - Consistent with other shell commands - Returns <code>None</code> (no stdout for piping)</p>"},{"location":"tags-phase3-summary/#transaction-safety","title":"Transaction Safety","text":"<p>Uses <code>TagService</code> which handles database sessions: - Auto-commit on success - Auto-rollback on error - Session management via SQLAlchemy</p>"},{"location":"tags-phase3-summary/#testing","title":"Testing","text":""},{"location":"tags-phase3-summary/#manual-testing-scenarios","title":"Manual Testing Scenarios","text":"<ol> <li>Add tags to books:</li> <li>From <code>/books/</code> path</li> <li>From <code>/tags/</code> path</li> <li>To existing tags</li> <li> <p>To new tags (auto-create)</p> </li> <li> <p>Move between tags:</p> </li> <li>Simple move</li> <li>Nested tag move</li> <li> <p>Non-existent source tag</p> </li> <li> <p>Remove tags:</p> </li> <li>Remove from book</li> <li>Delete empty tag</li> <li>Delete tag with children (should fail)</li> <li> <p>Delete tag with <code>-r</code> flag</p> </li> <li> <p>Error cases:</p> </li> <li>Invalid paths</li> <li>Non-existent books</li> <li>Non-existent tags</li> <li>Wrong path types</li> </ol>"},{"location":"tags-phase3-summary/#automated-tests-future","title":"Automated Tests (Future)","text":"<p>Add to test suite: - <code>tests/test_tag_shell_commands.py</code> - Test each command with various path formats - Test error conditions - Test edge cases - Test silent mode</p>"},{"location":"tags-phase3-summary/#limitations","title":"Limitations","text":""},{"location":"tags-phase3-summary/#no-mkdir-for-tag-creation","title":"No <code>mkdir</code> for Tag Creation","text":"<p>Cannot create empty tags with <code>mkdir /tags/NewTag/</code></p> <p>Rationale: - Tags should be created when adding to books - Empty tags have no purpose - Use CLI commands for batch tag creation (Phase 4)</p>"},{"location":"tags-phase3-summary/#no-tag-renaming-via-mv","title":"No Tag Renaming via <code>mv</code>","text":"<p>Cannot rename tags with <code>mv /tags/OldName/ /tags/NewName/</code></p> <p>Rationale: - <code>mv</code> is for moving books between tags - Renaming tags is complex (updates all children paths) - Use <code>ebk tag rename</code> CLI command instead (Phase 4)</p>"},{"location":"tags-phase3-summary/#no-batch-operations","title":"No Batch Operations","text":"<p>Cannot do: <code>cp /books/* /tags/Work/</code></p> <p>Rationale: - Shell doesn't support glob expansion in VFS paths - Use loops or CLI commands for batch operations - Keep shell commands simple</p>"},{"location":"tags-phase3-summary/#files-modified","title":"Files Modified","text":""},{"location":"tags-phase3-summary/#modified","title":"Modified:","text":"<ol> <li><code>ebk/repl/shell.py</code> - Added cmd_cp, cmd_mv, cmd_rm methods (277 lines added)</li> <li><code>ebk/repl/shell.py</code> - Updated command registry</li> <li><code>ebk/repl/shell.py</code> - Updated help documentation</li> </ol>"},{"location":"tags-phase3-summary/#summary","title":"Summary","text":"<p>Phase 3 successfully implements write operations for tags:</p> <p>\u2705 <code>cp</code> command adds tags to books \u2705 <code>mv</code> command moves books between tags \u2705 <code>rm</code> command removes tags or deletes tags \u2705 Auto-creates tag hierarchy when needed \u2705 Clear error messages and helpful hints \u2705 Integrated with VFS navigation \u2705 Silent mode for piping support \u2705 Documented in help system</p> <p>Users can now fully manage tags through the shell using intuitive Unix-like commands!</p>"},{"location":"tags-phase3-summary/#next-steps-phase-4-final","title":"Next Steps (Phase 4 - Final)","text":"<p>Phase 3 is complete. Ready to proceed to Phase 4: CLI Commands for Tag Management</p> <p>Phase 4 Tasks: 1. Add <code>ebk tag list</code> - List all tags or books with tag 2. Add <code>ebk tag tree</code> - Show hierarchical tag tree 3. Add <code>ebk tag add &lt;book-id&gt; &lt;tag&gt;</code> - Add tag to book (CLI) 4. Add <code>ebk tag remove &lt;book-id&gt; &lt;tag&gt;</code> - Remove tag from book (CLI) 5. Add <code>ebk tag rename &lt;old&gt; &lt;new&gt;</code> - Rename tag and update subtree 6. Add <code>ebk tag stats [tag]</code> - Show tag statistics 7. Add <code>ebk tag delete [-r] &lt;tag&gt;</code> - Delete tag (CLI version) 8. Integration with import/export (preserve tags in metadata)</p>"},{"location":"tags-phase4-summary/","title":"Hierarchical Tags - Phase 4 Implementation Summary","text":""},{"location":"tags-phase4-summary/#overview","title":"Overview","text":"<p>Completed Phase 4 (final phase) of hierarchical tagging system: CLI commands for tag management.</p> <p>Users can now manage tags from the command line using the <code>ebk tag</code> command group, providing a complete interface for tag operations outside the interactive shell.</p>"},{"location":"tags-phase4-summary/#what-was-implemented","title":"What Was Implemented","text":""},{"location":"tags-phase4-summary/#new-command-group-ebk-tag","title":"New Command Group: <code>ebk tag</code>","text":"<p>Created a dedicated command group with 7 comprehensive subcommands for tag management.</p>"},{"location":"tags-phase4-summary/#1-ebk-tag-list-list-tags-or-tagged-books","title":"1. <code>ebk tag list</code> - List Tags or Tagged Books","text":"<p>List all tags or show books with a specific tag.</p> <p>Usage: <pre><code>ebk tag list ~/my-library                    # List all tags\nebk tag list ~/my-library -t Work            # Books with \"Work\" tag\nebk tag list ~/my-library -t Work -s         # Include subtags\n</code></pre></p> <p>Output: - All tags: Table showing path, book count, subtag count, description - Specific tag: Table showing book ID, title, authors</p> <p>Options: - <code>--tag, -t</code>: Filter by specific tag - <code>--subtags, -s</code>: Include books from subtags (hierarchical query)</p>"},{"location":"tags-phase4-summary/#2-ebk-tag-tree-display-hierarchical-tree","title":"2. <code>ebk tag tree</code> - Display Hierarchical Tree","text":"<p>Show tags in a hierarchical tree visualization.</p> <p>Usage: <pre><code>ebk tag tree ~/my-library                    # Show all tags as tree\nebk tag tree ~/my-library -r Work            # Show Work subtree only\n</code></pre></p> <p>Output: <pre><code>Tag Tree\n\n\u251c\u2500\u2500 Work (5 books)\n\u2502   \u251c\u2500\u2500 Project-2024 (3 books)\n\u2502   \u2514\u2500\u2500 Reference (2 books)\n\u251c\u2500\u2500 Reading-List (10 books)\n\u2502   \u251c\u2500\u2500 To-Read (7 books)\n\u2502   \u2514\u2500\u2500 Currently-Reading (3 books)\n\u2514\u2500\u2500 Archive (15 books)\n</code></pre></p> <p>Features: - Unicode tree characters (\u251c\u2500\u2500, \u2514\u2500\u2500, \u2502) - Book counts in parentheses - Colored output - Can show specific subtree with <code>--root</code></p>"},{"location":"tags-phase4-summary/#3-ebk-tag-add-add-tag-to-book","title":"3. <code>ebk tag add</code> - Add Tag to Book","text":"<p>Add a tag to a specific book.</p> <p>Usage: <pre><code>ebk tag add 42 Work ~/my-library\nebk tag add 42 Work/Project-2024 ~/my-library -d \"2024 projects\"\nebk tag add 42 Reading-List ~/my-library -c \"#3498db\"\n</code></pre></p> <p>Options: - <code>--description, -d</code>: Set tag description (for new tags) - <code>--color, -c</code>: Set tag color in hex format</p> <p>Behavior: - Auto-creates tag hierarchy if doesn't exist - Updates metadata if provided - Shows success message with book title</p>"},{"location":"tags-phase4-summary/#4-ebk-tag-remove-remove-tag-from-book","title":"4. <code>ebk tag remove</code> - Remove Tag from Book","text":"<p>Remove a tag from a specific book.</p> <p>Usage: <pre><code>ebk tag remove 42 Work ~/my-library\nebk tag remove 42 Work/Project-2024 ~/my-library\n</code></pre></p> <p>Behavior: - Removes tag-book association - Tag itself remains (doesn't delete tag) - Shows warning if book didn't have that tag</p>"},{"location":"tags-phase4-summary/#5-ebk-tag-rename-rename-tag","title":"5. <code>ebk tag rename</code> - Rename Tag","text":"<p>Rename a tag and update all descendant paths automatically.</p> <p>Usage: <pre><code>ebk tag rename Work Archive ~/my-library\nebk tag rename Work/Old Work/Completed ~/my-library\n</code></pre></p> <p>Behavior: - Updates tag path - Updates all child tag paths (e.g., <code>Work/Sub</code> \u2192 <code>Archive/Sub</code>) - Shows number of books and subtags affected - Validates new path doesn't already exist</p>"},{"location":"tags-phase4-summary/#6-ebk-tag-delete-delete-tag","title":"6. <code>ebk tag delete</code> - Delete Tag","text":"<p>Delete a tag entirely.</p> <p>Usage: <pre><code>ebk tag delete OldTag ~/my-library\nebk tag delete OldProject ~/my-library -r          # Delete with children\nebk tag delete Archive ~/my-library -r -f          # Skip confirmation\n</code></pre></p> <p>Options: - <code>--recursive, -r</code>: Delete tag and all children - <code>--force, -f</code>: Skip confirmation prompt</p> <p>Behavior: - Requires <code>-r</code> flag to delete tag with children (safety) - Shows confirmation prompt unless <code>-f</code> used - Displays book count and subtag count before deletion - Removes all book-tag associations</p>"},{"location":"tags-phase4-summary/#7-ebk-tag-stats-show-statistics","title":"7. <code>ebk tag stats</code> - Show Statistics","text":"<p>Display tag statistics (overall or for specific tag).</p> <p>Usage: <pre><code>ebk tag stats ~/my-library                    # Overall statistics\nebk tag stats ~/my-library -t Work            # Stats for Work tag\n</code></pre></p> <p>Overall statistics: <pre><code>Tag Statistics\n\nTotal tags:    25\nRoot tags:     5\nTagged books:  42\n\nMost Popular Tags:\n  Work/Project-2024                           12 books\n  Reading-List/To-Read                        10 books\n  Archive                                      8 books\n  Work/Reference                               5 books\n</code></pre></p> <p>Specific tag statistics: <pre><code>Tag Statistics: Work/Project-2024\n\nName:        Project-2024\nPath:        Work/Project-2024\nDepth:       1\nBooks:       12\nSubtags:     0\nDescription: 2024 project books\nColor:       #FF5733\nCreated:     2025-01-15T10:30:00\n</code></pre></p>"},{"location":"tags-phase4-summary/#implementation-details","title":"Implementation Details","text":""},{"location":"tags-phase4-summary/#command-group-registration","title":"Command Group Registration","text":"<p>Added to CLI application: <pre><code>tag_app = typer.Typer(help=\"Manage hierarchical tags for organizing books\")\napp.add_typer(tag_app, name=\"tag\")\n</code></pre></p>"},{"location":"tags-phase4-summary/#consistent-error-handling","title":"Consistent Error Handling","text":"<p>All commands follow consistent error handling pattern: - Library path validation - Database connection errors - Tag/book not found errors - Clear error messages - Helpful hints for common mistakes</p>"},{"location":"tags-phase4-summary/#rich-formatting","title":"Rich Formatting","text":"<p>Uses Rich library for: - Colored output (success/error/warning) - Table formatting - Tree visualization - Progress indicators</p>"},{"location":"tags-phase4-summary/#integration-with-tagservice","title":"Integration with TagService","text":"<p>All commands use <code>TagService</code> for operations: - Consistent business logic - Proper transaction handling - Auto-commit on success - Auto-rollback on error</p>"},{"location":"tags-phase4-summary/#usage-examples","title":"Usage Examples","text":""},{"location":"tags-phase4-summary/#managing-tags-from-cli","title":"Managing Tags from CLI","text":"<pre><code># List all tags\n$ ebk tag list ~/my-library\nAll Tags\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Path               \u2502 Books \u2502 Subtags \u2502 Description      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Work               \u2502     5 \u2502       2 \u2502 Work-related     \u2502\n\u2502 Work/Project-2024  \u2502     3 \u2502       0 \u2502 2024 projects    \u2502\n\u2502 Reading-List       \u2502    10 \u2502       2 \u2502                  \u2502\n\u2502 Archive            \u2502    15 \u2502       0 \u2502 Completed books  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nTotal: 4 tags\n\n# Show tree\n$ ebk tag tree ~/my-library\nTag Tree\n\n\u251c\u2500\u2500 Work (5 books)\n\u2502   \u251c\u2500\u2500 Project-2024 (3 books)\n\u2502   \u2514\u2500\u2500 Reference (2 books)\n\u2514\u2500\u2500 Reading-List (10 books)\n\n# Add tag to book\n$ ebk tag add 42 Work/Project-2024 ~/my-library\n\u2713 Added tag 'Work/Project-2024' to book 42\n  Book: The Art of Computer Programming\n\n# List books with tag\n$ ebk tag list ~/my-library -t Work -s\nBooks with tag 'Work'\n\u250c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 ID \u2502 Title                           \u2502 Authors      \u2502\n\u251c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 42 \u2502 The Art of Computer Programming \u2502 Knuth        \u2502\n\u2502 137\u2502 Concrete Mathematics            \u2502 Knuth et al. \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nTotal: 2 books\n\n# Rename tag\n$ ebk tag rename Work/Project-2024 Work/Completed ~/my-library\n\u2713 Renamed tag 'Work/Project-2024' \u2192 'Work/Completed'\n  Books: 3\n\n# Show statistics\n$ ebk tag stats ~/my-library -t Work\nTag Statistics: Work\n\nName:        Work\nPath:        Work\nDepth:       0\nBooks:       5\nSubtags:     2\nDescription: Work-related books\nColor:       #3498db\nCreated:     2025-01-15T10:30:00\n\n# Delete tag with confirmation\n$ ebk tag delete OldProject ~/my-library -r\nAbout to delete tag: OldProject\n  Books: 5\n  Subtags: 2\nAre you sure? [y/N]: y\n\u2713 Deleted tag 'OldProject'\n</code></pre>"},{"location":"tags-phase4-summary/#batch-operations-with-scripts","title":"Batch Operations with Scripts","text":"<pre><code>#!/bin/bash\n# Tag all books by a specific author\n\nLIBRARY=~/my-library\nAUTHOR=\"Knuth\"\nTAG=\"Reference/CS-Classics\"\n\n# Find books by author and tag them\nebk list $LIBRARY --author \"$AUTHOR\" | while read -r line; do\n    BOOK_ID=$(echo $line | awk '{print $1}')\n    ebk tag add $BOOK_ID \"$TAG\" $LIBRARY\ndone\n</code></pre>"},{"location":"tags-phase4-summary/#integration-with-other-commands","title":"Integration with Other Commands","text":"<pre><code># Find books and tag them\nebk search \"machine learning\" ~/my-library | \\\n  grep \"ID:\" | \\\n  awk '{print $2}' | \\\n  xargs -I {} ebk tag add {} ML/Intro ~/my-library\n\n# Export books with specific tag\nebk tag list ~/my-library -t Work | \\\n  # ... process and export ...\n</code></pre>"},{"location":"tags-phase4-summary/#design-decisions","title":"Design Decisions","text":""},{"location":"tags-phase4-summary/#why-separate-list-and-tree-commands","title":"Why Separate <code>list</code> and <code>tree</code> Commands?","text":"<p><code>list</code>: Flat table view - Good for filtering (show books with tag) - Good for scanning (all tags at once) - Supports subtag queries</p> <p><code>tree</code>: Hierarchical view - Good for understanding structure - Good for navigation planning - Shows relationships clearly</p> <p>Alternative considered: Single command with <code>--tree</code> flag - Rejected: Different output formats are fundamentally different use cases - Separate commands are clearer</p>"},{"location":"tags-phase4-summary/#why-addremove-instead-of-taguntag","title":"Why <code>add/remove</code> Instead of <code>tag/untag</code>?","text":"<p>Chose <code>add</code>/<code>remove</code> for consistency: - Matches shell <code>cp</code>/<code>rm</code> semantics - Clearer action verbs - Matches <code>ebk import add</code> pattern</p>"},{"location":"tags-phase4-summary/#why-confirmation-for-delete","title":"Why Confirmation for <code>delete</code>?","text":"<p>Tag deletion is destructive and affects multiple books: - Shows what will be deleted (books, subtags) - Requires explicit confirmation - Can skip with <code>-f</code> for scripts - Safety-first approach</p>"},{"location":"tags-phase4-summary/#why-allow-metadata-in-add","title":"Why Allow Metadata in <code>add</code>?","text":"<p>Convenience: Create and configure tag in one command: <pre><code>ebk tag add 42 NewTag ~/lib -d \"Description\" -c \"#FF5733\"\n</code></pre></p> <p>Alternative would require separate commands: <pre><code>ebk tag create NewTag ~/lib -d \"Description\" -c \"#FF5733\"\nebk tag add 42 NewTag ~/lib\n</code></pre></p>"},{"location":"tags-phase4-summary/#why-subtags-flag-in-list","title":"Why <code>--subtags</code> Flag in <code>list</code>?","text":"<p>Hierarchical queries are common but not always desired: - Default: Books with exact tag only - With <code>-s</code>: Books with tag OR any descendant tags - Explicit opt-in for hierarchical behavior</p>"},{"location":"tags-phase4-summary/#files-modified","title":"Files Modified","text":""},{"location":"tags-phase4-summary/#modified","title":"Modified:","text":"<ol> <li><code>ebk/cli.py</code> - Added tag_app command group and 7 subcommands (490 lines added)</li> <li><code>ebk/cli.py</code> - Updated about command to mention tags</li> </ol>"},{"location":"tags-phase4-summary/#integration-points","title":"Integration Points","text":""},{"location":"tags-phase4-summary/#with-existing-commands","title":"With Existing Commands","text":"<p>Tag commands integrate with: - <code>ebk list</code> - Can filter by tags (future enhancement) - <code>ebk search</code> - Can search within tagged books (future) - <code>ebk stats</code> - Shows tag statistics (future) - <code>ebk export</code> - Can export with tag metadata (future)</p>"},{"location":"tags-phase4-summary/#with-shell-commands","title":"With Shell Commands","text":"<p>CLI commands complement shell operations: - CLI: Batch operations, scripts, automation - Shell: Interactive exploration, navigation - Both use same TagService backend</p>"},{"location":"tags-phase4-summary/#testing","title":"Testing","text":""},{"location":"tags-phase4-summary/#manual-testing-checklist","title":"Manual Testing Checklist","text":"<ul> <li>[x] <code>ebk tag list</code> - List all tags</li> <li>[x] <code>ebk tag list -t Work</code> - List books with tag</li> <li>[x] <code>ebk tag list -t Work -s</code> - Include subtags</li> <li>[x] <code>ebk tag tree</code> - Show tree</li> <li>[x] <code>ebk tag tree -r Work</code> - Show subtree</li> <li>[x] <code>ebk tag add 42 Work ~/lib</code> - Add tag</li> <li>[x] <code>ebk tag remove 42 Work ~/lib</code> - Remove tag</li> <li>[x] <code>ebk tag rename Work Archive ~/lib</code> - Rename tag</li> <li>[x] <code>ebk tag delete OldTag ~/lib</code> - Delete tag</li> <li>[x] <code>ebk tag delete OldTag ~/lib -r</code> - Delete with children</li> <li>[x] <code>ebk tag stats ~/lib</code> - Overall stats</li> <li>[x] <code>ebk tag stats ~/lib -t Work</code> - Tag-specific stats</li> </ul>"},{"location":"tags-phase4-summary/#error-cases","title":"Error Cases","text":"<ul> <li>[ ] Library not found</li> <li>[ ] Book not found</li> <li>[ ] Tag not found</li> <li>[ ] Tag already exists (rename)</li> <li>[ ] Tag has children (delete without <code>-r</code>)</li> <li>[ ] Invalid color format</li> <li>[ ] Invalid tag path</li> </ul>"},{"location":"tags-phase4-summary/#automated-tests-future","title":"Automated Tests (Future)","text":"<p>Add to test suite: - <code>tests/test_tag_cli.py</code> - CLI command tests - Test each command with various inputs - Test error conditions - Test confirmation prompts - Test table/tree formatting</p>"},{"location":"tags-phase4-summary/#summary","title":"Summary","text":"<p>Phase 4 successfully implements comprehensive CLI commands for tag management:</p> <p>\u2705 7 complete subcommands: list, tree, add, remove, rename, delete, stats \u2705 Rich formatting with tables and tree visualization \u2705 Hierarchical queries with <code>--subtags</code> flag \u2705 Safety features (confirmations, warnings) \u2705 Consistent error handling and helpful messages \u2705 Batch operation support for scripts \u2705 Integration with existing TagService \u2705 Comprehensive documentation and examples</p> <p>The hierarchical tagging system is now complete with full CLI and shell support!</p>"},{"location":"tags-phase4-summary/#future-enhancements-optional","title":"Future Enhancements (Optional)","text":"<p>Potential future improvements:</p> <ol> <li>Import/Export Integration</li> <li>Preserve tags when exporting to formats that support them</li> <li> <p>Import tags from metadata files</p> </li> <li> <p>Bulk Operations</p> </li> <li><code>ebk tag add-bulk &lt;tag&gt; &lt;book-ids&gt;</code> - Add tag to multiple books</li> <li> <p><code>ebk tag copy &lt;src-tag&gt; &lt;dest-tag&gt;</code> - Copy all books to new tag</p> </li> <li> <p>Smart Queries</p> </li> <li><code>ebk list --tag Work</code> - Filter books by tag</li> <li> <p><code>ebk search \"query\" --tag Work</code> - Search within tagged books</p> </li> <li> <p>Tag Aliases</p> </li> <li>Create shortcuts for long tag paths</li> <li> <p><code>ebk tag alias add w Work/Project-2024</code></p> </li> <li> <p>Tag Templates</p> </li> <li>Predefined tag hierarchies</li> <li> <p><code>ebk tag template apply reading-workflow</code></p> </li> <li> <p>Tag Colors in Tree</p> </li> <li>Show tag colors in tree visualization</li> <li> <p>Colorize based on tag metadata</p> </li> <li> <p>Tag Import from Files</p> </li> <li><code>ebk tag import tags.csv ~/lib</code></li> <li>Batch tag creation from file</li> </ol>"},{"location":"tags-phase4-summary/#complete-feature-summary","title":"Complete Feature Summary","text":"<p>The hierarchical tagging system now provides:</p>"},{"location":"tags-phase4-summary/#phase-1-database-service-layer","title":"Phase 1: Database &amp; Service Layer \u2705","text":"<ul> <li>Tag model with hierarchical relationships</li> <li>TagService with full CRUD operations</li> <li>Database migration system</li> <li>100% test coverage</li> </ul>"},{"location":"tags-phase4-summary/#phase-2-vfs-navigation","title":"Phase 2: VFS Navigation \u2705","text":"<ul> <li><code>/tags/</code> directory in shell</li> <li>Hierarchical browsing</li> <li>Book symlinks</li> <li>Metadata files</li> </ul>"},{"location":"tags-phase4-summary/#phase-3-shell-write-operations","title":"Phase 3: Shell Write Operations \u2705","text":"<ul> <li><code>cp</code> - Add tag to book</li> <li><code>mv</code> - Move book between tags</li> <li><code>rm</code> - Remove tag or delete tag</li> </ul>"},{"location":"tags-phase4-summary/#phase-4-cli-commands","title":"Phase 4: CLI Commands \u2705","text":"<ul> <li><code>ebk tag list</code> - List tags/books</li> <li><code>ebk tag tree</code> - Show hierarchy</li> <li><code>ebk tag add/remove</code> - Manage book tags</li> <li><code>ebk tag rename/delete</code> - Manage tags</li> <li><code>ebk tag stats</code> - Show statistics</li> </ul> <p>Total Implementation: - 4 phases complete - ~2000 lines of code - 120 comprehensive tests - Full CLI and shell integration - Production-ready feature set</p>"},{"location":"about/changelog/","title":"Changelog","text":"<p>Project changelog and release notes.</p>"},{"location":"about/changelog/#v031-2025-01-14","title":"v0.3.1 (2025-01-14)","text":""},{"location":"about/changelog/#new-features","title":"New Features","text":"<ul> <li>\ud83d\udd0d Advanced Search: Field-specific queries with boolean logic</li> <li>Field searches: <code>title:</code>, <code>author:</code>, <code>tag:</code>, <code>description:</code>, <code>text:</code></li> <li>Filter fields: <code>language:</code>, <code>format:</code>, <code>rating:</code>, <code>favorite:</code>, <code>status:</code></li> <li>Boolean operators: <code>AND</code> (implicit), <code>OR</code>, <code>NOT</code>/<code>-prefix</code></li> <li>Rating comparisons: <code>rating:&gt;=4</code>, <code>rating:3-5</code></li> <li>Phrase searches: <code>\"exact phrase\"</code></li> <li>\ud83d\udcc4 HTML Export Pagination: 50 books per page with navigation controls</li> <li>URL state tracking for bookmarkable pages</li> <li>Page numbers in URL query parameters</li> <li>Previous/Next buttons with page number links</li> <li>\ud83d\udccb Cover Copying: <code>--copy</code> flag now copies both files AND covers</li> </ul>"},{"location":"about/changelog/#improvements","title":"Improvements","text":"<ul> <li>Search parser with FTS5 column-specific queries (<code>title:term</code>)</li> <li>Author and subject filtering via SQL JOINs (not in FTS table)</li> <li>HTML export with URL-based state management (filters, search, page)</li> <li>Fixed <code>ExtractedText.content</code> attribute name (was incorrectly using <code>full_text</code>)</li> <li>Added missing <code>Library.add_subject()</code> method for metadata enrichment</li> </ul>"},{"location":"about/changelog/#bug-fixes","title":"Bug Fixes","text":"<ul> <li>Fixed <code>ebk enrich</code> command attribute error with extracted text</li> <li>Fixed HTML export <code>--copy</code> not copying cover images</li> <li>Fixed field searches not working (FTS5 column prefixes)</li> </ul>"},{"location":"about/changelog/#documentation","title":"Documentation","text":"<ul> <li>Comprehensive search guide with all syntax and examples</li> <li>Updated README with advanced search features</li> <li>Import/export guide with pagination documentation</li> <li>Clear notes about HTML export limitations (client-side filtering only)</li> </ul>"},{"location":"about/changelog/#v030-2025-01-xx","title":"v0.3.0 (2025-01-XX)","text":""},{"location":"about/changelog/#new-features_1","title":"New Features","text":"<ul> <li>\u2728 Configuration system at <code>~/.config/ebk/config.json</code></li> <li>\ud83e\udd16 LLM provider abstraction with Ollama support (local and remote)</li> <li>\ud83c\udff7\ufe0f AI-powered metadata enrichment (tags, categories, descriptions, difficulty assessment)</li> <li>\ud83c\udf10 Enhanced web server with config defaults and auto-open browser</li> <li>\ud83d\udcda Complete documentation overhaul with mkdocs</li> </ul>"},{"location":"about/changelog/#configuration-system","title":"Configuration System","text":"<ul> <li>Centralized configuration management with <code>ebk config</code> command</li> <li>Four configuration sections: <code>llm</code>, <code>server</code>, <code>cli</code>, <code>library</code></li> <li>Support for default library path</li> <li>Server host, port, and auto-open browser settings</li> <li>CLI defaults for verbosity and color output</li> </ul>"},{"location":"about/changelog/#llm-integration","title":"LLM Integration","text":"<ul> <li>Abstract <code>BaseLLMProvider</code> interface in <code>ebk/ai/llm_providers/</code></li> <li><code>OllamaProvider</code> with local and remote support</li> <li><code>MetadataEnrichmentService</code> for intelligent metadata generation</li> <li><code>ebk enrich</code> command with selective enrichment options</li> <li>Support for multiple models and temperature control</li> </ul>"},{"location":"about/changelog/#server-updates","title":"Server Updates","text":"<ul> <li><code>ebk serve</code> now uses config defaults for library path, host, and port</li> <li>Optional library path argument (uses config if not specified)</li> <li>Auto-open browser feature</li> <li>REST API improvements</li> </ul>"},{"location":"about/changelog/#documentation_1","title":"Documentation","text":"<ul> <li>New user guides: Configuration, LLM Features, Web Server, CLI Reference</li> <li>Updated README with quickstart and modern examples</li> <li>Deployed to GitHub Pages</li> </ul>"},{"location":"about/changelog/#breaking-changes","title":"Breaking Changes","text":"<ul> <li><code>ebk serve</code> library path is now optional (uses config default)</li> <li>Some CLI options renamed for consistency (e.g., <code>--llm-*</code> prefix)</li> </ul>"},{"location":"about/changelog/#earlier-versions","title":"Earlier Versions","text":"<p>See GitHub Releases for information about earlier versions.</p>"},{"location":"about/license/","title":"License","text":"<p>ebk is distributed under the MIT License.</p> <p>See LICENSE file for details.</p>"},{"location":"advanced/batch-operations/","title":"Batch Operations","text":"<p>Efficiently processing multiple books.</p>"},{"location":"advanced/batch-operations/#see-also","title":"See Also","text":"<ul> <li>LLM Features - Batch enrichment</li> </ul>"},{"location":"advanced/hugo-export/","title":"Hugo Export with Jinja Templates","text":"<p>The ebk Hugo export now supports flexible organization and templating through Jinja2.</p>"},{"location":"advanced/hugo-export/#basic-usage","title":"Basic Usage","text":"<pre><code># Legacy export (flat structure)\nebk export hugo /path/to/library /path/to/hugo-site\n\n# New Jinja-based export with organization options\nebk export hugo /path/to/library /path/to/hugo-site --jinja --organize-by year\n</code></pre>"},{"location":"advanced/hugo-export/#organization-options","title":"Organization Options","text":"<p>With the <code>--jinja</code> flag, you can organize your library in different ways:</p>"},{"location":"advanced/hugo-export/#flat-default","title":"Flat (default)","text":"<p>All books in one directory: <pre><code>content/library/\n\u251c\u2500\u2500 _index.md\n\u251c\u2500\u2500 book-1-abc12345.md\n\u251c\u2500\u2500 book-2-def67890.md\n\u2514\u2500\u2500 ...\n</code></pre></p>"},{"location":"advanced/hugo-export/#by-year","title":"By Year","text":"<p><pre><code>ebk export hugo /path/to/library /path/to/hugo-site --jinja --organize-by year\n</code></pre> <pre><code>content/library/\n\u251c\u2500\u2500 _index.md\n\u251c\u2500\u2500 2023/\n\u2502   \u251c\u2500\u2500 _index.md\n\u2502   \u2514\u2500\u2500 book-1-abc12345.md\n\u251c\u2500\u2500 2024/\n\u2502   \u251c\u2500\u2500 _index.md\n\u2502   \u2514\u2500\u2500 book-2-def67890.md\n\u2514\u2500\u2500 unknown-year/\n    \u2514\u2500\u2500 ...\n</code></pre></p>"},{"location":"advanced/hugo-export/#by-language","title":"By Language","text":"<p><pre><code>ebk export hugo /path/to/library /path/to/hugo-site --jinja --organize-by language\n</code></pre> <pre><code>content/library/\n\u251c\u2500\u2500 _index.md\n\u251c\u2500\u2500 en/\n\u2502   \u251c\u2500\u2500 _index.md\n\u2502   \u2514\u2500\u2500 books...\n\u251c\u2500\u2500 es/\n\u2502   \u251c\u2500\u2500 _index.md\n\u2502   \u2514\u2500\u2500 books...\n\u2514\u2500\u2500 ...\n</code></pre></p>"},{"location":"advanced/hugo-export/#by-subject","title":"By Subject","text":"<p><pre><code>ebk export hugo /path/to/library /path/to/hugo-site --jinja --organize-by subject\n</code></pre> Books appear in multiple subject directories if they have multiple subjects: <pre><code>content/library/\n\u251c\u2500\u2500 _index.md\n\u251c\u2500\u2500 fiction/\n\u2502   \u251c\u2500\u2500 _index.md\n\u2502   \u2514\u2500\u2500 books...\n\u251c\u2500\u2500 science/\n\u2502   \u251c\u2500\u2500 _index.md\n\u2502   \u2514\u2500\u2500 books...\n\u2514\u2500\u2500 ...\n</code></pre></p>"},{"location":"advanced/hugo-export/#by-creator","title":"By Creator","text":"<p><pre><code>ebk export hugo /path/to/library /path/to/hugo-site --jinja --organize-by creator\n</code></pre> Books appear under each of their creators: <pre><code>content/library/\n\u251c\u2500\u2500 _index.md\n\u251c\u2500\u2500 jane-doe/\n\u2502   \u251c\u2500\u2500 _index.md\n\u2502   \u2514\u2500\u2500 books...\n\u251c\u2500\u2500 john-smith/\n\u2502   \u251c\u2500\u2500 _index.md\n\u2502   \u2514\u2500\u2500 books...\n\u2514\u2500\u2500 ...\n</code></pre></p>"},{"location":"advanced/hugo-export/#custom-templates","title":"Custom Templates","text":"<p>You can provide your own Jinja2 templates:</p> <pre><code>ebk export hugo /path/to/library /path/to/hugo-site --jinja \\\n    --template-dir /path/to/custom/templates\n</code></pre> <p>Your template directory should follow this structure: <pre><code>templates/\n\u2514\u2500\u2500 hugo/\n    \u251c\u2500\u2500 book.md      # Individual book page\n    \u251c\u2500\u2500 index.md     # Category index pages\n    \u2514\u2500\u2500 library.md   # Main library index\n</code></pre></p>"},{"location":"advanced/hugo-export/#template-variables","title":"Template Variables","text":""},{"location":"advanced/hugo-export/#bookmd","title":"book.md","text":"<ul> <li><code>book</code>: Dictionary with all metadata fields</li> <li><code>ebook_urls</code>: List of download URLs</li> <li><code>cover_url</code>: Cover image URL</li> </ul>"},{"location":"advanced/hugo-export/#indexmd","title":"index.md","text":"<ul> <li><code>title</code>: Section title</li> <li><code>organize_by</code>: Organization method</li> <li><code>group_key</code>: Current group identifier</li> <li><code>books</code>: List of books in this section</li> <li><code>book_count</code>: Number of books</li> </ul>"},{"location":"advanced/hugo-export/#librarymd","title":"library.md","text":"<ul> <li><code>title</code>: Library title</li> <li><code>books</code>: All books in the library</li> <li><code>stats</code>: Library statistics dictionary</li> </ul>"},{"location":"advanced/hugo-export/#hugo-configuration","title":"Hugo Configuration","text":"<p>To fully utilize the exported library, configure your Hugo site:</p>"},{"location":"advanced/hugo-export/#1-add-library-section","title":"1. Add Library Section","text":"<p>In <code>config.toml</code>: <pre><code>[[menu.main]]\n  name = \"Library\"\n  url = \"/library/\"\n  weight = 10\n</code></pre></p>"},{"location":"advanced/hugo-export/#2-create-custom-layouts","title":"2. Create Custom Layouts","text":"<p>Create <code>layouts/library/single.html</code> for book pages: <pre><code>{{ define \"main\" }}\n&lt;article class=\"book-page\"&gt;\n  &lt;h1&gt;{{ .Title }}&lt;/h1&gt;\n\n  {{ with .Params.cover_image }}\n    &lt;img src=\"{{ . }}\" alt=\"Book cover\" class=\"book-cover\"&gt;\n  {{ end }}\n\n  &lt;div class=\"book-meta\"&gt;\n    {{ with .Params.creators_display }}\n      &lt;p&gt;By {{ delimit . \", \" }}&lt;/p&gt;\n    {{ end }}\n\n    {{ with .Params.description }}\n      &lt;div class=\"description\"&gt;{{ . | markdownify }}&lt;/div&gt;\n    {{ end }}\n  &lt;/div&gt;\n\n  {{ with .Params.ebook_files }}\n    &lt;div class=\"downloads\"&gt;\n      &lt;h3&gt;Download&lt;/h3&gt;\n      {{ range . }}\n        &lt;a href=\"{{ . }}\" class=\"download-btn\"&gt;Download&lt;/a&gt;\n      {{ end }}\n    &lt;/div&gt;\n  {{ end }}\n&lt;/article&gt;\n{{ end }}\n</code></pre></p>"},{"location":"advanced/hugo-export/#3-style-your-library","title":"3. Style Your Library","text":"<p>Add CSS for the book grid and cards: <pre><code>.book-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 2rem;\n}\n\n.book-card {\n  border: 1px solid #ddd;\n  padding: 1rem;\n  transition: transform 0.2s;\n}\n\n.book-card:hover {\n  transform: translateY(-5px);\n}\n</code></pre></p>"},{"location":"advanced/hugo-export/#advanced-features","title":"Advanced Features","text":""},{"location":"advanced/hugo-export/#filtering-and-search","title":"Filtering and Search","text":"<p>The exported structure supports Hugo's built-in taxonomy system. You can filter by: - Tags (from subjects) - Authors (from creators) - Years - Languages</p>"},{"location":"advanced/hugo-export/#multiple-views","title":"Multiple Views","text":"<p>Since books can appear in multiple categories (e.g., by subject AND by author), users can browse your library from different perspectives.</p>"},{"location":"advanced/hugo-export/#static-but-dynamic","title":"Static but Dynamic","text":"<p>While Hugo generates static files, the organization allows for client-side filtering and search using JavaScript if desired.</p>"},{"location":"advanced/hugo-export/#example-workflow","title":"Example Workflow","text":"<ol> <li> <p>Import your Calibre library:    <pre><code>ebk import-calibre ~/Calibre ~/my-ebk-library\n</code></pre></p> </li> <li> <p>Export to Hugo with year organization:    <pre><code>ebk export hugo ~/my-ebk-library ~/my-hugo-site --jinja --organize-by year\n</code></pre></p> </li> <li> <p>Build and serve your Hugo site:    <pre><code>cd ~/my-hugo-site\nhugo serve\n</code></pre></p> </li> <li> <p>Visit <code>http://localhost:1313/library/</code> to browse your collection!</p> </li> </ol>"},{"location":"advanced/hugo-export/#tips","title":"Tips","text":"<ul> <li>Use <code>--organize-by subject</code> for topic-based browsing</li> <li>Use <code>--organize-by creator</code> for author-centric libraries</li> <li>Combine with Hugo's search functionality for full-text search</li> <li>The unique_id in URLs ensures no conflicts even with duplicate titles</li> <li>Consider using Hugo's image processing for cover thumbnails</li> </ul>"},{"location":"advanced/recommendations/","title":"Recommendations","text":"<p>Finding similar books and getting recommendations.</p> <p>Coming Soon</p> <p>This feature is planned for a future release. It will leverage the knowledge graph and semantic search capabilities to provide intelligent book recommendations.</p>"},{"location":"advanced/recommendations/#planned-features","title":"Planned Features","text":"<ul> <li>Content-based recommendations - Find similar books based on:</li> <li>Shared subjects and tags</li> <li>Similar descriptions and keywords</li> <li>Author connections</li> <li> <p>Reading patterns</p> </li> <li> <p>Semantic similarity - Use embeddings to find books with:</p> </li> <li>Similar themes and concepts</li> <li>Related topics</li> <li> <p>Comparable writing style</p> </li> <li> <p>Knowledge graph traversal - Discover books through:</p> </li> <li>Citation networks</li> <li>Subject hierarchies</li> <li>Concept relationships</li> </ul>"},{"location":"advanced/recommendations/#see-also","title":"See Also","text":"<ul> <li>CLI Reference - Command reference</li> <li>LLM Features - AI-powered capabilities</li> </ul>"},{"location":"advanced/symlink-dag/","title":"Symlink DAG Export Documentation","text":"<p>The symlink DAG (Directed Acyclic Graph) export feature creates a navigable directory structure that represents your library's tag hierarchy using symbolic links. This allows you to browse your ebook collection through tag categories using any file explorer or command line interface.</p>"},{"location":"advanced/symlink-dag/#overview","title":"Overview","text":"<p>The symlink DAG export transforms your flat library structure into a hierarchical directory tree where: - Each tag becomes a directory - Hierarchical tags (e.g., \"Programming/Python/Web\") create nested directories - Books appear in all relevant tag directories via symbolic links - The actual files are stored in a central <code>_books</code> directory</p>"},{"location":"advanced/symlink-dag/#usage","title":"Usage","text":""},{"location":"advanced/symlink-dag/#command-line","title":"Command Line","text":"<pre><code># Basic export\nebk export-dag /path/to/library /path/to/output\n\n# Use a different field for categorization (default: subjects)\nebk export-dag /path/to/library /path/to/output --tag-field creators\n\n# Skip copying actual files (only create symlinks to metadata)\nebk export-dag /path/to/library /path/to/output --no-files\n\n# Skip HTML index generation\nebk export-dag /path/to/library /path/to/output --no-index\n</code></pre>"},{"location":"advanced/symlink-dag/#python-api","title":"Python API","text":"<pre><code>from ebk import Library\n\nlib = Library.open(\"/path/to/library\")\n\n# Basic export\nlib.export_to_symlink_dag(\"/path/to/output\")\n\n# Custom options\nlib.export_to_symlink_dag(\n    \"/path/to/output\",\n    tag_field=\"creators\",  # Organize by authors instead of subjects\n    include_files=False,   # Don't copy ebook files\n    create_index=True      # Generate HTML indexes for web browsing\n)\n\n# Chain with other operations\n(lib.filter(lambda e: e.get(\"language\") == \"en\")\n    .export_to_symlink_dag(\"/english-books-dag\"))\n</code></pre>"},{"location":"advanced/symlink-dag/#directory-structure","title":"Directory Structure","text":""},{"location":"advanced/symlink-dag/#example-library","title":"Example Library","text":"<p>Given a library with these books: 1. \"Learn Python\" - Tags: [\"Programming\", \"Programming/Python\", \"Education\"] 2. \"Django Web Development\" - Tags: [\"Programming/Python/Web\", \"Web Development\"] 3. \"Machine Learning Basics\" - Tags: [\"Programming/Python\", \"AI/Machine Learning\"]</p>"},{"location":"advanced/symlink-dag/#generated-structure","title":"Generated Structure","text":"<pre><code>output-directory/\n\u251c\u2500\u2500 README.md                      # Explains the structure\n\u251c\u2500\u2500 _books/                        # Actual files stored here\n\u2502   \u251c\u2500\u2500 book_id_1/\n\u2502   \u2502   \u251c\u2500\u2500 metadata.json\n\u2502   \u2502   \u251c\u2500\u2500 learn_python.pdf\n\u2502   \u2502   \u2514\u2500\u2500 cover.jpg\n\u2502   \u251c\u2500\u2500 book_id_2/\n\u2502   \u2502   \u251c\u2500\u2500 metadata.json\n\u2502   \u2502   \u2514\u2500\u2500 django_web_dev.epub\n\u2502   \u2514\u2500\u2500 book_id_3/\n\u2502       \u251c\u2500\u2500 metadata.json\n\u2502       \u2514\u2500\u2500 ml_basics.pdf\n\u251c\u2500\u2500 Programming/\n\u2502   \u251c\u2500\u2500 index.html                 # Web index for this level\n\u2502   \u251c\u2500\u2500 Learn Python \u2192 ../../_books/book_id_1\n\u2502   \u251c\u2500\u2500 Python/\n\u2502   \u2502   \u251c\u2500\u2500 index.html\n\u2502   \u2502   \u251c\u2500\u2500 Learn Python \u2192 ../../../_books/book_id_1\n\u2502   \u2502   \u251c\u2500\u2500 Machine Learning Basics \u2192 ../../../_books/book_id_3\n\u2502   \u2502   \u2514\u2500\u2500 Web/\n\u2502   \u2502       \u251c\u2500\u2500 index.html\n\u2502   \u2502       \u2514\u2500\u2500 Django Web Development \u2192 ../../../../_books/book_id_2\n\u251c\u2500\u2500 Education/\n\u2502   \u251c\u2500\u2500 index.html\n\u2502   \u2514\u2500\u2500 Learn Python \u2192 ../../_books/book_id_1\n\u251c\u2500\u2500 Web Development/\n\u2502   \u251c\u2500\u2500 index.html\n\u2502   \u2514\u2500\u2500 Django Web Development \u2192 ../../_books/book_id_2\n\u2514\u2500\u2500 AI/\n    \u251c\u2500\u2500 index.html\n    \u2514\u2500\u2500 Machine Learning/\n        \u251c\u2500\u2500 index.html\n        \u2514\u2500\u2500 Machine Learning Basics \u2192 ../../../_books/book_id_3\n</code></pre>"},{"location":"advanced/symlink-dag/#features","title":"Features","text":""},{"location":"advanced/symlink-dag/#hierarchical-tag-support","title":"Hierarchical Tag Support","text":"<p>Tags containing \"/\" are treated as hierarchical: - \"Programming/Python/Web\" creates three nested levels - Books are accessible at each level of the hierarchy - Allows natural drill-down navigation</p>"},{"location":"advanced/symlink-dag/#multiple-tag-appearances","title":"Multiple Tag Appearances","text":"<p>Books appear in multiple locations: - A book tagged with [\"Programming\", \"Education\"] appears in both directories - Symlinks ensure no file duplication - Changes to files are reflected everywhere</p>"},{"location":"advanced/symlink-dag/#web-navigation","title":"Web Navigation","text":"<p>When <code>create_index</code> is enabled: - Each directory contains an <code>index.html</code> file - Browse the structure in a web browser - Navigate between parent/child categories - Direct links to open book directories</p>"},{"location":"advanced/symlink-dag/#readable-names","title":"Readable Names","text":"<p>Symlinks use human-readable names: - Format: \"Title - First Author\" - Sanitized for filesystem compatibility - Actual files stored by ID in <code>_books</code></p>"},{"location":"advanced/symlink-dag/#navigation-methods","title":"Navigation Methods","text":""},{"location":"advanced/symlink-dag/#file-explorer","title":"File Explorer","text":"<ul> <li>Open the output directory in Finder, Windows Explorer, or any file manager</li> <li>Navigate through categories like regular folders</li> <li>Open books by following symlinks</li> </ul>"},{"location":"advanced/symlink-dag/#command-line_1","title":"Command Line","text":"<pre><code># Navigate the structure\ncd /path/to/output\ncd Programming/Python\nls\n\n# Find all Python books\nfind . -name \"*.pdf\" -path \"*/Python/*\"\n</code></pre>"},{"location":"advanced/symlink-dag/#web-browser","title":"Web Browser","text":"<pre><code># Open in default browser\nopen /path/to/output/index.html  # macOS\nxdg-open /path/to/output/index.html  # Linux\nstart /path/to/output/index.html  # Windows\n\n# Or open file:// URL directly\n</code></pre>"},{"location":"advanced/symlink-dag/#platform-considerations","title":"Platform Considerations","text":""},{"location":"advanced/symlink-dag/#linuxmacos","title":"Linux/macOS","text":"<ul> <li>Symlinks work natively</li> <li>No special permissions required</li> <li>Full support for all features</li> </ul>"},{"location":"advanced/symlink-dag/#windows","title":"Windows","text":"<ul> <li>Requires administrator privileges to create symlinks</li> <li>Or enable Developer Mode (Windows 10+)</li> <li>Alternative: Use WSL (Windows Subsystem for Linux)</li> </ul>"},{"location":"development/AI_FEATURES/","title":"AI-Powered Features in ebk","text":""},{"location":"development/AI_FEATURES/#your-library-becomes-your-second-brain","title":"\ud83e\udde0 Your Library Becomes Your Second Brain","text":"<p>ebk now includes groundbreaking AI features that transform your ebook collection from static files into a living knowledge system. These features work together to amplify your learning and make every book you own exponentially more valuable.</p>"},{"location":"development/AI_FEATURES/#features-overview","title":"Features Overview","text":""},{"location":"development/AI_FEATURES/#1-knowledge-graph-construction","title":"1. Knowledge Graph Construction","text":"<p>Build a interconnected web of concepts across all your books, enabling you to see how ideas connect and evolve.</p>"},{"location":"development/AI_FEATURES/#2-semantic-search","title":"2. Semantic Search","text":"<p>Find information using natural language queries that understand meaning, not just keywords.</p>"},{"location":"development/AI_FEATURES/#3-learning-path-generation","title":"3. Learning Path Generation","text":"<p>Create personalized reading sequences that bridge from your current knowledge to your learning goals.</p>"},{"location":"development/AI_FEATURES/#4-intelligent-qa","title":"4. Intelligent Q&amp;A","text":"<p>Ask questions about your library and get answers synthesized from multiple sources.</p>"},{"location":"development/AI_FEATURES/#5-reading-sessions-active-recall","title":"5. Reading Sessions &amp; Active Recall","text":"<p>Track your reading with comprehension testing and spaced repetition for better retention.</p>"},{"location":"development/AI_FEATURES/#installation","title":"Installation","text":"<pre><code># Install with AI features\npip install ebk[ai]\n\n# Or install all features including AI\npip install ebk[all]\n</code></pre>"},{"location":"development/AI_FEATURES/#quick-start","title":"Quick Start","text":""},{"location":"development/AI_FEATURES/#step-1-build-your-knowledge-graph","title":"Step 1: Build Your Knowledge Graph","text":"<p>First, analyze your library to extract concepts and build the knowledge graph:</p> <pre><code># Build knowledge graph for your entire library\nebk build-knowledge /path/to/your/library\n\n# Or build for specific books\nebk build-knowledge /path/to/library --book book_id_1 --book book_id_2\n</code></pre> <p>This will: - Extract key concepts and definitions from each book - Identify relationships between ideas - Calculate importance scores using PageRank - Create a searchable knowledge network</p>"},{"location":"development/AI_FEATURES/#step-2-index-for-semantic-search","title":"Step 2: Index for Semantic Search","text":"<p>Enable intelligent content discovery:</p> <pre><code># Create semantic search index\nebk index-semantic /path/to/library\n\n# Customize chunk size for better granularity\nebk index-semantic /path/to/library --chunk-size 300\n</code></pre>"},{"location":"development/AI_FEATURES/#step-3-start-asking-questions","title":"Step 3: Start Asking Questions","text":"<p>Now you can query your library intelligently:</p> <pre><code># Ask about specific topics\nebk ask /path/to/library \"What do my books say about habit formation?\"\n\n# Find connections between concepts\nebk ask /path/to/library \"How does stoicism relate to modern psychology?\"\n\n# Get key principles\nebk ask /path/to/library \"What are the main principles of machine learning?\"\n</code></pre>"},{"location":"development/AI_FEATURES/#step-4-generate-learning-paths","title":"Step 4: Generate Learning Paths","text":"<p>Create personalized reading sequences:</p> <pre><code># Bridge from basic to advanced topics\nebk learning-path /path/to/library \"linear algebra\" \"quantum computing\"\n\n# Navigate between disciplines\nebk learning-path /path/to/library \"psychology\" \"neuroscience\"\n\n# Learn progressively\nebk learning-path /path/to/library \"basic programming\" \"distributed systems\"\n</code></pre>"},{"location":"development/AI_FEATURES/#advanced-usage","title":"Advanced Usage","text":""},{"location":"development/AI_FEATURES/#knowledge-graph-exploration","title":"Knowledge Graph Exploration","text":"<p>The knowledge graph stores data in <code>.knowledge_graph/</code> within your library:</p> <pre><code>from ebk.ai import KnowledgeGraph\n\n# Load existing graph\nkg = KnowledgeGraph(\"/path/to/library\")\n\n# Find concept paths\npath = kg.find_concept_path(\"habit\", \"neuroplasticity\")\nprint(f\"Learning path: {' -&gt; '.join(path)}\")\n\n# Get related concepts\nrelated = kg.find_related_concepts(\"machine learning\", max_distance=2)\nfor concept, relevance in related[:5]:\n    print(f\"{concept}: {relevance:.2f}\")\n\n# Get most important concepts\nkey_concepts = kg.get_key_concepts(top_n=10)\nfor concept in key_concepts:\n    print(f\"{concept.name}: {concept.importance_score:.3f}\")\n</code></pre>"},{"location":"development/AI_FEATURES/#semantic-search-api","title":"Semantic Search API","text":"<pre><code>from ebk.ai import SemanticSearch\n\nsearch = SemanticSearch(\"/path/to/library\")\n\n# Search across library\nresults = search.search_library(\n    \"strategies for overcoming procrastination\",\n    top_k=5\n)\n\nfor result in results:\n    print(f\"Book: {result['book_id']}\")\n    print(f\"Relevance: {result['similarity']:.2f}\")\n    print(f\"Text: {result['text'][:200]}...\")\n\n# Find similar books\nsimilar = search.find_similar_books(\"book_id_123\", top_k=3)\nfor book_id, similarity in similar:\n    print(f\"{book_id}: {similarity:.2f}\")\n</code></pre>"},{"location":"development/AI_FEATURES/#reading-sessions-with-active-recall","title":"Reading Sessions with Active Recall","text":"<pre><code>from ebk.ai import ReadingCompanion, QuestionGenerator\n\ncompanion = ReadingCompanion(\"/path/to/library\")\n\n# Start a reading session\nsession = companion.start_session(\"book_id_123\", chapter=\"Chapter 3\")\n\n# Track progress\ncompanion.add_highlight(session.session_id, \"Important quote here...\")\ncompanion.add_note(session.session_id, \"This relates to previous chapter\")\n\n# Generate questions for active recall\nqgen = QuestionGenerator()\nquestions = qgen.generate_from_highlights(session.highlights)\n\nfor q in questions:\n    print(f\"Q: {q.question_text}\")\n    print(f\"A: {q.answer}\\n\")\n\n# End session\ncompanion.end_session(session.session_id)\n\n# Check reading stats\nstats = companion.get_reading_stats()\nprint(f\"Total reading time: {stats['total_time']}\")\nprint(f\"Current streak: {companion.get_reading_streak()} days\")\n</code></pre>"},{"location":"development/AI_FEATURES/#how-it-works","title":"How It Works","text":""},{"location":"development/AI_FEATURES/#knowledge-graph-architecture","title":"Knowledge Graph Architecture","text":"<p>The knowledge graph uses NetworkX to create a directed graph where: - Nodes represent concepts, ideas, and definitions - Edges represent relationships (supports, contradicts, extends, exemplifies) - Weights indicate relationship strength - PageRank determines concept importance</p>"},{"location":"development/AI_FEATURES/#semantic-search-technology","title":"Semantic Search Technology","text":"<p>Two-tier approach for maximum compatibility: 1. Primary: Sentence-transformers for state-of-the-art embeddings 2. Fallback: TF-IDF vectorization for systems without GPU</p>"},{"location":"development/AI_FEATURES/#text-extraction-pipeline","title":"Text Extraction Pipeline","text":"<p>Intelligent extraction from multiple formats: - PDF: Chapter detection via TOC or pattern matching - EPUB: HTML parsing with BeautifulSoup - Smart chunking: Overlapping segments for context preservation</p>"},{"location":"development/AI_FEATURES/#privacy-performance","title":"Privacy &amp; Performance","text":""},{"location":"development/AI_FEATURES/#local-first-design","title":"Local-First Design","text":"<ul> <li>All processing happens on your machine</li> <li>No data sent to external servers</li> <li>Your knowledge graph stays private</li> </ul>"},{"location":"development/AI_FEATURES/#performance-optimization","title":"Performance Optimization","text":"<ul> <li>Incremental indexing (only process new books)</li> <li>Cached embeddings for fast retrieval</li> <li>Efficient vector similarity search</li> </ul>"},{"location":"development/AI_FEATURES/#storage-requirements","title":"Storage Requirements","text":"<ul> <li>Knowledge graph: ~1MB per 100 books</li> <li>Semantic index: ~10MB per 100 books</li> <li>Reading sessions: &lt;1MB</li> </ul>"},{"location":"development/AI_FEATURES/#roadmap","title":"Roadmap","text":""},{"location":"development/AI_FEATURES/#coming-soon","title":"Coming Soon","text":"<ul> <li>[ ] LLM integration for deeper analysis (Ollama support)</li> <li>[ ] Export to Obsidian/Roam/Notion</li> <li>[ ] Collaborative knowledge graphs</li> <li>[ ] Reading group features</li> <li>[ ] Mobile companion app</li> </ul>"},{"location":"development/AI_FEATURES/#future-vision","title":"Future Vision","text":"<ul> <li>Distributed knowledge protocol (P2P sharing)</li> <li>AR reading assistance</li> <li>Voice-based Q&amp;A</li> <li>Automatic podcast/video transcript integration</li> </ul>"},{"location":"development/AI_FEATURES/#examples-use-cases","title":"Examples &amp; Use Cases","text":""},{"location":"development/AI_FEATURES/#academic-research","title":"Academic Research","text":"<pre><code># Build comprehensive literature review\nebk ask /library \"recent advances in transformer architectures\"\n\n# Find citation networks\nebk learning-path /library \"attention mechanism\" \"multimodal transformers\"\n</code></pre>"},{"location":"development/AI_FEATURES/#self-learning","title":"Self-Learning","text":"<pre><code># Design curriculum\nebk learning-path /library \"beginner python\" \"machine learning engineer\"\n\n# Test comprehension\nebk quiz /library --book python_basics --type conceptual\n</code></pre>"},{"location":"development/AI_FEATURES/#book-clubs","title":"Book Clubs","text":"<pre><code># Find discussion topics\nebk ask /library \"controversial themes in 1984\"\n\n# Compare perspectives\nebk ask /library \"how different authors approach dystopia\"\n</code></pre>"},{"location":"development/AI_FEATURES/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/AI_FEATURES/#issue-knowledge-graph-building-is-slow","title":"Issue: Knowledge graph building is slow","text":"<p>Solution: Process specific books first: <pre><code>ebk build-knowledge /library --book important_book_id\n</code></pre></p>"},{"location":"development/AI_FEATURES/#issue-semantic-search-not-finding-relevant-content","title":"Issue: Semantic search not finding relevant content","text":"<p>Solution: Rebuild index with smaller chunks: <pre><code>ebk index-semantic /library --chunk-size 200 --force\n</code></pre></p>"},{"location":"development/AI_FEATURES/#issue-out-of-memory-during-indexing","title":"Issue: Out of memory during indexing","text":"<p>Solution: Use batch processing: <pre><code># Process books in smaller batches\nebk index-semantic /library --book book1 --book book2\n</code></pre></p>"},{"location":"development/AI_FEATURES/#contributing","title":"Contributing","text":"<p>We welcome contributions! Areas we're especially interested in: - Additional language support for extraction - Better concept relationship detection - Integration with more ebook formats - Visualization improvements</p>"},{"location":"development/AI_FEATURES/#license","title":"License","text":"<p>The AI features are part of ebk's MIT licensed codebase.</p> <p>Transform your library into a learning accelerator with ebk's AI features!</p>"},{"location":"development/CLEANUP_SUMMARY/","title":"Project Root Cleanup Summary","text":"<p>This document summarizes the cleanup performed on the project root directory on 2025-10-27.</p>"},{"location":"development/CLEANUP_SUMMARY/#changes-made","title":"Changes Made","text":""},{"location":"development/CLEANUP_SUMMARY/#1-documentation-organization","title":"1. Documentation Organization","text":"<p>Moved to <code>/docs/development/</code>: - AI_FEATURES.md - CODE_REVIEW.md - DESIGN_PLAN.md - PLUGIN_ARCHITECTURE.md - PYTHONIC_API.md - ROADMAP.md - TESTS_QUICK_REFERENCE.md - TEST_DESIGN_SUMMARY.md</p> <p>Kept in root: - README.md (project readme) - CLAUDE.md (Claude Code instructions)</p>"},{"location":"development/CLEANUP_SUMMARY/#2-utility-scripts-organization","title":"2. Utility Scripts Organization","text":"<p>Moved to <code>/scripts/</code>: - apply_decorators.py - check_coverage.py - fix_all_indentation.py - fix_cli_indents.py</p>"},{"location":"development/CLEANUP_SUMMARY/#3-requirements-files-cleanup","title":"3. Requirements Files Cleanup","text":"<p>Kept: - requirements-core.txt (clean dependency list with version specifiers)</p> <p>Archived to <code>/archive/</code>: - requirements.txt (frozen pip output with unrelated dependencies) - requirements2.txt (frozen pip output with unrelated dependencies)</p>"},{"location":"development/CLEANUP_SUMMARY/#4-legacy-code-archived","title":"4. Legacy Code Archived","text":"<p>Moved to <code>/archive/</code>: - legacy/ (old code: merge.py, personal.py, utils.py, imports/) - test_fluent_api/ (old test directory) - test.png (test file, actually JSON data)</p>"},{"location":"development/CLEANUP_SUMMARY/#5-gitignore-updates","title":"5. .gitignore Updates","text":"<p>Added: - site/ (MkDocs build output) - archive/ (archived files)</p> <p>Already present: - htmlcov/ (coverage HTML reports) - build/, dist/, *.egg-info/ (build artifacts)</p>"},{"location":"development/CLEANUP_SUMMARY/#current-root-directory-structure","title":"Current Root Directory Structure","text":"<pre><code>ebk/\n\u251c\u2500\u2500 README.md                # Project documentation\n\u251c\u2500\u2500 CLAUDE.md               # Claude Code instructions\n\u251c\u2500\u2500 LICENSE                 # License file\n\u251c\u2500\u2500 Makefile                # Build automation\n\u251c\u2500\u2500 pyproject.toml          # Modern Python packaging\n\u251c\u2500\u2500 setup.py                # Python packaging (legacy)\n\u251c\u2500\u2500 mkdocs.yml              # Documentation configuration\n\u251c\u2500\u2500 requirements-core.txt   # Core dependencies\n\u251c\u2500\u2500 environment.yml         # Conda environment\n\u251c\u2500\u2500 archive/                # Archived legacy files (gitignored)\n\u251c\u2500\u2500 docs/                   # MkDocs documentation\n\u251c\u2500\u2500 ebk/                    # Main package\n\u251c\u2500\u2500 examples/               # Example code\n\u251c\u2500\u2500 integrations/           # Optional integrations\n\u251c\u2500\u2500 scripts/                # Utility scripts\n\u2514\u2500\u2500 tests/                  # Test suite\n</code></pre>"},{"location":"development/CLEANUP_SUMMARY/#rationale","title":"Rationale","text":"<p>The cleanup follows Python project best practices: - Documentation goes in /docs - Utility scripts go in /scripts - Tests stay in /tests - Build artifacts are gitignored - Only essential files remain in root - Legacy/archived code goes in /archive (gitignored)</p>"},{"location":"development/CLEANUP_SUMMARY/#what-was-not-changed","title":"What Was NOT Changed","text":"<ul> <li>All source code (ebk/ package)</li> <li>All tests (tests/ directory)</li> <li>Build configuration (pyproject.toml, setup.py, Makefile)</li> <li>Existing docs structure (docs/ subdirectories)</li> <li>Examples and integrations directories</li> </ul>"},{"location":"development/CODE_REVIEW/","title":"EBK Code Review Report","text":""},{"location":"development/CODE_REVIEW/#1-critical-bugs-incomplete-features","title":"1. CRITICAL BUGS &amp; INCOMPLETE FEATURES","text":""},{"location":"development/CODE_REVIEW/#11-missing-methods","title":"1.1 Missing Methods","text":"<ul> <li><code>where_title_contains</code> method is missing from QueryBuilder </li> <li>Used by CLI commands (rate, comment, mark) but not implemented</li> <li>Will cause AttributeError when trying to search by title</li> <li>Fix: Add method to QueryBuilder class</li> </ul>"},{"location":"development/CODE_REVIEW/#12-incomplete-personal-metadata-integration","title":"1.2 Incomplete Personal Metadata Integration","text":"<ul> <li>Personal metadata CLI commands will fail due to missing <code>where_title_contains</code></li> <li>Web exports don't display personal metadata (ratings, read status, etc.)</li> <li>No way to export/import personal metadata separately</li> </ul>"},{"location":"development/CODE_REVIEW/#13-import-issues","title":"1.3 Import Issues","text":"<ul> <li>Missing <code>Optional</code> import in several files that use it</li> <li>Circular import potential between library.py and personal.py</li> </ul>"},{"location":"development/CODE_REVIEW/#2-error-handling-issues","title":"2. ERROR HANDLING ISSUES","text":""},{"location":"development/CODE_REVIEW/#21-overly-broad-exception-handlers","title":"2.1 Overly Broad Exception Handlers","text":"<ul> <li><code>multi_facet_export.py</code>: Bare <code>except:</code> on line ~90 (catches everything including KeyboardInterrupt)</li> <li><code>jinja_export.py</code>: Bare <code>except:</code> that silently swallows errors</li> <li>Risk: Hiding real errors, making debugging difficult</li> </ul>"},{"location":"development/CODE_REVIEW/#22-inconsistent-error-handling","title":"2.2 Inconsistent Error Handling","text":"<ul> <li>CLI commands have 16+ identical FileNotFoundError handlers</li> <li>Should be refactored to a decorator or common function</li> <li>Error messages not always helpful to users</li> </ul>"},{"location":"development/CODE_REVIEW/#23-missing-validation","title":"2.3 Missing Validation","text":"<ul> <li>No validation on file paths (could lead to path traversal)</li> <li>No size limits on metadata fields (potential memory issues)</li> <li>No validation of unique_id format consistency</li> </ul>"},{"location":"development/CODE_REVIEW/#3-design-architecture-issues","title":"3. DESIGN &amp; ARCHITECTURE ISSUES","text":""},{"location":"development/CODE_REVIEW/#31-code-duplication","title":"3.1 Code Duplication","text":"<ul> <li>CLI error handling repeated 16+ times</li> <li>Entry finding logic duplicated across multiple CLI commands</li> <li>Similar export logic across different export modules</li> </ul>"},{"location":"development/CODE_REVIEW/#32-tight-coupling","title":"3.2 Tight Coupling","text":"<ul> <li>Library class directly instantiates PersonalMetadata</li> <li>Export modules have duplicated sanitization logic</li> <li>CLI commands directly manipulate library internals</li> </ul>"},{"location":"development/CODE_REVIEW/#33-missing-abstractions","title":"3.3 Missing Abstractions","text":"<ul> <li>No base class for exporters (hugo, zip, symlink_dag, multi_facet)</li> <li>No interface for import modules</li> <li>Query builder could benefit from a more fluent pattern</li> </ul>"},{"location":"development/CODE_REVIEW/#4-performance-issues","title":"4. PERFORMANCE ISSUES","text":""},{"location":"development/CODE_REVIEW/#41-memory-usage","title":"4.1 Memory Usage","text":"<ul> <li>Loading entire library into memory (could be problematic for large libraries)</li> <li>Deep copying entire entry list for queries</li> <li>No lazy loading of entry data</li> </ul>"},{"location":"development/CODE_REVIEW/#42-inefficient-operations","title":"4.2 Inefficient Operations","text":"<ul> <li>Linear search for entries by ID (O(n) for each lookup)</li> <li>No indexing for common queries</li> <li>Multiple passes over data in query execution</li> </ul>"},{"location":"development/CODE_REVIEW/#5-security-concerns","title":"5. SECURITY CONCERNS","text":""},{"location":"development/CODE_REVIEW/#51-path-traversal-risk","title":"5.1 Path Traversal Risk","text":"<ul> <li>User-provided paths not validated</li> <li>Symlink creation could potentially link to sensitive files</li> <li>No sandboxing of file operations</li> </ul>"},{"location":"development/CODE_REVIEW/#52-htmljavascript-injection","title":"5.2 HTML/JavaScript Injection","text":"<ul> <li>User metadata directly inserted into HTML templates</li> <li>Need proper escaping in Jinja templates</li> <li>JSON data not properly sanitized</li> </ul>"},{"location":"development/CODE_REVIEW/#53-resource-exhaustion","title":"5.3 Resource Exhaustion","text":"<ul> <li>No limits on:</li> <li>Number of entries</li> <li>Size of metadata fields</li> <li>Depth of tag hierarchies</li> <li>Number of symlinks created</li> </ul>"},{"location":"development/CODE_REVIEW/#6-missing-features","title":"6. MISSING FEATURES","text":""},{"location":"development/CODE_REVIEW/#61-core-functionality","title":"6.1 Core Functionality","text":"<ul> <li>No bulk operations for personal metadata</li> <li>No undo/redo for operations</li> <li>No conflict resolution for merges</li> <li>No incremental updates (always full save)</li> </ul>"},{"location":"development/CODE_REVIEW/#62-user-experience","title":"6.2 User Experience","text":"<ul> <li>No progress bars for long operations (except imports)</li> <li>No dry-run mode for dangerous operations</li> <li>No backup before modifications</li> <li>No configuration file validation</li> </ul>"},{"location":"development/CODE_REVIEW/#63-data-management","title":"6.3 Data Management","text":"<ul> <li>No data migration for schema changes</li> <li>No versioning of metadata format</li> <li>No integrity checks for library consistency</li> <li>No cleanup of orphaned files</li> </ul>"},{"location":"development/CODE_REVIEW/#7-testing-documentation","title":"7. TESTING &amp; DOCUMENTATION","text":""},{"location":"development/CODE_REVIEW/#71-missing-tests","title":"7.1 Missing Tests","text":"<ul> <li>No tests for personal metadata functionality</li> <li>No tests for export modules</li> <li>No integration tests for CLI commands</li> <li>No performance benchmarks</li> </ul>"},{"location":"development/CODE_REVIEW/#72-missing-type-hints","title":"7.2 Missing Type Hints","text":"<ul> <li>Many functions lack return type annotations</li> <li>No type hints for complex data structures</li> <li>Would benefit from TypedDict for entry structure</li> </ul>"},{"location":"development/CODE_REVIEW/#73-documentation-gaps","title":"7.3 Documentation Gaps","text":"<ul> <li>No API documentation for Library class</li> <li>No examples for personal metadata</li> <li>No migration guide from old versions</li> <li>No troubleshooting guide</li> </ul>"},{"location":"development/CODE_REVIEW/#8-refactoring-opportunities","title":"8. REFACTORING OPPORTUNITIES","text":""},{"location":"development/CODE_REVIEW/#81-extract-common-patterns","title":"8.1 Extract Common Patterns","text":"<pre><code># Decorator for CLI error handling\ndef handle_library_errors(func):\n    @functools.wraps(func)\n    def wrapper(*args, **kwargs):\n        try:\n            return func(*args, **kwargs)\n        except FileNotFoundError as e:\n            console.print(f\"[red]Library not found: {e}[/red]\")\n            raise typer.Exit(1)\n        except Exception as e:\n            logger.error(f\"Error in {func.__name__}: {e}\")\n            console.print(f\"[red]Operation failed: {e}[/red]\")\n            raise typer.Exit(1)\n    return wrapper\n</code></pre>"},{"location":"development/CODE_REVIEW/#82-create-base-classes","title":"8.2 Create Base Classes","text":"<pre><code>class BaseExporter(ABC):\n    @abstractmethod\n    def export(self, library_path: Path, output_path: Path, **options):\n        pass\n\n    def _sanitize_filename(self, name: str) -&gt; str:\n        # Common implementation\n        pass\n</code></pre>"},{"location":"development/CODE_REVIEW/#83-improve-query-builder","title":"8.3 Improve Query Builder","text":"<pre><code>class QueryBuilder:\n    def where_title_contains(self, pattern: str) -&gt; 'QueryBuilder':\n        \"\"\"Filter by title containing pattern.\"\"\"\n        return self.where_lambda(\n            lambda e: pattern.lower() in e.get('title', '').lower()\n        )\n\n    def where_author_is(self, author: str) -&gt; 'QueryBuilder':\n        \"\"\"Filter by author.\"\"\"\n        return self.where_lambda(\n            lambda e: author in e.get('creators', [])\n        )\n</code></pre>"},{"location":"development/CODE_REVIEW/#9-immediate-priorities","title":"9. IMMEDIATE PRIORITIES","text":"<ol> <li>Fix where_title_contains - Blocking personal metadata CLI</li> <li>Add error handling decorator - Reduce code duplication</li> <li>Sanitize HTML output - Security issue</li> <li>Add progress indicators - UX improvement</li> <li>Create exporter base class - Better architecture</li> <li>Add library indexing - Performance improvement</li> <li>Implement validation - Data integrity</li> <li>Add integration tests - Quality assurance</li> </ol>"},{"location":"development/CODE_REVIEW/#10-long-term-improvements","title":"10. LONG-TERM IMPROVEMENTS","text":"<ol> <li>Database backend option - For large libraries</li> <li>Async operations - Better performance</li> <li>Plugin system - Extensibility</li> <li>REST API - Remote access</li> <li>Incremental updates - Efficiency</li> <li>Version control integration - Collaboration</li> <li>Full-text search - Better discovery</li> <li>Machine learning features - Smart recommendations</li> </ol>"},{"location":"development/DESIGN_PLAN/","title":"EBK Design Plan: BTK-Inspired Architecture","text":""},{"location":"development/DESIGN_PLAN/#vision","title":"Vision","text":"<p>Transform EBK from a simple ebook metadata manager into a comprehensive, extensible library management system that combines the best features of BTK's bookmark management with EBK's ebook-specific functionality.</p>"},{"location":"development/DESIGN_PLAN/#core-principles","title":"Core Principles","text":"<ol> <li>Plugin-First Architecture: Everything beyond core functionality should be a plugin</li> <li>Progressive Enhancement: Start simple, enrich over time</li> <li>Unix Philosophy: Core does one thing well, integrations extend functionality</li> <li>API-First Design: Pythonic API as foundation, CLI/Web/MCP as clients</li> <li>Type Safety: Use type hints and Pydantic models throughout</li> </ol>"},{"location":"development/DESIGN_PLAN/#architecture-layers","title":"Architecture Layers","text":""},{"location":"development/DESIGN_PLAN/#1-core-layer-ebkcore","title":"1. Core Layer (ebk.core)","text":"<p>The minimal, essential functionality: - Data models (Entry, Library, Metadata) - Basic CRUD operations - Import/Export interfaces - Plugin registry and hooks</p>"},{"location":"development/DESIGN_PLAN/#2-plugin-layer-ebkplugins","title":"2. Plugin Layer (ebk.plugins)","text":"<p>Abstract base classes and implementations: <pre><code># Base interfaces\nclass MetadataExtractor(ABC)     # Extract metadata from files/URLs\nclass TagSuggester(ABC)          # Auto-tag entries\nclass SimilarityFinder(ABC)      # Find similar entries\nclass ContentAnalyzer(ABC)       # Analyze content (readability, topics)\nclass Deduplicator(ABC)          # Deduplication strategies\nclass Validator(ABC)             # Validate entries (file exists, metadata)\n</code></pre></p>"},{"location":"development/DESIGN_PLAN/#3-api-layer-ebkapi","title":"3. API Layer (ebk.api)","text":"<p>Pythonic API for programmatic access: <pre><code>from ebk import Library, Entry, Query\n\n# Fluent API (existing, to enhance)\nlib = Library.open(\"~/ebooks\")\nresults = (lib\n    .where(\"language\", \"==\", \"en\")\n    .where_any(\"subjects\", contains=\"Python\")\n    .order_by(\"rating\", desc=True)\n    .take(10)\n    .execute())\n\n# New: Async API for web operations\nasync with AsyncLibrary(\"~/ebooks\") as lib:\n    await lib.enrich_metadata(fetch_covers=True)\n    await lib.validate_entries(check_files=True)\n\n# New: Bulk operations\nwith lib.batch() as batch:\n    batch.tag_all(lambda e: e.year &lt; 2020, \"vintage\")\n    batch.update_where(language=\"fr\", add_tag=\"french\")\n    batch.commit()\n\n# New: Plugin API\nlib.use_plugin(\"openai_tagger\", api_key=\"...\")\nlib.auto_tag(strategy=\"content_based\")\n</code></pre></p>"},{"location":"development/DESIGN_PLAN/#4-service-layer-ebkservices","title":"4. Service Layer (ebk.services)","text":"<p>Higher-level services built on the API: - REST API server (FastAPI) - GraphQL server (optional) - MCP server for AI assistants - WebSocket server for real-time updates</p>"},{"location":"development/DESIGN_PLAN/#5-client-layer","title":"5. Client Layer","text":"<p>Various clients consuming the API: - CLI (typer/rich) - Web UI (streamlit/gradio) - Browser extensions - Desktop app (future)</p>"},{"location":"development/DESIGN_PLAN/#data-model-evolution","title":"Data Model Evolution","text":""},{"location":"development/DESIGN_PLAN/#current-entry-model","title":"Current Entry Model","text":"<pre><code>{\n    \"unique_id\": \"hash\",\n    \"title\": \"string\",\n    \"creators\": [\"list\"],\n    \"subjects\": [\"list\"],\n    \"language\": \"string\",\n    \"date\": \"string\",\n    \"file_paths\": [\"list\"],\n    \"cover_path\": \"string\"\n}\n</code></pre>"},{"location":"development/DESIGN_PLAN/#enhanced-entry-model","title":"Enhanced Entry Model","text":"<pre><code>class Entry(BaseModel):\n    # Core identity\n    unique_id: str\n    title: str\n    creators: List[Creator]  # Enhanced with roles\n\n    # Classification\n    subjects: List[str]\n    tags: List[str]          # User tags\n    auto_tags: List[str]     # AI/plugin generated\n    categories: List[str]    # Hierarchical\n\n    # Metadata\n    language: str\n    date: datetime\n    publisher: Optional[str]\n    isbn: Optional[str]\n    doi: Optional[str]\n\n    # Files\n    file_paths: List[FilePath]  # With format info\n    cover_path: Optional[str]\n    thumbnail_path: Optional[str]\n\n    # Usage tracking\n    added_date: datetime\n    modified_date: datetime\n    last_accessed: Optional[datetime]\n    access_count: int = 0\n\n    # Quality metrics\n    rating: Optional[float]      # User rating\n    quality_score: Optional[float]  # Auto-calculated\n    completeness: float          # Metadata completeness\n    validated: bool = False\n    validation_errors: List[str] = []\n\n    # Personal metadata\n    read_status: ReadStatus     # unread/reading/read\n    reading_progress: Optional[float]\n    notes: Optional[str]\n    bookmarks: List[Bookmark]\n    highlights: List[Highlight]\n\n    # Relationships\n    series: Optional[str]\n    series_position: Optional[int]\n    related_ids: List[str]\n    duplicate_ids: List[str]\n\n    # Plugin metadata\n    plugin_data: Dict[str, Any]  # Extensible\n</code></pre>"},{"location":"development/DESIGN_PLAN/#plugin-architecture-design","title":"Plugin Architecture Design","text":""},{"location":"development/DESIGN_PLAN/#plugin-discovery","title":"Plugin Discovery","text":"<pre><code># ebk/plugins/__init__.py\nclass PluginRegistry:\n    def register(self, plugin_type: str, plugin: BasePlugin):\n        \"\"\"Register a plugin.\"\"\"\n\n    def get_plugins(self, plugin_type: str) -&gt; List[BasePlugin]:\n        \"\"\"Get all plugins of a type.\"\"\"\n\n    def discover(self):\n        \"\"\"Auto-discover plugins from installed packages.\"\"\"\n        # Look for entry points: ebk.plugins.*\n</code></pre>"},{"location":"development/DESIGN_PLAN/#hook-system","title":"Hook System","text":"<pre><code># Lifecycle hooks\n@hook(\"before_import\")\ndef validate_import(entries: List[Entry]) -&gt; List[Entry]:\n    \"\"\"Validate/modify entries before import.\"\"\"\n\n@hook(\"after_import\")\ndef enrich_metadata(entries: List[Entry]):\n    \"\"\"Enrich metadata after import.\"\"\"\n\n@hook(\"before_export\")\ndef prepare_export(entries: List[Entry], format: str):\n    \"\"\"Prepare entries for export.\"\"\"\n\n# Event hooks\n@hook(\"entry_added\")\n@hook(\"entry_modified\")\n@hook(\"entry_deleted\")\n@hook(\"tags_suggested\")\n</code></pre>"},{"location":"development/DESIGN_PLAN/#built-in-plugins","title":"Built-in Plugins","text":""},{"location":"development/DESIGN_PLAN/#1-openai-plugin","title":"1. OpenAI Plugin","text":"<pre><code>class OpenAITagger(TagSuggester):\n    \"\"\"Use GPT to suggest tags based on content.\"\"\"\n\nclass OpenAISummarizer(ContentAnalyzer):\n    \"\"\"Generate summaries using GPT.\"\"\"\n</code></pre>"},{"location":"development/DESIGN_PLAN/#2-google-books-plugin","title":"2. Google Books Plugin","text":"<pre><code>class GoogleBooksExtractor(MetadataExtractor):\n    \"\"\"Fetch metadata from Google Books API.\"\"\"\n</code></pre>"},{"location":"development/DESIGN_PLAN/#3-calibre-plugin","title":"3. Calibre Plugin","text":"<pre><code>class CalibreIntegration:\n    \"\"\"Sync with Calibre libraries.\"\"\"\n</code></pre>"},{"location":"development/DESIGN_PLAN/#4-academic-plugin","title":"4. Academic Plugin","text":"<pre><code>class DOIResolver(MetadataExtractor):\n    \"\"\"Resolve DOI to full metadata.\"\"\"\n\nclass CitationFormatter:\n    \"\"\"Format citations in various styles.\"\"\"\n</code></pre>"},{"location":"development/DESIGN_PLAN/#implementation-phases","title":"Implementation Phases","text":""},{"location":"development/DESIGN_PLAN/#phase-1-foundation-week-1-2","title":"Phase 1: Foundation (Week 1-2)","text":"<ul> <li>[ ] Design Pydantic models for all data types</li> <li>[ ] Implement plugin registry and discovery</li> <li>[ ] Create abstract base classes for plugins</li> <li>[ ] Set up hook system</li> <li>[ ] Write comprehensive tests</li> </ul>"},{"location":"development/DESIGN_PLAN/#phase-2-core-plugins-week-3-4","title":"Phase 2: Core Plugins (Week 3-4)","text":"<ul> <li>[ ] Implement MetadataExtractor plugins</li> <li>[ ] Implement TagSuggester plugins</li> <li>[ ] Create SimilarityFinder implementations</li> <li>[ ] Add Deduplicator strategies</li> <li>[ ] Build Validator plugins</li> </ul>"},{"location":"development/DESIGN_PLAN/#phase-3-api-layer-week-5-6","title":"Phase 3: API Layer (Week 5-6)","text":"<ul> <li>[ ] Enhance existing fluent API</li> <li>[ ] Add async API for I/O operations</li> <li>[ ] Implement batch operations</li> <li>[ ] Create transaction support</li> <li>[ ] Add query optimization</li> </ul>"},{"location":"development/DESIGN_PLAN/#phase-4-service-layer-week-7-8","title":"Phase 4: Service Layer (Week 7-8)","text":"<ul> <li>[ ] Build FastAPI REST server</li> <li>[ ] Implement WebSocket support</li> <li>[ ] Update MCP server</li> <li>[ ] Add authentication/authorization</li> <li>[ ] Create API documentation</li> </ul>"},{"location":"development/DESIGN_PLAN/#phase-5-enhanced-cli-week-9-10","title":"Phase 5: Enhanced CLI (Week 9-10)","text":"<ul> <li>[ ] Restructure with subparsers</li> <li>[ ] Add rich terminal output</li> <li>[ ] Implement progress bars</li> <li>[ ] Add interactive mode</li> <li>[ ] Create shell completion</li> </ul>"},{"location":"development/DESIGN_PLAN/#phase-6-web-ui-week-11-12","title":"Phase 6: Web UI (Week 11-12)","text":"<ul> <li>[ ] Modernize Streamlit app</li> <li>[ ] Add real-time updates</li> <li>[ ] Implement bulk operations UI</li> <li>[ ] Create plugin management UI</li> <li>[ ] Add data visualization</li> </ul>"},{"location":"development/DESIGN_PLAN/#migration-strategy","title":"Migration Strategy","text":""},{"location":"development/DESIGN_PLAN/#backward-compatibility","title":"Backward Compatibility","text":"<ul> <li>Keep existing CLI commands working</li> <li>Provide migration tool for old libraries</li> <li>Maintain JSON format compatibility</li> <li>Deprecate gradually with warnings</li> </ul>"},{"location":"development/DESIGN_PLAN/#migration-tool","title":"Migration Tool","text":"<pre><code>ebk migrate old-library --to v2 --output new-library\n</code></pre>"},{"location":"development/DESIGN_PLAN/#testing-strategy","title":"Testing Strategy","text":""},{"location":"development/DESIGN_PLAN/#test-levels","title":"Test Levels","text":"<ol> <li>Unit Tests: Every plugin, model, function</li> <li>Integration Tests: Plugin interactions, API calls</li> <li>System Tests: End-to-end workflows</li> <li>Performance Tests: Large library handling</li> <li>Plugin Tests: Isolated plugin testing</li> </ol>"},{"location":"development/DESIGN_PLAN/#test-data","title":"Test Data","text":"<ul> <li>Small library (10 entries)</li> <li>Medium library (1,000 entries)</li> <li>Large library (100,000 entries)</li> <li>Various formats and languages</li> <li>Corrupted/incomplete data</li> </ul>"},{"location":"development/DESIGN_PLAN/#documentation-plan","title":"Documentation Plan","text":""},{"location":"development/DESIGN_PLAN/#user-documentation","title":"User Documentation","text":"<ul> <li>Getting Started Guide</li> <li>CLI Reference</li> <li>API Documentation</li> <li>Plugin Development Guide</li> <li>Migration Guide</li> </ul>"},{"location":"development/DESIGN_PLAN/#developer-documentation","title":"Developer Documentation","text":"<ul> <li>Architecture Overview</li> <li>Contributing Guide</li> <li>Plugin API Reference</li> <li>Hook Documentation</li> <li>Code Style Guide</li> </ul>"},{"location":"development/DESIGN_PLAN/#performance-considerations","title":"Performance Considerations","text":""},{"location":"development/DESIGN_PLAN/#optimization-areas","title":"Optimization Areas","text":"<ol> <li>Indexing: Add SQLite FTS5 for search</li> <li>Caching: Redis for frequently accessed data</li> <li>Lazy Loading: Load metadata on demand</li> <li>Batch Processing: Process in chunks</li> <li>Async I/O: Non-blocking file operations</li> </ol>"},{"location":"development/DESIGN_PLAN/#benchmarks","title":"Benchmarks","text":"<ul> <li>Import 10,000 entries: &lt; 10 seconds</li> <li>Search 100,000 entries: &lt; 100ms</li> <li>Export 10,000 entries: &lt; 5 seconds</li> <li>API response time: &lt; 50ms p95</li> </ul>"},{"location":"development/DESIGN_PLAN/#security-considerations","title":"Security Considerations","text":""},{"location":"development/DESIGN_PLAN/#security-features","title":"Security Features","text":"<ul> <li>Path traversal prevention</li> <li>HTML sanitization</li> <li>SQL injection prevention</li> <li>API rate limiting</li> <li>Authentication tokens</li> <li>Encrypted personal data</li> </ul>"},{"location":"development/DESIGN_PLAN/#integration-ecosystem","title":"Integration Ecosystem","text":""},{"location":"development/DESIGN_PLAN/#planned-integrations","title":"Planned Integrations","text":"<ol> <li>Browser Extensions: Save from web</li> <li>E-readers: Sync with Kindle, Kobo</li> <li>Cloud Storage: Google Drive, Dropbox</li> <li>Academic: Zotero, Mendeley</li> <li>Social: Goodreads, LibraryThing</li> <li>AI Assistants: ChatGPT, Claude</li> <li>Note-taking: Obsidian, Notion</li> </ol>"},{"location":"development/DESIGN_PLAN/#success-metrics","title":"Success Metrics","text":""},{"location":"development/DESIGN_PLAN/#technical-metrics","title":"Technical Metrics","text":"<ul> <li>Test coverage &gt; 90%</li> <li>API latency &lt; 50ms</li> <li>Plugin adoption &gt; 10</li> <li>Zero security vulnerabilities</li> </ul>"},{"location":"development/DESIGN_PLAN/#user-metrics","title":"User Metrics","text":"<ul> <li>CLI commands &lt; 3 seconds</li> <li>Web UI responsive &lt; 100ms</li> <li>Import success rate &gt; 99%</li> <li>User documentation complete</li> </ul>"},{"location":"development/DESIGN_PLAN/#next-steps","title":"Next Steps","text":"<ol> <li>Immediate: Create plugin architecture prototype</li> <li>Short-term: Implement core plugins</li> <li>Medium-term: Build API and service layers</li> <li>Long-term: Develop integration ecosystem</li> </ol>"},{"location":"development/DESIGN_PLAN/#questions-to-resolve","title":"Questions to Resolve","text":"<ol> <li>Should we use SQLite for indexing or stay JSON-only?</li> <li>Which plugin should we implement first as proof-of-concept?</li> <li>Should the API be REST-only or include GraphQL?</li> <li>How to handle plugin dependencies?</li> <li>Versioning strategy for plugins?</li> </ol> <p>This design plan combines BTK's excellent plugin architecture and API design with EBK's ebook-specific functionality, creating a powerful, extensible library management system.</p>"},{"location":"development/PLUGIN_ARCHITECTURE/","title":"EBK Plugin Architecture","text":""},{"location":"development/PLUGIN_ARCHITECTURE/#overview","title":"Overview","text":"<p>The plugin architecture allows EBK to be extended without modifying core code. Plugins can add new functionality, modify behavior, and integrate with external services.</p>"},{"location":"development/PLUGIN_ARCHITECTURE/#plugin-types","title":"Plugin Types","text":""},{"location":"development/PLUGIN_ARCHITECTURE/#1-metadataextractor","title":"1. MetadataExtractor","text":"<p>Extract or enhance metadata from various sources.</p> <pre><code>from abc import ABC, abstractmethod\nfrom typing import Dict, Any, Optional\nfrom ebk.plugins.base import Plugin\n\nclass MetadataExtractor(Plugin, ABC):\n    \"\"\"Base class for metadata extraction plugins.\"\"\"\n\n    @abstractmethod\n    async def extract(self, \n                     file_path: Optional[str] = None,\n                     url: Optional[str] = None,\n                     isbn: Optional[str] = None,\n                     content: Optional[bytes] = None) -&gt; Dict[str, Any]:\n        \"\"\"\n        Extract metadata from various sources.\n\n        Returns:\n            Dictionary with metadata fields like:\n            - title, creators, subjects, description\n            - publisher, date, language\n            - isbn, doi, other identifiers\n            - cover_url, thumbnail_url\n        \"\"\"\n        pass\n\n    @abstractmethod\n    def supported_formats(self) -&gt; List[str]:\n        \"\"\"Return list of supported file formats.\"\"\"\n        pass\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#2-tagsuggester","title":"2. TagSuggester","text":"<p>Generate tags based on content analysis.</p> <pre><code>class TagSuggester(Plugin, ABC):\n    \"\"\"Base class for tag suggestion plugins.\"\"\"\n\n    @abstractmethod\n    async def suggest_tags(self, \n                          entry: Entry,\n                          max_tags: int = 10,\n                          confidence_threshold: float = 0.5) -&gt; List[TagSuggestion]:\n        \"\"\"\n        Suggest tags for an entry.\n\n        Returns:\n            List of TagSuggestion objects with tag and confidence score.\n        \"\"\"\n        pass\n\n    @abstractmethod\n    def requires_content(self) -&gt; bool:\n        \"\"\"Whether this suggester needs file content.\"\"\"\n        pass\n\nclass TagSuggestion:\n    tag: str\n    confidence: float\n    source: str  # Which plugin suggested it\n    reason: Optional[str]  # Why this tag was suggested\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#3-contentanalyzer","title":"3. ContentAnalyzer","text":"<p>Analyze content for various metrics.</p> <pre><code>class ContentAnalyzer(Plugin, ABC):\n    \"\"\"Base class for content analysis plugins.\"\"\"\n\n    @abstractmethod\n    async def analyze(self, entry: Entry) -&gt; ContentAnalysis:\n        \"\"\"Analyze entry content.\"\"\"\n        pass\n\nclass ContentAnalysis:\n    reading_time: Optional[int]  # minutes\n    difficulty_level: Optional[str]  # easy/medium/hard\n    word_count: Optional[int]\n    page_count: Optional[int]\n    language: Optional[str]\n    summary: Optional[str]\n    key_topics: List[str]\n    sentiment: Optional[float]  # -1 to 1\n    quality_score: Optional[float]  # 0 to 1\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#4-deduplicator","title":"4. Deduplicator","text":"<p>Strategies for finding and handling duplicates.</p> <pre><code>class Deduplicator(Plugin, ABC):\n    \"\"\"Base class for deduplication plugins.\"\"\"\n\n    @abstractmethod\n    def find_duplicates(self, \n                       entries: List[Entry],\n                       threshold: float = 0.9) -&gt; List[DuplicateGroup]:\n        \"\"\"Find duplicate entries.\"\"\"\n        pass\n\n    @abstractmethod\n    def merge_duplicates(self, \n                        duplicates: DuplicateGroup,\n                        strategy: str = \"newest\") -&gt; Entry:\n        \"\"\"Merge duplicate entries into one.\"\"\"\n        pass\n\nclass DuplicateGroup:\n    entries: List[Entry]\n    similarity_score: float\n    match_reason: str  # \"isbn\", \"title_author\", \"content_hash\", etc.\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#5-validator","title":"5. Validator","text":"<p>Validate entries for correctness and completeness.</p> <pre><code>class Validator(Plugin, ABC):\n    \"\"\"Base class for validation plugins.\"\"\"\n\n    @abstractmethod\n    def validate(self, entry: Entry) -&gt; ValidationResult:\n        \"\"\"Validate an entry.\"\"\"\n        pass\n\nclass ValidationResult:\n    is_valid: bool\n    errors: List[ValidationError]\n    warnings: List[ValidationWarning]\n    completeness_score: float  # 0 to 1\n\nclass ValidationError:\n    field: str\n    message: str\n    severity: str  # \"error\", \"warning\", \"info\"\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#6-exporter","title":"6. Exporter","text":"<p>Export to various formats.</p> <pre><code>class Exporter(Plugin, ABC):\n    \"\"\"Base class for export plugins.\"\"\"\n\n    @abstractmethod\n    async def export(self,\n                    entries: List[Entry],\n                    output_path: str,\n                    options: Dict[str, Any]) -&gt; ExportResult:\n        \"\"\"Export entries to a specific format.\"\"\"\n        pass\n\n    @abstractmethod\n    def supported_formats(self) -&gt; List[str]:\n        \"\"\"Return list of supported export formats.\"\"\"\n        pass\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#plugin-implementation-examples","title":"Plugin Implementation Examples","text":""},{"location":"development/PLUGIN_ARCHITECTURE/#example-1-google-books-plugin","title":"Example 1: Google Books Plugin","text":"<pre><code># ebk/plugins/google_books.py\nimport aiohttp\nfrom ebk.plugins.base import MetadataExtractor\n\nclass GoogleBooksExtractor(MetadataExtractor):\n    \"\"\"Extract metadata from Google Books API.\"\"\"\n\n    def __init__(self, api_key: Optional[str] = None):\n        self.api_key = api_key or os.environ.get(\"GOOGLE_BOOKS_API_KEY\")\n        self.base_url = \"https://www.googleapis.com/books/v1/volumes\"\n\n    async def extract(self, isbn: Optional[str] = None, **kwargs) -&gt; Dict[str, Any]:\n        if not isbn:\n            return {}\n\n        async with aiohttp.ClientSession() as session:\n            params = {\"q\": f\"isbn:{isbn}\"}\n            if self.api_key:\n                params[\"key\"] = self.api_key\n\n            async with session.get(self.base_url, params=params) as resp:\n                data = await resp.json()\n\n        if data.get(\"totalItems\", 0) == 0:\n            return {}\n\n        item = data[\"items\"][0][\"volumeInfo\"]\n\n        return {\n            \"title\": item.get(\"title\"),\n            \"creators\": item.get(\"authors\", []),\n            \"publisher\": item.get(\"publisher\"),\n            \"date\": item.get(\"publishedDate\"),\n            \"description\": item.get(\"description\"),\n            \"subjects\": item.get(\"categories\", []),\n            \"language\": item.get(\"language\"),\n            \"page_count\": item.get(\"pageCount\"),\n            \"cover_url\": item.get(\"imageLinks\", {}).get(\"thumbnail\")\n        }\n\n    def supported_formats(self) -&gt; List[str]:\n        return []  # Works with ISBN, not files\n\n    @property\n    def name(self) -&gt; str:\n        return \"google_books\"\n\n    @property\n    def version(self) -&gt; str:\n        return \"1.0.0\"\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#example-2-openai-tagger-plugin","title":"Example 2: OpenAI Tagger Plugin","text":"<pre><code># ebk/plugins/openai_tagger.py\nimport openai\nfrom ebk.plugins.base import TagSuggester\n\nclass OpenAITagger(TagSuggester):\n    \"\"\"Generate tags using OpenAI GPT.\"\"\"\n\n    def __init__(self, api_key: str, model: str = \"gpt-3.5-turbo\"):\n        self.client = openai.Client(api_key=api_key)\n        self.model = model\n\n    async def suggest_tags(self, \n                          entry: Entry,\n                          max_tags: int = 10,\n                          confidence_threshold: float = 0.5) -&gt; List[TagSuggestion]:\n\n        prompt = f\"\"\"\n        Suggest up to {max_tags} relevant tags for this book:\n        Title: {entry.title}\n        Authors: {', '.join(entry.creators)}\n        Description: {entry.description[:500] if entry.description else 'N/A'}\n        Current subjects: {', '.join(entry.subjects)}\n\n        Return tags as a JSON list with confidence scores.\n        \"\"\"\n\n        response = await self.client.chat.completions.create(\n            model=self.model,\n            messages=[{\"role\": \"user\", \"content\": prompt}],\n            response_format={\"type\": \"json_object\"}\n        )\n\n        suggestions = []\n        for tag_data in response.choices[0].message.content:\n            if tag_data[\"confidence\"] &gt;= confidence_threshold:\n                suggestions.append(TagSuggestion(\n                    tag=tag_data[\"tag\"],\n                    confidence=tag_data[\"confidence\"],\n                    source=\"openai\",\n                    reason=tag_data.get(\"reason\")\n                ))\n\n        return suggestions\n\n    def requires_content(self) -&gt; bool:\n        return False  # Can work with just metadata\n\n    @property\n    def name(self) -&gt; str:\n        return \"openai_tagger\"\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#plugin-discovery-and-registration","title":"Plugin Discovery and Registration","text":""},{"location":"development/PLUGIN_ARCHITECTURE/#automatic-discovery","title":"Automatic Discovery","text":"<pre><code># ebk/plugins/discovery.py\nimport importlib\nimport pkgutil\nfrom typing import Dict, List, Type\n\nclass PluginRegistry:\n    def __init__(self):\n        self._plugins: Dict[str, List[Plugin]] = {}\n        self._hooks: Dict[str, List[Callable]] = {}\n\n    def discover_plugins(self):\n        \"\"\"Discover plugins from installed packages.\"\"\"\n        # 1. Check entry points\n        self._discover_entry_points()\n\n        # 2. Check plugins directory\n        self._discover_local_plugins()\n\n        # 3. Check environment variable\n        self._discover_env_plugins()\n\n    def _discover_entry_points(self):\n        \"\"\"Discover plugins via setuptools entry points.\"\"\"\n        import importlib.metadata\n\n        for ep in importlib.metadata.entry_points().get(\"ebk.plugins\", []):\n            try:\n                plugin_class = ep.load()\n                self.register(plugin_class())\n            except Exception as e:\n                logger.error(f\"Failed to load plugin {ep.name}: {e}\")\n\n    def _discover_local_plugins(self):\n        \"\"\"Discover plugins in the plugins directory.\"\"\"\n        plugins_dir = Path(__file__).parent\n\n        for module_info in pkgutil.iter_modules([str(plugins_dir)]):\n            if module_info.name.startswith(\"_\"):\n                continue\n\n            try:\n                module = importlib.import_module(f\"ebk.plugins.{module_info.name}\")\n\n                for name, obj in inspect.getmembers(module):\n                    if inspect.isclass(obj) and issubclass(obj, Plugin):\n                        self.register(obj())\n            except Exception as e:\n                logger.error(f\"Failed to load plugin module {module_info.name}: {e}\")\n\n    def register(self, plugin: Plugin):\n        \"\"\"Register a plugin instance.\"\"\"\n        plugin_type = type(plugin).__bases__[0].__name__\n\n        if plugin_type not in self._plugins:\n            self._plugins[plugin_type] = []\n\n        self._plugins[plugin_type].append(plugin)\n        logger.info(f\"Registered plugin: {plugin.name} ({plugin_type})\")\n\n    def get_plugins(self, plugin_type: str) -&gt; List[Plugin]:\n        \"\"\"Get all plugins of a specific type.\"\"\"\n        return self._plugins.get(plugin_type, [])\n\n    def get_plugin(self, name: str) -&gt; Optional[Plugin]:\n        \"\"\"Get a specific plugin by name.\"\"\"\n        for plugins in self._plugins.values():\n            for plugin in plugins:\n                if plugin.name == name:\n                    return plugin\n        return None\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#manual-registration","title":"Manual Registration","text":"<pre><code>from ebk import plugin_registry\nfrom my_plugins import CustomTagger\n\n# Register a plugin instance\nregistry.register(CustomTagger())\n\n# Or via decorator\n@register_plugin\nclass MyExtractor(MetadataExtractor):\n    pass\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#hook-system","title":"Hook System","text":""},{"location":"development/PLUGIN_ARCHITECTURE/#defining-hooks","title":"Defining Hooks","text":"<pre><code># ebk/hooks.py\nfrom typing import Callable, Any, List\n\nclass HookRegistry:\n    def __init__(self):\n        self._hooks: Dict[str, List[Callable]] = {}\n\n    def register_hook(self, event: str, callback: Callable):\n        \"\"\"Register a hook callback.\"\"\"\n        if event not in self._hooks:\n            self._hooks[event] = []\n        self._hooks[event].append(callback)\n\n    def trigger(self, event: str, *args, **kwargs) -&gt; List[Any]:\n        \"\"\"Trigger all callbacks for an event.\"\"\"\n        results = []\n        for callback in self._hooks.get(event, []):\n            try:\n                result = callback(*args, **kwargs)\n                if result is not None:\n                    results.append(result)\n            except Exception as e:\n                logger.error(f\"Hook {callback.__name__} failed: {e}\")\n        return results\n\n# Global hook registry\nhooks = HookRegistry()\n\n# Decorator for registering hooks\ndef hook(event: str):\n    def decorator(func: Callable):\n        hooks.register_hook(event, func)\n        return func\n    return decorator\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#using-hooks","title":"Using Hooks","text":"<pre><code># In plugins or user code\n@hook(\"entry.added\")\ndef on_entry_added(entry: Entry, library: Library):\n    \"\"\"Auto-tag new entries.\"\"\"\n    if not entry.tags:\n        tags = suggest_tags(entry)\n        entry.add_tags(tags)\n\n@hook(\"before_export\")\ndef validate_before_export(entries: List[Entry], format: str):\n    \"\"\"Validate entries before export.\"\"\"\n    for entry in entries:\n        if not entry.is_valid():\n            raise ValidationError(f\"Invalid entry: {entry.unique_id}\")\n\n# In core code\ndef add_entry(self, entry: Entry):\n    # ... add logic ...\n    hooks.trigger(\"entry.added\", entry, self)\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#plugin-configuration","title":"Plugin Configuration","text":""},{"location":"development/PLUGIN_ARCHITECTURE/#configuration-schema","title":"Configuration Schema","text":"<pre><code># ebk/plugins/config.py\nfrom pydantic import BaseModel\n\nclass PluginConfig(BaseModel):\n    \"\"\"Base configuration for plugins.\"\"\"\n    enabled: bool = True\n    priority: int = 0  # Higher priority plugins run first\n\nclass GoogleBooksConfig(PluginConfig):\n    api_key: Optional[str] = None\n    rate_limit: int = 100  # requests per minute\n    cache_ttl: int = 3600  # seconds\n\nclass OpenAIConfig(PluginConfig):\n    api_key: str\n    model: str = \"gpt-3.5-turbo\"\n    temperature: float = 0.7\n    max_tokens: int = 150\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#loading-configuration","title":"Loading Configuration","text":"<pre><code># ebk/config.py\nimport yaml\nfrom pathlib import Path\n\ndef load_plugin_config() -&gt; Dict[str, PluginConfig]:\n    \"\"\"Load plugin configuration from file.\"\"\"\n    config_paths = [\n        Path.home() / \".config\" / \"ebk\" / \"plugins.yaml\",\n        Path.home() / \".ebk\" / \"plugins.yaml\",\n        Path(\"./ebk_plugins.yaml\")\n    ]\n\n    for path in config_paths:\n        if path.exists():\n            with open(path) as f:\n                data = yaml.safe_load(f)\n                return parse_plugin_config(data)\n\n    return {}\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#plugin-testing","title":"Plugin Testing","text":""},{"location":"development/PLUGIN_ARCHITECTURE/#test-utilities","title":"Test Utilities","text":"<pre><code># ebk/plugins/testing.py\nfrom unittest.mock import Mock, AsyncMock\n\nclass PluginTestCase:\n    \"\"\"Base test case for plugins.\"\"\"\n\n    def create_mock_entry(self, **kwargs) -&gt; Entry:\n        \"\"\"Create a mock entry for testing.\"\"\"\n        defaults = {\n            \"unique_id\": \"test123\",\n            \"title\": \"Test Book\",\n            \"creators\": [\"Test Author\"],\n            \"subjects\": [\"Testing\"],\n            \"language\": \"en\"\n        }\n        defaults.update(kwargs)\n        return Entry(**defaults)\n\n    def create_mock_plugin(self, plugin_class: Type[Plugin]) -&gt; Mock:\n        \"\"\"Create a mock plugin.\"\"\"\n        mock = Mock(spec=plugin_class)\n        mock.name = f\"mock_{plugin_class.__name__}\"\n        return mock\n\n# Example test\ndef test_google_books_extractor():\n    extractor = GoogleBooksExtractor(api_key=\"test_key\")\n\n    with patch(\"aiohttp.ClientSession\") as mock_session:\n        mock_response = AsyncMock()\n        mock_response.json.return_value = {\n            \"totalItems\": 1,\n            \"items\": [{\n                \"volumeInfo\": {\n                    \"title\": \"Test Book\",\n                    \"authors\": [\"Test Author\"]\n                }\n            }]\n        }\n        mock_session.get.return_value.__aenter__.return_value = mock_response\n\n        result = await extractor.extract(isbn=\"1234567890\")\n        assert result[\"title\"] == \"Test Book\"\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#plugin-packaging","title":"Plugin Packaging","text":""},{"location":"development/PLUGIN_ARCHITECTURE/#directory-structure","title":"Directory Structure","text":"<pre><code>my-ebk-plugin/\n\u251c\u2500\u2500 pyproject.toml\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 my_plugin/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 extractor.py\n\u2502       \u251c\u2500\u2500 tagger.py\n\u2502       \u2514\u2500\u2500 config.py\n\u2514\u2500\u2500 tests/\n    \u2514\u2500\u2500 test_plugin.py\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#setup-configuration","title":"Setup Configuration","text":"<pre><code># pyproject.toml\n[build-system]\nrequires = [\"setuptools&gt;=61.0\", \"wheel\"]\nbuild-backend = \"setuptools.build_meta\"\n\n[project]\nname = \"ebk-my-plugin\"\nversion = \"1.0.0\"\ndependencies = [\n    \"ebk&gt;=2.0.0\",\n    \"aiohttp&gt;=3.8.0\"\n]\n\n[project.entry-points.\"ebk.plugins\"]\nmy_extractor = \"my_plugin:MyExtractor\"\nmy_tagger = \"my_plugin:MyTagger\"\n</code></pre>"},{"location":"development/PLUGIN_ARCHITECTURE/#best-practices","title":"Best Practices","text":"<ol> <li>Async First: Make plugins async for better performance</li> <li>Error Handling: Never let plugin errors crash the main app</li> <li>Logging: Use structured logging for debugging</li> <li>Caching: Cache expensive operations</li> <li>Rate Limiting: Respect API rate limits</li> <li>Configuration: Make everything configurable</li> <li>Testing: Provide comprehensive tests</li> <li>Documentation: Document all plugin capabilities</li> <li>Versioning: Use semantic versioning</li> <li>Dependencies: Keep dependencies minimal</li> </ol> <p>This plugin architecture provides a robust, extensible foundation for EBK that allows users and developers to add functionality without modifying core code.</p>"},{"location":"development/PYTHONIC_API/","title":"EBK Pythonic API Design","text":""},{"location":"development/PYTHONIC_API/#philosophy","title":"Philosophy","text":"<p>The EBK Pythonic API should be: - Intuitive: Follow Python conventions and idioms - Discoverable: IDE autocomplete should guide users - Composable: Small operations combine into complex workflows - Type-Safe: Full type hints for better IDE support - Async-First: I/O operations should be non-blocking - Contextual: Use context managers for resources</p>"},{"location":"development/PYTHONIC_API/#core-api-examples","title":"Core API Examples","text":""},{"location":"development/PYTHONIC_API/#1-basic-operations","title":"1. Basic Operations","text":"<pre><code>from ebk import Library, Entry, Query\nfrom ebk.models import Creator, ReadStatus\n\n# Opening libraries\nlib = Library.open(\"~/ebooks\")                    # Existing library\nlib = Library.create(\"~/new_ebooks\")             # New library\nlib = await Library.async_open(\"~/ebooks\")       # Async variant\n\n# Context manager for auto-save\nwith Library.open(\"~/ebooks\") as lib:\n    lib.add(Entry(title=\"Python Tricks\", ...))\n    # Auto-saves on exit\n\n# Adding entries - multiple ways\nlib.add(Entry(title=\"Book\", creators=[\"Author\"]))\nlib.add(title=\"Book\", creators=[\"Author\"])       # Kwargs shortcut\nlib.add_from_file(\"book.epub\")                   # Auto-extract metadata\nlib.add_from_url(\"https://...\")                  # Download and add\n\n# Batch operations\nwith lib.batch() as batch:\n    for file in Path(\"~/new_books\").glob(\"*.epub\"):\n        batch.add_from_file(file)\n    # Commits all at once for performance\n</code></pre>"},{"location":"development/PYTHONIC_API/#2-query-api-enhanced-fluent-interface","title":"2. Query API (Enhanced Fluent Interface)","text":"<pre><code># Simple queries\nbooks = lib.where(\"language\", \"==\", \"en\")\nbooks = lib.where(\"year\", \"&gt;\", 2020)\nbooks = lib.where(\"rating\", \"&gt;=\", 4.0)\n\n# Complex queries with chaining\nresults = (lib\n    .where(\"language\", \"in\", [\"en\", \"es\"])\n    .where_any(\"subjects\", contains=\"Python\")\n    .where_not(\"read_status\", \"==\", ReadStatus.READ)\n    .order_by(\"rating\", desc=True)\n    .then_by(\"date\", desc=True)\n    .skip(10)\n    .take(20)\n    .execute())\n\n# Lambda queries for complex logic\nresults = lib.filter(lambda e: \n    e.rating &gt; 4 and \n    \"Python\" in e.title and \n    e.year &gt;= 2020\n)\n\n# SQL-like syntax (alternative)\nresults = lib.query(\"\"\"\n    SELECT * FROM entries \n    WHERE language = 'en' \n    AND ANY(subjects, s -&gt; s LIKE '%Python%')\n    ORDER BY rating DESC\n    LIMIT 20\n\"\"\")\n\n# Aggregations\nstats = (lib\n    .group_by(\"language\")\n    .aggregate(\n        count=\"count()\",\n        avg_rating=\"avg(rating)\",\n        total_pages=\"sum(page_count)\"\n    ))\n</code></pre>"},{"location":"development/PYTHONIC_API/#3-entry-api-enhanced","title":"3. Entry API (Enhanced)","text":"<pre><code># Entry creation with builders\nentry = (Entry.builder()\n    .title(\"Clean Code\")\n    .creator(\"Robert C. Martin\", role=\"author\")\n    .creator(\"Timothy Moore\", role=\"narrator\")\n    .subject(\"Programming\")\n    .subject(\"Software Engineering\")\n    .language(\"en\")\n    .isbn(\"978-0132350884\")\n    .build())\n\n# Entry manipulation\nentry.add_tag(\"must-read\")\nentry.remove_tag(\"unread\")\nentry.set_rating(5.0)\nentry.mark_as_read()\nentry.add_note(\"Great book on software craftsmanship\")\n\n# Relationships\nentry.link_to(other_entry, relationship=\"sequel\")\nentry.set_series(\"Clean Code Series\", position=1)\n\n# Validation\nerrors = entry.validate()\nif entry.is_valid():\n    lib.add(entry)\n</code></pre>"},{"location":"development/PYTHONIC_API/#4-metadata-operations","title":"4. Metadata Operations","text":"<pre><code># Auto-enrich metadata using plugins\nawait lib.enrich_metadata(\n    fetch_covers=True,\n    extract_isbn=True,\n    lookup_google_books=True,\n    generate_tags=True\n)\n\n# Specific enrichment\nentry = lib.get(unique_id)\nawait entry.fetch_metadata_from(\"google_books\")\nawait entry.extract_cover()\nawait entry.generate_thumbnail()\n\n# Bulk metadata operations\nawait lib.update_all_metadata(\n    source=\"openlibrary\",\n    overwrite=False,  # Don't overwrite existing\n    fields=[\"description\", \"subjects\", \"isbn\"]\n)\n</code></pre>"},{"location":"development/PYTHONIC_API/#5-plugin-api","title":"5. Plugin API","text":"<pre><code>from ebk.plugins import use_plugin, configure_plugin\n\n# Configure plugins globally\nconfigure_plugin(\"openai\", api_key=\"sk-...\")\nconfigure_plugin(\"google_books\", api_key=\"...\")\n\n# Use plugins explicitly\ntagger = use_plugin(\"openai_tagger\")\ntags = await tagger.suggest_tags(entry)\nentry.add_tags(tags)\n\n# Or use them through the library\nlib.use_plugin(\"openai_tagger\")\nawait lib.auto_tag_all()\n\n# Custom plugin\nfrom ebk.plugins import TagSuggester\n\nclass MyTagger(TagSuggester):\n    def suggest_tags(self, entry: Entry) -&gt; List[str]:\n        # Custom logic\n        return [\"tag1\", \"tag2\"]\n\nlib.register_plugin(MyTagger())\n</code></pre>"},{"location":"development/PYTHONIC_API/#6-importexport-api","title":"6. Import/Export API","text":"<pre><code># Import with options\nfrom ebk.importers import CalibreImporter, EPUBImporter\n\nimported = await lib.import_from(\n    \"~/Calibre Library\",\n    importer=CalibreImporter(),\n    merge_strategy=\"skip_duplicates\",\n    auto_tag=True,\n    validate=True\n)\n\n# Progressive import with callbacks\ndef on_progress(current, total, entry):\n    print(f\"Importing {current}/{total}: {entry.title}\")\n\nawait lib.import_directory(\n    \"~/ebooks\",\n    recursive=True,\n    formats=[\"epub\", \"pdf\", \"mobi\"],\n    on_progress=on_progress,\n    on_error=\"skip\"  # or \"stop\" or callback\n)\n\n# Export with templates\nfrom ebk.exporters import HugoExporter, JSONExporter\n\nawait lib.export_to(\n    \"~/website/content\",\n    exporter=HugoExporter(\n        template=\"academic\",\n        group_by=\"year\",\n        create_indices=True\n    )\n)\n\n# Streaming export for large libraries\nasync with lib.export_stream(\"huge_library.json\") as stream:\n    async for batch in stream.batches(size=100):\n        await process_batch(batch)\n</code></pre>"},{"location":"development/PYTHONIC_API/#7-search-and-similarity","title":"7. Search and Similarity","text":"<pre><code># Full-text search\nresults = await lib.search(\n    \"machine learning\",\n    fields=[\"title\", \"description\", \"content\"],\n    fuzzy=True,\n    max_distance=2\n)\n\n# Semantic search (with embeddings)\nlib.use_plugin(\"semantic_search\")\nsimilar = await lib.find_similar_to(\n    entry,\n    threshold=0.8,\n    limit=10,\n    method=\"embeddings\"  # or \"tf-idf\", \"jaccard\"\n)\n\n# Recommendations\nrecs = await lib.recommend_for_user(\n    based_on=[\"read_history\", \"ratings\"],\n    algorithm=\"collaborative\",  # or \"content\", \"hybrid\"\n    limit=20\n)\n\n# Duplicate detection\nduplicates = lib.find_duplicates(\n    strategy=\"fuzzy_title\",  # or \"isbn\", \"content_hash\"\n    threshold=0.9\n)\n</code></pre>"},{"location":"development/PYTHONIC_API/#8-async-operations","title":"8. Async Operations","text":"<pre><code>import asyncio\nfrom ebk import AsyncLibrary\n\nasync def process_library():\n    async with AsyncLibrary(\"~/ebooks\") as lib:\n        # Concurrent operations\n        tasks = [\n            lib.fetch_cover(entry.id) \n            for entry in await lib.where(\"cover_path\", \"==\", None)\n        ]\n        covers = await asyncio.gather(*tasks)\n\n        # Async iteration\n        async for entry in lib.iter_entries(batch_size=100):\n            await process_entry(entry)\n\n        # Async transactions\n        async with lib.transaction() as tx:\n            await tx.add_many(entries)\n            await tx.remove_where(lambda e: e.year &lt; 2000)\n            # Commits on success, rollbacks on exception\n</code></pre>"},{"location":"development/PYTHONIC_API/#9-event-system","title":"9. Event System","text":"<pre><code>from ebk.events import on, emit\n\n# Register event handlers\n@on(\"entry.added\")\nasync def on_entry_added(entry: Entry):\n    print(f\"New entry: {entry.title}\")\n    await generate_thumbnail(entry)\n\n@on(\"entry.rating_changed\")\ndef on_rating_changed(entry: Entry, old_rating: float, new_rating: float):\n    if new_rating == 5.0:\n        entry.add_tag(\"favorite\")\n\n# Custom events\nemit(\"custom.event\", data={\"key\": \"value\"})\n\n# Event context\nwith lib.events_disabled():\n    # Operations here don't trigger events\n    lib.bulk_update(...)\n</code></pre>"},{"location":"development/PYTHONIC_API/#10-advanced-features","title":"10. Advanced Features","text":"<pre><code># Virtual collections (views without copying)\nfiction = lib.create_view(\n    \"fiction\",\n    filter=lambda e: \"Fiction\" in e.subjects\n)\n\n# Computed fields\nlib.add_computed_field(\n    \"reading_time\",\n    lambda e: e.page_count / 250  # pages per hour\n)\n\n# Indexing for performance\nlib.create_index(\"title\")\nlib.create_index(\"subjects\", type=\"fulltext\")\n\n# Caching\nlib.enable_cache(backend=\"redis\", ttl=3600)\n\n# Transactions\nwith lib.transaction() as tx:\n    tx.add(entry1)\n    tx.update(entry2)\n    tx.delete(entry3)\n    # All or nothing\n\n# Migrations\nfrom ebk.migrations import migrate\n\nmigrate(lib, from_version=\"1.0\", to_version=\"2.0\")\n\n# Backup and restore\nbackup = lib.create_backup()\nlib.restore_from(backup)\n\n# Diff and merge\ndiff = lib1.diff(lib2)\nmerged = lib1.merge(lib2, strategy=\"union\")\n</code></pre>"},{"location":"development/PYTHONIC_API/#11-integration-with-dataframes","title":"11. Integration with DataFrames","text":"<pre><code>import pandas as pd\nimport polars as pl\n\n# Export to DataFrame\ndf = lib.to_pandas()\ndf = lib.to_polars()\n\n# Query using DataFrame operations\ndf = lib.to_pandas()\npython_books = df[df['subjects'].apply(lambda x: 'Python' in x)]\n\n# Import from DataFrame\nlib.from_pandas(df)\nlib.from_polars(df)\n\n# Use SQL via DuckDB\nimport duckdb\nconn = duckdb.connect()\nconn.register(\"books\", lib.to_pandas())\nresult = conn.execute(\"\"\"\n    SELECT title, rating \n    FROM books \n    WHERE rating &gt; 4 \n    ORDER BY date DESC\n\"\"\").fetchdf()\n</code></pre>"},{"location":"development/PYTHONIC_API/#12-cli-integration","title":"12. CLI Integration","text":"<pre><code># Expose any function as CLI command\nfrom ebk.cli import command\n\n@command\ndef analyze_reading_patterns(lib_dir: str, output: str = \"patterns.json\"):\n    \"\"\"Analyze reading patterns in library.\"\"\"\n    lib = Library.open(lib_dir)\n    patterns = lib.analyze_patterns()\n    patterns.save(output)\n\n# Auto-generates: ebk analyze-reading-patterns ~/ebooks --output patterns.json\n</code></pre>"},{"location":"development/PYTHONIC_API/#type-system","title":"Type System","text":"<pre><code>from typing import TypedDict, Literal, Protocol\nfrom pydantic import BaseModel, Field\n\n# Type definitions\nclass EntryDict(TypedDict):\n    unique_id: str\n    title: str\n    creators: List[str]\n    # ... other fields\n\n# Pydantic models for validation\nclass EntryModel(BaseModel):\n    unique_id: str = Field(..., min_length=32, max_length=64)\n    title: str = Field(..., min_length=1, max_length=500)\n    creators: List[Creator] = Field(default_factory=list)\n    rating: Optional[float] = Field(None, ge=0, le=5)\n\n    class Config:\n        json_encoders = {\n            datetime: lambda v: v.isoformat()\n        }\n\n# Protocols for duck typing\nclass Searchable(Protocol):\n    def search(self, query: str) -&gt; List[Entry]: ...\n\nclass Taggable(Protocol):\n    def add_tag(self, tag: str) -&gt; None: ...\n    def remove_tag(self, tag: str) -&gt; None: ...\n</code></pre>"},{"location":"development/PYTHONIC_API/#error-handling","title":"Error Handling","text":"<pre><code>from ebk.exceptions import (\n    LibraryNotFoundError,\n    EntryNotFoundError, \n    ValidationError,\n    DuplicateEntryError,\n    PluginError\n)\n\n# Specific exceptions\ntry:\n    lib = Library.open(\"~/ebooks\")\nexcept LibraryNotFoundError as e:\n    print(f\"Library not found: {e.path}\")\n\n# Validation errors with details\ntry:\n    entry.validate()\nexcept ValidationError as e:\n    for error in e.errors:\n        print(f\"{error.field}: {error.message}\")\n\n# Async error handling\nasync def safe_import(path):\n    try:\n        await lib.import_from(path)\n    except ImportError as e:\n        await lib.log_error(e)\n        return None\n</code></pre>"},{"location":"development/PYTHONIC_API/#performance-patterns","title":"Performance Patterns","text":"<pre><code># Lazy loading\nlib = Library.open(\"~/ebooks\", lazy=True)\n# Metadata loaded on demand\n\n# Prefetching\nentries = lib.where(\"year\", \"&gt;\", 2020).prefetch(\"content\", \"cover\")\n\n# Chunking\nfor chunk in lib.chunks(size=100):\n    process_chunk(chunk)\n\n# Parallel processing\nfrom concurrent.futures import ProcessPoolExecutor\n\nwith ProcessPoolExecutor() as executor:\n    results = executor.map(process_entry, lib.entries)\n\n# Streaming\nasync for entry in lib.stream():\n    await process(entry)\n</code></pre>"},{"location":"development/PYTHONIC_API/#testing-utilities","title":"Testing Utilities","text":"<pre><code>from ebk.testing import LibraryFactory, EntryFactory\n\n# Test fixtures\ndef test_search():\n    lib = LibraryFactory.create(size=100)\n    entry = EntryFactory.create(title=\"Test Book\")\n    lib.add(entry)\n\n    results = lib.search(\"Test\")\n    assert len(results) == 1\n\n# Mocking\nfrom ebk.testing import mock_plugin\n\nwith mock_plugin(\"openai_tagger\") as mock:\n    mock.suggest_tags.return_value = [\"tag1\", \"tag2\"]\n    tags = lib.auto_tag(entry)\n    assert tags == [\"tag1\", \"tag2\"]\n</code></pre> <p>This Pythonic API design provides a comprehensive, intuitive interface for working with EBK libraries programmatically, serving as the foundation for all other interfaces (CLI, Web, API).</p>"},{"location":"development/ROADMAP/","title":"ebk Roadmap &amp; TODOs","text":""},{"location":"development/ROADMAP/#overview","title":"Overview","text":"<p>This document outlines the development roadmap and pending tasks for the ebk project. Items are organized by priority and category.</p> <p>See also: Contributing Guide</p>"},{"location":"development/ROADMAP/#recently-completed","title":"\u2705 Recently Completed","text":"<ul> <li>[x] Plugin system architecture with abstract base classes</li> <li>[x] Plugin registry with automatic discovery</li> <li>[x] Hook system for event-based plugin interaction  </li> <li>[x] Migration from setup.py to pyproject.toml (PEP 517/518/621)</li> <li>[x] Unified HTTP LLM provider for OpenAI-compatible APIs</li> <li>[x] Proper separation of core plugins vs integrations</li> <li>[x] 100% test passing rate achieved</li> <li>[x] Network/graph analysis integration</li> <li>[x] Google Books metadata extractor</li> </ul>"},{"location":"development/ROADMAP/#high-priority","title":"\ud83d\ude80 High Priority","text":""},{"location":"development/ROADMAP/#core-improvements","title":"Core Improvements","text":"<ul> <li>[x] Exporter Module Enhancement - Replace <code>os.system</code> calls with <code>shutil</code> for better security and reliability \u2705</li> <li>[ ] Performance Optimization - Implement lazy loading for large libraries</li> <li>[ ] Async Support - Add async methods for I/O-heavy operations (metadata extraction, API calls)</li> <li>[ ] Caching Layer - Implement metadata caching for faster repeated operations</li> </ul>"},{"location":"development/ROADMAP/#plugin-system","title":"Plugin System","text":"<ul> <li>[ ] Plugin Documentation - Create comprehensive plugin development guide</li> <li>[ ] Plugin Examples - Add example plugins demonstrating each base class</li> <li>[ ] Plugin Testing Framework - Standardized testing utilities for plugin developers</li> <li>[ ] Plugin Marketplace - Consider creating a registry/marketplace for community plugins</li> </ul>"},{"location":"development/ROADMAP/#api-enhancements","title":"API Enhancements","text":"<ul> <li>[ ] GraphQL API - Add GraphQL endpoint for flexible queries</li> <li>[ ] REST API - Create REST API server for remote library access</li> <li>[ ] Webhook Support - Allow plugins to register webhooks for events</li> </ul>"},{"location":"development/ROADMAP/#medium-priority","title":"\ud83d\udccb Medium Priority","text":""},{"location":"development/ROADMAP/#integrations","title":"Integrations","text":"<ul> <li>[ ] Goodreads Integration - Import reading lists and ratings</li> <li>[ ] LibraryThing Integration - Sync with LibraryThing collections</li> <li>[ ] OPDS Server - Implement OPDS catalog server for e-reader apps</li> <li>[ ] Kindle Integration - Import highlights and notes from Kindle</li> <li>[ ] Zotero Integration - Sync with Zotero research libraries</li> </ul>"},{"location":"development/ROADMAP/#export-formats","title":"Export Formats","text":"<ul> <li>[ ] LaTeX/BibTeX Export - Academic bibliography export</li> <li>[ ] CSV/Excel Export - Spreadsheet-compatible formats</li> <li>[ ] MARC21 Export - Library standard format</li> <li>[ ] RIS Export - Reference manager format</li> <li>[ ] Static Site Generators - Support for Jekyll, Gatsby, Next.js</li> </ul>"},{"location":"development/ROADMAP/#search-discovery","title":"Search &amp; Discovery","text":"<ul> <li>[ ] Full-Text Search - Index and search book contents (with plugin)</li> <li>[ ] Semantic Search - Vector embeddings for similarity search</li> <li>[ ] Faceted Search - Advanced filtering with facets</li> <li>[ ] Search History - Track and replay searches</li> <li>[ ] Saved Searches - Store complex queries for reuse</li> </ul>"},{"location":"development/ROADMAP/#low-priority-future-considerations","title":"\ud83d\udd2e Low Priority / Future Considerations","text":""},{"location":"development/ROADMAP/#advanced-features","title":"Advanced Features","text":"<ul> <li>[ ] OCR Support - Extract text from scanned PDFs</li> <li>[ ] Translation Plugin - Auto-translate metadata</li> <li>[ ] Reading Progress Tracking - Track reading status and progress</li> <li>[ ] Annotation System - Store and manage book annotations</li> <li>[ ] Recommendation Engine - ML-based book recommendations</li> <li>[ ] Duplicate Detection - Advanced fuzzy matching for duplicates</li> </ul>"},{"location":"development/ROADMAP/#uiux-improvements","title":"UI/UX Improvements","text":"<ul> <li>[ ] Desktop App - Native desktop application (Electron/Tauri)</li> <li>[ ] Mobile App - iOS/Android companion apps</li> <li>[ ] Browser Extension - Quick-add books from web pages</li> <li>[ ] Terminal UI - Rich TUI for library browsing</li> <li>[ ] Voice Interface - Alexa/Google Assistant integration</li> </ul>"},{"location":"development/ROADMAP/#infrastructure","title":"Infrastructure","text":"<ul> <li>[ ] Docker Image - Official Docker container</li> <li>[ ] Kubernetes Helm Chart - For cloud deployments</li> <li>[ ] Backup/Restore Plugin - Automated backup strategies</li> <li>[ ] Multi-User Support - User accounts and permissions</li> <li>[ ] Federation - Connect multiple ebk instances</li> </ul>"},{"location":"development/ROADMAP/#known-issues","title":"\ud83d\udc1b Known Issues","text":""},{"location":"development/ROADMAP/#current-bugs","title":"Current Bugs","text":"<ul> <li>[ ] PDF cover extraction fails for some encrypted PDFs</li> <li>[ ] Unicode handling issues in some Windows environments</li> <li>[ ] Memory usage high for libraries with 10k+ entries</li> </ul>"},{"location":"development/ROADMAP/#technical-debt","title":"Technical Debt","text":"<ul> <li>[ ] Refactor merge.py to use more efficient algorithms</li> <li>[ ] Standardize error handling across all modules</li> <li>[ ] Improve test coverage for edge cases</li> <li>[ ] Update deprecated dependencies (PyPDF2 \u2192 pypdf)</li> </ul>"},{"location":"development/ROADMAP/#documentation-needs","title":"\ud83d\udcdd Documentation Needs","text":"<ul> <li>[ ] Plugin development tutorial</li> <li>[ ] API reference documentation</li> <li>[ ] Video tutorials for common workflows</li> <li>[ ] Troubleshooting guide</li> <li>[ ] Performance tuning guide</li> <li>[ ] Migration guides from other tools</li> </ul>"},{"location":"development/ROADMAP/#community","title":"\ud83e\udd1d Community","text":"<ul> <li>[ ] Contribution guidelines (contributing.md)</li> <li>[ ] Code of conduct (CODE_OF_CONDUCT.md)</li> <li>[ ] Issue templates for GitHub</li> <li>[ ] Pull request templates</li> <li>[ ] Community forum or Discord server</li> </ul>"},{"location":"development/ROADMAP/#version-planning","title":"Version Planning","text":""},{"location":"development/ROADMAP/#v110-next-minor-release","title":"v1.1.0 (Next Minor Release)","text":"<ul> <li>Exporter shutil migration</li> <li>Plugin documentation</li> <li>Performance optimizations</li> <li>Bug fixes</li> </ul>"},{"location":"development/ROADMAP/#v120","title":"v1.2.0","text":"<ul> <li>REST API</li> <li>OPDS server</li> <li>Full-text search plugin</li> </ul>"},{"location":"development/ROADMAP/#v200-next-major-release","title":"v2.0.0 (Next Major Release)","text":"<ul> <li>Breaking API changes for async support</li> <li>Multi-user support</li> <li>Federation capabilities</li> <li>Desktop/mobile apps</li> </ul>"},{"location":"development/ROADMAP/#contributing","title":"Contributing","text":"<p>We welcome contributions! Please see our Contributing Guide (coming soon) for details on how to get started.</p>"},{"location":"development/ROADMAP/#feedback","title":"Feedback","text":"<p>Have ideas or suggestions? Please open an issue on our GitHub repository or contact us at lex@metafunctor.com.</p> <p>Last updated: 2025-08-24</p>"},{"location":"development/TESTS_QUICK_REFERENCE/","title":"VFS Shell Tests - Quick Reference","text":""},{"location":"development/TESTS_QUICK_REFERENCE/#test-file-location","title":"Test File Location","text":"<p><code>/home/spinoza/github/beta/ebk/tests/test_vfs_shell_commands.py</code></p>"},{"location":"development/TESTS_QUICK_REFERENCE/#test-classes-and-coverage","title":"Test Classes and Coverage","text":"Test Class Tests Feature Coverage Status <code>TestLnCommand</code> 7 Link books to tags, symlink resolution \ud83d\udfe1 Blocked by vfs.resolve bug <code>TestMkdirCommand</code> 6 Create tags via mkdir \ud83d\udfe1 Partial (validation \u2705, creation \u274c) <code>TestEchoAndRedirection</code> 9 Echo command and <code>&gt;</code> redirection \ud83d\udfe1 Blocked by vfs.resolve bug <code>TestFileWritability</code> 6 Writable vs read-only files \ud83d\udfe1 Blocked by vfs.resolve bug <code>TestBookDeletion</code> 7 Delete books with confirmation \u2705 Fully passing <code>TestRmCommand</code> 7 Remove tags, delete books/tags \u2705 Mostly passing <code>TestEdgeCases</code> 6 Special chars, whitespace, etc. \ud83d\udfe1 Blocked by bugs <code>TestIntegrationScenarios</code> 3 Multi-command workflows \ud83d\udfe1 Blocked by bugs TOTAL 51 All VFS features 22 passing, 29 blocked"},{"location":"development/TESTS_QUICK_REFERENCE/#feature-coverage-map","title":"Feature Coverage Map","text":""},{"location":"development/TESTS_QUICK_REFERENCE/#fully-tested-and-working","title":"\u2705 Fully Tested and Working","text":"<ul> <li>[x] Book deletion with \"DELETE\" confirmation</li> <li>[x] Case-sensitive confirmation validation</li> <li>[x] Removing tags from books (<code>rm /tags/Work/42</code>)</li> <li>[x] Deleting empty tags</li> <li>[x] Recursive tag deletion with <code>-r</code> flag</li> <li>[x] Mkdir argument validation</li> <li>[x] Mkdir path restrictions (only /tags/)</li> <li>[x] Echo command basic functionality</li> <li>[x] Book title read-only validation</li> </ul>"},{"location":"development/TESTS_QUICK_REFERENCE/#tested-but-blocked-by-implementation-bugs","title":"\ud83d\udfe1 Tested but Blocked by Implementation Bugs","text":"<ul> <li>[ ] Linking books to tags (<code>ln /books/42 /tags/Work/</code>)</li> <li>[ ] Symlink resolution (<code>ln /tags/Work/42 /tags/Archive/</code>)</li> <li>[ ] Creating tags with mkdir</li> <li>[ ] Output redirection (<code>echo \"text\" &gt; file</code>)</li> <li>[ ] Writing to tag description/color files</li> <li>[ ] File writability checks</li> <li>[ ] Tag hierarchy auto-creation</li> </ul>"},{"location":"development/TESTS_QUICK_REFERENCE/#not-yet-tested","title":"\ud83d\udd34 Not Yet Tested","text":"<ul> <li>[ ] <code>mv</code> command (move between tags)</li> <li>[ ] Pipeline operations with <code>|</code></li> <li>[ ] <code>grep</code> on VFS files</li> <li>[ ] <code>cat</code> on tag metadata files</li> <li>[ ] Tab completion for VFS paths</li> <li>[ ] Bash command passthrough (<code>!command</code>)</li> </ul>"},{"location":"development/TESTS_QUICK_REFERENCE/#test-pattern-examples","title":"Test Pattern Examples","text":""},{"location":"development/TESTS_QUICK_REFERENCE/#basic-command-test","title":"Basic Command Test","text":"<pre><code>def test_ln_book_to_tag(self, shell):\n    # Given: A book exists\n    book = shell.library.query().first()\n\n    # When: We link it to a tag\n    shell.cmd_ln([f\"/books/{book.id}\", \"/tags/Work/\"])\n\n    # Then: Book should have the tag\n    assert \"Work\" in [tag.path for tag in book.tags]\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#error-handling-test","title":"Error Handling Test","text":"<pre><code>def test_ln_invalid_source(self, shell):\n    # When: We try to link non-existent book\n    with patch.object(shell.console, \"print\") as mock_print:\n        shell.cmd_ln([\"/books/99999\", \"/tags/Work/\"])\n\n    # Then: Error message should be shown\n    assert \"not found\" in str(mock_print.call_args_list).lower()\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#user-input-test","title":"User Input Test","text":"<pre><code>def test_delete_book_with_confirmation(self, shell):\n    book = shell.library.query().first()\n\n    # Mock user typing \"DELETE\"\n    with patch.object(shell.session, \"prompt\", return_value=\"DELETE\"):\n        shell.cmd_rm([f\"/books/{book.id}/\"])\n\n    # Book should be deleted\n    assert shell.library.session.query(Book).filter_by(id=book.id).first() is None\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#integration-test","title":"Integration Test","text":"<pre><code>def test_workflow_organize_books_with_tags(self, shell):\n    # Create tag hierarchy\n    shell.cmd_mkdir([\"/tags/Reading/Queue/\"], silent=True)\n    shell.cmd_mkdir([\"/tags/Reading/Completed/\"], silent=True)\n\n    # Add book to queue\n    book = shell.library.query().first()\n    shell.cmd_ln([f\"/books/{book.id}\", \"/tags/Reading/Queue/\"], silent=True)\n\n    # Move to completed\n    shell.cmd_mv([f\"/tags/Reading/Queue/{book.id}\", \"/tags/Reading/Completed/\"], silent=True)\n\n    # Add description\n    shell.execute('echo \"Finished books\" &gt; /tags/Reading/Completed/description')\n\n    # Verify\n    assert len(tag_service.get_tag(\"Reading/Completed\").books) == 1\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#running-tests","title":"Running Tests","text":""},{"location":"development/TESTS_QUICK_REFERENCE/#run-all-vfs-tests","title":"Run all VFS tests","text":"<pre><code>pytest tests/test_vfs_shell_commands.py -v\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#run-specific-feature","title":"Run specific feature","text":"<pre><code>pytest tests/test_vfs_shell_commands.py::TestLnCommand -v\npytest tests/test_vfs_shell_commands.py::TestBookDeletion -v\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#run-with-coverage","title":"Run with coverage","text":"<pre><code>pytest tests/test_vfs_shell_commands.py --cov=ebk.repl.shell --cov=ebk.vfs --cov-report=html\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#run-only-passing-tests","title":"Run only passing tests","text":"<pre><code>pytest tests/test_vfs_shell_commands.py::TestBookDeletion -v\npytest tests/test_vfs_shell_commands.py::TestRmCommand -v\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#known-implementation-bugs-discovered-by-tests","title":"Known Implementation Bugs (Discovered by Tests)","text":""},{"location":"development/TESTS_QUICK_REFERENCE/#bug-1-vfsresolve-doesnt-exist","title":"Bug #1: vfs.resolve() doesn't exist","text":"<p>File: <code>ebk/repl/shell.py</code> Lines: 1178, 869 Fix: <pre><code># Replace:\nnode = self.vfs.resolve(path)\n# With:\nnode = self.vfs.get_node(path)\n</code></pre></p>"},{"location":"development/TESTS_QUICK_REFERENCE/#bug-2-tag_servicecreate_tag-doesnt-exist","title":"Bug #2: tag_service.create_tag() doesn't exist","text":"<p>File: <code>ebk/repl/shell.py</code> Line: 825 Fix: <pre><code># Replace:\ntag = tag_service.create_tag(tag_path)\n# With:\ntag = tag_service.get_or_create_tag(tag_path)\n</code></pre></p>"},{"location":"development/TESTS_QUICK_REFERENCE/#test-fixtures","title":"Test Fixtures","text":""},{"location":"development/TESTS_QUICK_REFERENCE/#temp_library","title":"<code>temp_library</code>","text":"<ul> <li>Creates temporary library</li> <li>Auto-cleanup after test</li> </ul>"},{"location":"development/TESTS_QUICK_REFERENCE/#library_with_books","title":"<code>library_with_books</code>","text":"<ul> <li>3 test books</li> <li>Tags: \"Work\", \"Archive\", \"Reading/Fiction\"</li> <li>Auto-cleanup</li> </ul>"},{"location":"development/TESTS_QUICK_REFERENCE/#shell","title":"<code>shell</code>","text":"<ul> <li>LibraryShell instance</li> <li>Connected to test library</li> <li>Auto-cleanup</li> </ul>"},{"location":"development/TESTS_QUICK_REFERENCE/#mocking-patterns","title":"Mocking Patterns","text":""},{"location":"development/TESTS_QUICK_REFERENCE/#capture-console-output","title":"Capture Console Output","text":"<pre><code>with patch.object(shell.console, \"print\") as mock_print:\n    shell.cmd_ln([\"/books/42\", \"/tags/Work/\"])\n    assert \"\u2713 Added tag\" in str(mock_print.call_args_list)\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#mock-user-input","title":"Mock User Input","text":"<pre><code>with patch.object(shell.session, \"prompt\", return_value=\"DELETE\"):\n    shell.cmd_rm([\"/books/42/\"])\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#silent-mode-no-output","title":"Silent Mode (No Output)","text":"<pre><code>shell.cmd_ln([\"/books/42\", \"/tags/Work/\"], silent=True)\n</code></pre>"},{"location":"development/TESTS_QUICK_REFERENCE/#coverage-targets","title":"Coverage Targets","text":"Module Current Target Gap <code>ebk/repl/shell.py</code> 24% 70%+ Need tests for grep, find, cat, ls <code>ebk/vfs/base.py</code> 63% 80%+ Need edge case tests <code>ebk/vfs/nodes/tags.py</code> 40% 80%+ Need TagNode tests"},{"location":"development/TESTS_QUICK_REFERENCE/#test-metrics","title":"Test Metrics","text":"<ul> <li>Total Tests: 51</li> <li>Passing: 22 (43%)</li> <li>Blocked by bugs: 29 (57%)</li> <li>Test Lines: ~700</li> <li>Code Coverage: 34% overall</li> <li>Time to Run: ~26 seconds</li> </ul>"},{"location":"development/TESTS_QUICK_REFERENCE/#priority-test-additions","title":"Priority Test Additions","text":"<ol> <li>High Priority (Critical features)</li> <li>[ ] <code>mv</code> command tests</li> <li>[ ] Pipeline operations</li> <li> <p>[ ] grep on VFS files</p> </li> <li> <p>Medium Priority (Common operations)</p> </li> <li>[ ] cat on tag files</li> <li>[ ] ls with filters</li> <li> <p>[ ] cd path resolution</p> </li> <li> <p>Low Priority (Nice to have)</p> </li> <li>[ ] Tab completion</li> <li>[ ] History navigation</li> <li>[ ] Bash passthrough</li> </ol>"},{"location":"development/TESTS_QUICK_REFERENCE/#test-maintenance","title":"Test Maintenance","text":""},{"location":"development/TESTS_QUICK_REFERENCE/#when-adding-new-vfs-features","title":"When Adding New VFS Features","text":"<ol> <li>Add test class to <code>test_vfs_shell_commands.py</code></li> <li>Follow Given-When-Then structure</li> <li>Test happy path + error cases</li> <li>Add integration scenario if multi-step</li> <li>Update this reference guide</li> </ol>"},{"location":"development/TESTS_QUICK_REFERENCE/#when-fixing-bugs","title":"When Fixing Bugs","text":"<ol> <li>Write failing test first (TDD)</li> <li>Fix implementation</li> <li>Verify test passes</li> <li>Check coverage increased</li> </ol>"},{"location":"development/TESTS_QUICK_REFERENCE/#when-refactoring","title":"When Refactoring","text":"<ol> <li>Run tests first (should all pass)</li> <li>Make changes</li> <li>Run tests again (should still pass)</li> <li>If tests fail, refactor broke behavior</li> </ol>"},{"location":"development/TEST_DESIGN_SUMMARY/","title":"VFS Shell Commands Test Design Summary","text":""},{"location":"development/TEST_DESIGN_SUMMARY/#overview","title":"Overview","text":"<p>I've designed a comprehensive test suite for the recently implemented VFS (Virtual File System) features in the ebk shell. The test file is located at:</p> <p><code>/home/spinoza/github/beta/ebk/tests/test_vfs_shell_commands.py</code></p>"},{"location":"development/TEST_DESIGN_SUMMARY/#test-coverage","title":"Test Coverage","text":"<p>The test suite contains 51 test cases organized into the following test classes:</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#1-testlncommand-7-tests","title":"1. TestLnCommand (7 tests)","text":"<p>Tests for the <code>ln</code> command which links books to tags.</p> <p>Behaviors Tested: - Linking a book to a tag using direct book path (<code>/books/42</code>) - Linking using symlink source from <code>/tags/</code> directory (symlink resolution) - Automatic creation of tag hierarchy when linking - Error handling for missing arguments - Error handling for invalid/non-existent sources - Error handling for non-tag destinations - Idempotent behavior (linking same book to same tag twice)</p> <p>Key Test Cases: - <code>test_ln_book_to_tag</code> - Basic linking functionality - <code>test_ln_symlink_to_tag</code> - Symlink resolution (<code>ln /tags/Work/42 /tags/Archive/</code>) - <code>test_ln_creates_tag_hierarchy</code> - Auto-creates parent tags - <code>test_ln_idempotent</code> - Safe to link multiple times</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#2-testmkdircommand-6-tests","title":"2. TestMkdirCommand (6 tests)","text":"<p>Tests for the <code>mkdir</code> command which creates tags.</p> <p>Behaviors Tested: - Creating simple root-level tags - Creating nested tag hierarchies with auto-parent creation - Restriction to <code>/tags/</code> directory only - Error handling for missing arguments - Error handling for empty tag paths - Idempotent behavior for existing tags</p> <p>Key Test Cases: - <code>test_mkdir_simple_tag</code> - Create root tag (<code>/tags/NewTag/</code>) - <code>test_mkdir_nested_tag</code> - Create nested hierarchy with auto-parents - <code>test_mkdir_outside_tags_fails</code> - Only works in <code>/tags/</code></p>"},{"location":"development/TEST_DESIGN_SUMMARY/#3-testechoandredirection-9-tests","title":"3. TestEchoAndRedirection (9 tests)","text":"<p>Tests for the <code>echo</code> command and output redirection to VFS files.</p> <p>Behaviors Tested: - Basic echo functionality - Writing to tag description files - Writing to tag color files with hex validation - Error handling for non-existent files - Error handling for read-only files - Overwriting existing content - Writing empty strings to clear content</p> <p>Key Test Cases: - <code>test_redirect_to_tag_description</code> - <code>echo \"text\" &gt; /tags/Work/description</code> - <code>test_redirect_to_tag_color</code> - Auto-adds <code>#</code> prefix for hex colors - <code>test_redirect_to_readonly_file</code> - Prevents writing to book metadata - <code>test_redirect_overwrites_existing_content</code> - Redirection replaces content</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#4-testfilewritability-6-tests","title":"4. TestFileWritability (6 tests)","text":"<p>Tests for file writability checks and write operations.</p> <p>Behaviors Tested: - Tag description files are writable - Tag color files are writable - Book metadata files are read-only - <code>write_to_vfs_file()</code> method with writable files - <code>write_to_vfs_file()</code> method with read-only files - Error handling when writing to directories</p> <p>Key Test Cases: - <code>test_tag_description_is_writable</code> - Validates <code>is_writable()</code> method - <code>test_book_title_is_readonly</code> - Book metadata cannot be modified - <code>test_write_to_vfs_file_success</code> - Direct write method works</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#5-testbookdeletion-7-tests","title":"5. TestBookDeletion (7 tests)","text":"<p>Tests for book deletion with confirmation prompt.</p> <p>Behaviors Tested: - Deleting book with proper \"DELETE\" confirmation - Cancelling deletion with wrong confirmation text - Showing book details in warning prompt - Case-sensitive confirmation (lowercase \"delete\" cancels) - Error handling for non-existent books - Deleting books with associated files - Silent mode bypasses confirmation (for testing)</p> <p>Key Test Cases: - <code>test_delete_book_with_confirmation</code> - Requires typing \"DELETE\" - <code>test_delete_book_cancelled</code> - Any other text cancels - <code>test_delete_book_shows_details</code> - Shows title, authors, file count - <code>test_delete_book_wrong_confirmation</code> - \"delete\" != \"DELETE\"</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#6-testrmcommand-7-tests","title":"6. TestRmCommand (7 tests)","text":"<p>Tests for the <code>rm</code> command (remove tags, delete books).</p> <p>Behaviors Tested: - Removing a tag from a book (<code>rm /tags/Work/42</code>) - Deleting empty tags (<code>rm /tags/EmptyTag/</code>) - Requiring <code>-r</code> flag for tags with children - Recursive tag deletion with <code>-r</code> flag - Warning for non-existent tag removal - Error handling for invalid paths - Missing argument validation</p> <p>Key Test Cases: - <code>test_rm_tag_from_book</code> - Untags a book - <code>test_rm_tag_with_children_requires_recursive</code> - Safety check - <code>test_rm_tag_recursive</code> - <code>rm -r /tags/Parent/</code> deletes children</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#7-testedgecases-6-tests","title":"7. TestEdgeCases (6 tests)","text":"<p>Tests for edge cases and special scenarios.</p> <p>Behaviors Tested: - Tag paths with special characters (hyphens, numbers) - Trailing slash variations in paths - Whitespace handling in redirected content - Adding multiple tags to same book sequentially - Tag color validation for various hex formats - Simultaneous operations maintaining consistency</p> <p>Key Test Cases: - <code>test_tag_color_validation</code> - Accepts <code>FF0000</code>, <code>#00FF00</code>, <code>ABC</code> - <code>test_redirect_with_whitespace_in_content</code> - Strips whitespace - <code>test_ln_book_to_multiple_tags_sequentially</code> - Book can have multiple tags</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#8-testintegrationscenarios-3-tests","title":"8. TestIntegrationScenarios (3 tests)","text":"<p>Tests for realistic multi-command workflows.</p> <p>Workflows Tested: - Organizing books with tag hierarchy (create\u2192link\u2192move\u2192describe) - Deleting a book that has multiple tags (tags persist) - Reorganizing tag hierarchy (create new\u2192move books\u2192cleanup old)</p> <p>Key Test Cases: - <code>test_workflow_organize_books_with_tags</code> - Full organization flow - <code>test_workflow_delete_book_from_tagged_collection</code> - Tags survive book deletion - <code>test_workflow_reorganize_tag_hierarchy</code> - Refactoring tag structure</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#test-design-principles","title":"Test Design Principles","text":""},{"location":"development/TEST_DESIGN_SUMMARY/#1-behavior-focused-testing","title":"1. Behavior-Focused Testing","text":"<p>Tests verify what the system should do, not how it does it: - \u2705 \"When I link a book to a tag, the book should appear in that tag\" - \u274c \"When I link a book, it should call <code>add_tag_to_book()</code> on the service\"</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#2-given-when-then-structure","title":"2. Given-When-Then Structure","text":"<p>All tests follow AAA (Arrange-Act-Assert) pattern: <pre><code>def test_ln_book_to_tag(self, shell):\n    # Given: A book exists in the library\n    book = shell.library.query().first()\n\n    # When: We link the book to a tag\n    shell.cmd_ln([f\"/books/{book.id}\", \"/tags/Work/\"])\n\n    # Then: The book should have the tag\n    tag_paths = [tag.path for tag in book.tags]\n    assert \"Work\" in tag_paths\n</code></pre></p>"},{"location":"development/TEST_DESIGN_SUMMARY/#3-resilient-to-refactoring","title":"3. Resilient to Refactoring","text":"<p>Tests use: - Public APIs only (shell commands, library methods) - Mock only at boundaries (console output, user input) - Assertions on observable outcomes (database state, displayed output) - No testing of private methods or implementation details</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#4-clear-failure-messages","title":"4. Clear Failure Messages","text":"<ul> <li>Descriptive test names explain the scenario</li> <li>Assertions include context when possible</li> <li>Failed tests should immediately show what broke</li> </ul>"},{"location":"development/TEST_DESIGN_SUMMARY/#5-edge-cases-and-error-conditions","title":"5. Edge Cases and Error Conditions","text":"<p>Every command tests: - Happy path (normal usage) - Missing/invalid arguments - Non-existent resources - Permission/write restrictions - Idempotent behavior - Special characters and formatting</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#current-test-results","title":"Current Test Results","text":"<p>Status: 22 PASSING, 29 FAILING</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#bugs-discovered-by-tests","title":"Bugs Discovered by Tests","text":"<p>The failing tests have exposed two bugs in the implementation:</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#bug-1-vfsresolve-method-doesnt-exist","title":"Bug 1: <code>vfs.resolve()</code> method doesn't exist","text":"<p>Location: <code>ebk/repl/shell.py</code> lines 1178, 869 Issue: Code calls <code>self.vfs.resolve(path)</code> but VFS has <code>get_node(path)</code> Affected commands: <code>ln</code>, output redirection Fix: Replace <code>vfs.resolve()</code> with <code>vfs.get_node()</code></p>"},{"location":"development/TEST_DESIGN_SUMMARY/#bug-2-tag_servicecreate_tag-method-doesnt-exist","title":"Bug 2: <code>tag_service.create_tag()</code> method doesn't exist","text":"<p>Location: <code>ebk/repl/shell.py</code> line 825 (mkdir command) Issue: Code calls <code>tag_service.create_tag()</code> but service has <code>get_or_create_tag()</code> Affected commands: <code>mkdir</code> Fix: Replace <code>create_tag(tag_path)</code> with <code>get_or_create_tag(tag_path)</code></p>"},{"location":"development/TEST_DESIGN_SUMMARY/#passing-tests-22","title":"Passing Tests (22)","text":"<p>All tests for: - \u2705 <code>mkdir</code> argument validation and restrictions - \u2705 <code>echo</code> command basic functionality - \u2705 Book deletion workflow with confirmation - \u2705 <code>rm</code> command for removing tags from books - \u2705 Most book deletion scenarios</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#failing-tests-29","title":"Failing Tests (29)","text":"<p>Tests failing due to implementation bugs: - \u274c All <code>ln</code> command tests (vfs.resolve bug) - \u274c <code>mkdir</code> tag creation tests (create_tag bug) - \u274c All output redirection tests (vfs.resolve bug) - \u274c File writability tests (vfs.resolve bug) - \u274c Some integration scenarios (depend on above commands)</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#how-to-use-this-test-suite","title":"How to Use This Test Suite","text":""},{"location":"development/TEST_DESIGN_SUMMARY/#running-all-tests","title":"Running All Tests","text":"<pre><code>python -m pytest tests/test_vfs_shell_commands.py -v\n</code></pre>"},{"location":"development/TEST_DESIGN_SUMMARY/#running-specific-test-class","title":"Running Specific Test Class","text":"<pre><code>python -m pytest tests/test_vfs_shell_commands.py::TestLnCommand -v\npython -m pytest tests/test_vfs_shell_commands.py::TestBookDeletion -v\n</code></pre>"},{"location":"development/TEST_DESIGN_SUMMARY/#running-single-test","title":"Running Single Test","text":"<pre><code>python -m pytest tests/test_vfs_shell_commands.py::TestEchoAndRedirection::test_redirect_to_tag_description -v\n</code></pre>"},{"location":"development/TEST_DESIGN_SUMMARY/#running-with-coverage","title":"Running with Coverage","text":"<pre><code>python -m pytest tests/test_vfs_shell_commands.py --cov=ebk.repl.shell --cov=ebk.vfs --cov-report=html\n</code></pre>"},{"location":"development/TEST_DESIGN_SUMMARY/#current-coverage","title":"Current Coverage","text":"<ul> <li><code>ebk/repl/shell.py</code>: 24% (many commands tested, but many untested branches)</li> <li><code>ebk/vfs/base.py</code>: 63% (good coverage of file node functionality)</li> <li><code>ebk/vfs/nodes/tags.py</code>: 40% (tag VFS nodes partially tested)</li> </ul>"},{"location":"development/TEST_DESIGN_SUMMARY/#fixtures","title":"Fixtures","text":""},{"location":"development/TEST_DESIGN_SUMMARY/#temp_library","title":"<code>temp_library</code>","text":"<p>Creates a temporary library with automatic cleanup.</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#library_with_books","title":"<code>library_with_books</code>","text":"<p>Creates a library with: - 3 test books - Pre-created tags: \"Work\", \"Archive\", \"Reading/Fiction\"</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#shell","title":"<code>shell</code>","text":"<p>Creates a <code>LibraryShell</code> instance with test library, auto-cleanup.</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#test-data-strategy","title":"Test Data Strategy","text":"<p>Tests use: - Builders: Fixtures create consistent test data - Factories: Dynamic creation of books/tags as needed - Isolation: Each test gets fresh library (no shared state) - Realistic data: Books have titles, authors, subjects like real data</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#mocking-strategy","title":"Mocking Strategy","text":"<p>Tests mock at architectural boundaries: - \u2705 Mock <code>console.print()</code> to capture output - \u2705 Mock <code>session.prompt()</code> for user input (confirmation dialogs) - \u274c Don't mock database operations (use real DB with cleanup) - \u274c Don't mock VFS operations (test real VFS behavior)</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#next-steps","title":"Next Steps","text":""},{"location":"development/TEST_DESIGN_SUMMARY/#to-make-all-tests-pass","title":"To Make All Tests Pass","text":"<ol> <li> <p>Fix <code>vfs.resolve()</code> bug: <pre><code># In shell.py, replace:\nnode = self.vfs.resolve(path)\n# With:\nnode = self.vfs.get_node(path)\n</code></pre></p> </li> <li> <p>Fix <code>create_tag()</code> bug: <pre><code># In shell.py line 825, replace:\ntag = tag_service.create_tag(tag_path)\n# With:\ntag = tag_service.get_or_create_tag(tag_path)\n</code></pre></p> </li> </ol>"},{"location":"development/TEST_DESIGN_SUMMARY/#to-improve-coverage","title":"To Improve Coverage","text":"<p>Additional tests could be added for: - <code>mv</code> command (currently not tested) - Pipeline operations (combining commands with <code>|</code>) - <code>grep</code> on VFS files - <code>cat</code> on tag metadata files - Error recovery and rollback scenarios - Concurrent operations (if multi-threading is supported)</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#to-add-to-existing-test-files","title":"To Add to Existing Test Files","text":"<p>Consider adding these VFS tests to: - <code>tests/test_tag_vfs.py</code> - Add tests for writable tag files - <code>tests/test_repl.py</code> - Add integration tests for combined commands</p>"},{"location":"development/TEST_DESIGN_SUMMARY/#file-locations","title":"File Locations","text":"<ul> <li>Test file: <code>/home/spinoza/github/beta/ebk/tests/test_vfs_shell_commands.py</code></li> <li>Code under test:</li> <li><code>/home/spinoza/github/beta/ebk/ebk/repl/shell.py</code></li> <li><code>/home/spinoza/github/beta/ebk/ebk/vfs/base.py</code></li> <li><code>/home/spinoza/github/beta/ebk/ebk/vfs/nodes/tags.py</code></li> <li><code>/home/spinoza/github/beta/ebk/ebk/services/tag_service.py</code></li> </ul>"},{"location":"development/TEST_DESIGN_SUMMARY/#summary","title":"Summary","text":"<p>This test suite provides comprehensive coverage of the VFS shell features with: - 51 test cases covering all major scenarios - Focus on behavior not implementation - Clear structure using Given-When-Then - Resilient design that enables refactoring - Bug discovery - found 2 implementation bugs - 22 passing tests demonstrating working functionality - 29 failing tests ready to pass once bugs are fixed</p> <p>The tests are production-ready and follow TDD best practices. Once the two implementation bugs are fixed, all tests should pass and provide a solid foundation for future development.</p>"},{"location":"development/api-reference/","title":"API Reference","text":"<p>Complete API reference documentation.</p>"},{"location":"development/api-reference/#see-also","title":"See Also","text":"<ul> <li>API Guide - Detailed API documentation</li> <li>Python API - API usage guide</li> </ul>"},{"location":"development/architecture/","title":"Architecture","text":"<p>ebk's architecture and design patterns.</p>"},{"location":"development/architecture/#overview","title":"Overview","text":"<p>ebk is built around several key architectural principles:</p> <ol> <li>SQLAlchemy ORM - Database-first design with normalized schema</li> <li>Service Layer - Business logic separated from data access</li> <li>Provider Pattern - Pluggable LLM and metadata providers</li> <li>Fluent API - Method chaining for intuitive queries</li> <li>Configuration Management - Centralized settings with CLI overrides</li> </ol>"},{"location":"development/architecture/#core-components","title":"Core Components","text":""},{"location":"development/architecture/#database-layer-ebkdb","title":"Database Layer (<code>ebk/db/</code>)","text":"<p>Models (<code>models.py</code>): - <code>Book</code> - Core book entity with metadata - <code>Author</code> - Author information with sort names - <code>Subject</code> - Tags/subjects/categories - <code>File</code> - Physical file records with hash-based deduplication - <code>ExtractedText</code> - Full text from ebooks - <code>TextChunk</code> - Overlapping chunks for semantic search - <code>Cover</code> - Cover images with thumbnails - <code>BooksFTS</code> - FTS5 virtual table for full-text search</p> <p>Session Management (<code>session.py</code>): - Database initialization and schema creation - FTS5 index setup - Connection pooling</p>"},{"location":"development/architecture/#service-layer-ebkservices","title":"Service Layer (<code>ebk/services/</code>)","text":"<p>Import Service (<code>import_service.py</code>): - Book import with metadata extraction - Hash-based file deduplication - Cover extraction and thumbnail generation - Text extraction coordination</p> <p>Text Extraction (<code>text_extraction.py</code>): - PDF extraction (PyMuPDF, pypdf fallback) - EPUB extraction (ebooklib) - Plaintext handling - Chunking for semantic search</p>"},{"location":"development/architecture/#aillm-layer-ebkai","title":"AI/LLM Layer (<code>ebk/ai/</code>)","text":"<p>LLM Providers (<code>llm_providers/</code>): - <code>BaseLLMProvider</code> - Abstract interface - <code>OllamaProvider</code> - Local and remote Ollama - Future: OpenAI, Anthropic, MCP providers</p> <p>Metadata Enrichment (<code>metadata_enrichment.py</code>): - Auto-tagging - Categorization - Description enhancement - Difficulty assessment</p> <p>Knowledge Graph (<code>knowledge_graph.py</code>): - NetworkX-based concept graph - Entity extraction - Relationship mapping</p> <p>Semantic Search (<code>semantic_search.py</code>): - Vector embeddings - Similarity search - Query expansion</p>"},{"location":"development/architecture/#configuration-ebkconfigpy","title":"Configuration (<code>ebk/config.py</code>)","text":"<p>Four configuration sections: - <code>LLMConfig</code> - Provider, model, host, port, API key - <code>ServerConfig</code> - Host, port, auto-open, page size - <code>CLIConfig</code> - Verbosity, color, page size - <code>LibraryConfig</code> - Default library path</p> <p>Stored at: <code>~/.config/ebk/config.json</code></p>"},{"location":"development/architecture/#web-server-ebkserverpy","title":"Web Server (<code>ebk/server.py</code>)","text":"<p>FastAPI-based REST API: - Book CRUD operations - Search and filtering - Cover serving - File downloads - Reading status management</p>"},{"location":"development/architecture/#cli-ebkclipy","title":"CLI (<code>ebk/cli.py</code>)","text":"<p>Typer-based command-line interface: - <code>db-*</code> commands for library management - <code>serve</code> for web server - <code>enrich</code> for AI metadata enrichment - <code>config</code> for configuration management</p>"},{"location":"development/architecture/#design-patterns","title":"Design Patterns","text":""},{"location":"development/architecture/#fluent-query-api","title":"Fluent Query API","text":"<p>Method chaining for intuitive queries:</p> <pre><code>results = (lib.query()\n    .filter_by_language(\"en\")\n    .filter_by_author(\"Knuth\")\n    .order_by(\"title\")\n    .limit(20)\n    .all())\n</code></pre>"},{"location":"development/architecture/#hash-based-deduplication","title":"Hash-Based Deduplication","text":"<p>Files deduplicated using SHA256: - Same file (same hash) \u2192 skipped - Same book, different format \u2192 added as additional format - Hash-prefixed storage: <code>files/ab/abc123.pdf</code></p>"},{"location":"development/architecture/#provider-pattern","title":"Provider Pattern","text":"<p>Swappable LLM backends:</p> <pre><code>from ebk.ai.llm_providers.ollama import OllamaProvider\n\n# Local Ollama\nprovider = OllamaProvider.local(model=\"llama3.2\")\n\n# Remote GPU server\nprovider = OllamaProvider.remote(\n    host=\"192.168.0.225\",\n    model=\"llama3.2\"\n)\n\nasync with provider:\n    response = await provider.complete(\"prompt\")\n</code></pre>"},{"location":"development/architecture/#configuration-hierarchy","title":"Configuration Hierarchy","text":"<p>CLI options &gt; Config file &gt; Defaults:</p> <pre><code># Load config with defaults\nconfig = load_config()\n\n# Override from CLI\nif cli_host:\n    config.server.host = cli_host\n</code></pre>"},{"location":"development/architecture/#database-schema","title":"Database Schema","text":"<p>Library directory structure: <pre><code>my-library/\n\u251c\u2500\u2500 library.db              # SQLite database\n\u251c\u2500\u2500 files/                  # Hash-prefixed ebook storage\n\u2502   \u251c\u2500\u2500 ab/\n\u2502   \u2502   \u2514\u2500\u2500 abc123...pdf\n\u2502   \u2514\u2500\u2500 cd/\n\u2502       \u2514\u2500\u2500 cde456...epub\n\u251c\u2500\u2500 covers/                 # Cover images\n\u2502   \u251c\u2500\u2500 ab/\n\u2502   \u2502   \u2514\u2500\u2500 abc123.jpg\n\u2502   \u2514\u2500\u2500 thumbnails/\n\u2502       \u2514\u2500\u2500 abc123_thumb.jpg\n\u2514\u2500\u2500 vectors/                # Vector embeddings (future)\n    \u2514\u2500\u2500 embeddings.pkl\n</code></pre></p>"},{"location":"development/architecture/#key-technologies","title":"Key Technologies","text":"<ul> <li>SQLAlchemy - ORM and database toolkit</li> <li>SQLite with FTS5 - Database and full-text search</li> <li>FastAPI - Web framework for REST API</li> <li>Typer + Rich - CLI framework with colored output</li> <li>httpx - Async HTTP client for LLM providers</li> <li>PyMuPDF / pypdf - PDF text extraction</li> <li>ebooklib - EPUB parsing</li> <li>Pillow - Image processing for covers</li> <li>NetworkX - Graph algorithms for knowledge graph</li> </ul>"},{"location":"development/architecture/#extension-points","title":"Extension Points","text":"<ol> <li>LLM Providers - Implement <code>BaseLLMProvider</code></li> <li>Plugins - Use plugin registry in <code>ebk/plugins/</code></li> <li>Metadata Extractors - Add to <code>integrations/metadata/</code></li> <li>Export Formats - Add to <code>ebk/exports/</code></li> </ol>"},{"location":"development/architecture/#see-also","title":"See Also","text":"<ul> <li>Contributing Guide - How to contribute</li> <li>API Reference - Python API documentation</li> <li>Source code on GitHub</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Guide to contributing to ebk.</p> <p>We welcome contributions! Whether you're fixing bugs, adding features, improving documentation, or reporting issues, your help is appreciated.</p>"},{"location":"development/contributing/#development-setup","title":"Development Setup","text":""},{"location":"development/contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.10 or higher</li> <li>Git</li> <li>(Optional) Ollama for LLM features</li> </ul>"},{"location":"development/contributing/#setup-steps","title":"Setup Steps","text":"<pre><code># Clone the repository\ngit clone https://github.com/queelius/ebk.git\ncd ebk\n\n# Create virtual environment and install dependencies\nmake setup\n\n# Or manually:\npython -m venv .venv\nsource .venv/bin/activate  # On Windows: .venv\\Scripts\\activate\npip install -e \".[dev,all]\"\n</code></pre>"},{"location":"development/contributing/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\nmake test\n\n# Run with coverage\nmake test-coverage\n\n# Run specific test file\npytest tests/test_library_api.py -v\n\n# Run unit tests only\npytest -m unit\n\n# Run integration tests only\npytest -m integration\n</code></pre>"},{"location":"development/contributing/#code-quality","title":"Code Quality","text":"<pre><code># Run linters\nmake lint\n\n# Format code\nmake format\n\n# Check formatting\nmake format-check\n</code></pre>"},{"location":"development/contributing/#making-changes","title":"Making Changes","text":"<ol> <li> <p>Create a branch for your changes:    <pre><code>git checkout -b feature/my-new-feature\n</code></pre></p> </li> <li> <p>Make your changes following the project style:</p> </li> <li>Use type hints</li> <li>Add docstrings to public APIs</li> <li>Follow PEP 8 style guide</li> <li> <p>Keep functions focused and small</p> </li> <li> <p>Write tests for new functionality:</p> </li> <li>Add unit tests in <code>tests/</code></li> <li>Aim for &gt;80% code coverage</li> <li> <p>Test edge cases and error handling</p> </li> <li> <p>Update documentation:</p> </li> <li>Update <code>/docs</code> for user-facing changes</li> <li>Update docstrings for API changes</li> <li> <p>Add examples for new features</p> </li> <li> <p>Commit your changes:    <pre><code>git add .\ngit commit -m \"Add feature: brief description\"\n</code></pre></p> </li> <li> <p>Push and create PR:    <pre><code>git push origin feature/my-new-feature\n</code></pre>    Then create a pull request on GitHub.</p> </li> </ol>"},{"location":"development/contributing/#project-structure","title":"Project Structure","text":"<pre><code>ebk/\n\u251c\u2500\u2500 ebk/                    # Main package\n\u2502   \u251c\u2500\u2500 ai/                # AI/LLM features\n\u2502   \u251c\u2500\u2500 db/                # Database models\n\u2502   \u251c\u2500\u2500 services/          # Business logic\n\u2502   \u251c\u2500\u2500 cli.py            # CLI commands\n\u2502   \u251c\u2500\u2500 server.py         # Web server\n\u2502   \u2514\u2500\u2500 config.py         # Configuration\n\u251c\u2500\u2500 tests/                 # Test suite\n\u251c\u2500\u2500 docs/                  # Documentation\n\u2514\u2500\u2500 integrations/          # Optional integrations\n</code></pre>"},{"location":"development/contributing/#code-style-guidelines","title":"Code Style Guidelines","text":"<ul> <li>Type Hints: Use type hints for all function signatures</li> <li>Docstrings: Use Google-style docstrings</li> <li>Naming:</li> <li><code>snake_case</code> for functions and variables</li> <li><code>PascalCase</code> for classes</li> <li><code>UPPER_CASE</code> for constants</li> <li>Line Length: Maximum 100 characters</li> <li>Imports: Group standard library, third-party, and local imports</li> </ul>"},{"location":"development/contributing/#adding-new-features","title":"Adding New Features","text":""},{"location":"development/contributing/#adding-an-llm-provider","title":"Adding an LLM Provider","text":"<ol> <li>Create new file in <code>ebk/ai/llm_providers/</code></li> <li>Subclass <code>BaseLLMProvider</code></li> <li>Implement required methods</li> <li>Add tests in <code>tests/ai/</code></li> <li>Update documentation</li> </ol> <p>Example: <pre><code>from .base import BaseLLMProvider, LLMResponse\n\nclass MyProvider(BaseLLMProvider):\n    @property\n    def name(self) -&gt; str:\n        return \"my_provider\"\n\n    async def complete(self, prompt: str, **kwargs) -&gt; LLMResponse:\n        # Implementation\n        pass\n</code></pre></p>"},{"location":"development/contributing/#adding-a-cli-command","title":"Adding a CLI Command","text":"<ol> <li>Add command function in <code>ebk/cli.py</code></li> <li>Use <code>@app.command()</code> decorator</li> <li>Add type hints and help text</li> <li>Load config defaults when appropriate</li> <li>Update <code>docs/user-guide/cli.md</code></li> </ol>"},{"location":"development/contributing/#adding-documentation","title":"Adding Documentation","text":"<ol> <li>Add markdown files to appropriate <code>/docs</code> subdirectory</li> <li>Update <code>mkdocs.yml</code> navigation</li> <li>Follow existing documentation style</li> <li>Include code examples</li> <li>Test with <code>mkdocs serve</code></li> </ol>"},{"location":"development/contributing/#reporting-issues","title":"Reporting Issues","text":"<p>When reporting bugs, please include:</p> <ul> <li>ebk version (<code>ebk --version</code>)</li> <li>Python version</li> <li>Operating system</li> <li>Steps to reproduce</li> <li>Expected vs actual behavior</li> <li>Error messages and stack traces</li> </ul>"},{"location":"development/contributing/#feature-requests","title":"Feature Requests","text":"<p>For feature requests, please describe:</p> <ul> <li>The use case</li> <li>Why existing features don't suffice</li> <li>Proposed API or interface</li> <li>Any implementation ideas</li> </ul>"},{"location":"development/contributing/#questions","title":"Questions?","text":"<ul> <li>Open an issue on GitHub</li> <li>Check existing documentation</li> <li>Review architecture documentation</li> </ul>"},{"location":"development/contributing/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the project's MIT License.</p>"},{"location":"getting-started/configuration/","title":"Configuration Guide","text":"<p>ebk uses a centralized configuration system that stores all settings in a single JSON file. This guide covers how to set up and manage your ebk configuration.</p>"},{"location":"getting-started/configuration/#configuration-file-location","title":"Configuration File Location","text":"<p>The configuration file is stored at:</p> <pre><code>~/.config/ebk/config.json\n</code></pre> <p>On Windows: <pre><code>%USERPROFILE%\\.config\\ebk\\config.json\n</code></pre></p> <p>For backward compatibility, ebk also supports the legacy <code>~/.ebkrc</code> file, but the new JSON format is recommended.</p>"},{"location":"getting-started/configuration/#configuration-structure","title":"Configuration Structure","text":"<p>The configuration file is organized into four main sections:</p>"},{"location":"getting-started/configuration/#llm-configuration","title":"LLM Configuration","text":"<p>Settings for Large Language Model providers used in metadata enrichment:</p> <pre><code>{\n  \"llm\": {\n    \"provider\": \"ollama\",\n    \"model\": \"llama3.2\",\n    \"host\": \"localhost\",\n    \"port\": 11434,\n    \"api_key\": null,\n    \"temperature\": 0.7,\n    \"max_tokens\": null\n  }\n}\n</code></pre> <ul> <li>provider: LLM provider name (<code>ollama</code>, <code>openai</code>, etc.)</li> <li>model: Model name to use</li> <li>host: Server hostname (for remote GPU servers)</li> <li>port: Server port</li> <li>api_key: API key for commercial providers (future)</li> <li>temperature: Sampling temperature (0.0-1.0, lower = more consistent)</li> <li>max_tokens: Maximum tokens to generate (null = provider default)</li> </ul>"},{"location":"getting-started/configuration/#server-configuration","title":"Server Configuration","text":"<p>Settings for the web server interface:</p> <pre><code>{\n  \"server\": {\n    \"host\": \"0.0.0.0\",\n    \"port\": 8000,\n    \"auto_open_browser\": false,\n    \"page_size\": 50\n  }\n}\n</code></pre> <ul> <li>host: Server bind address (<code>0.0.0.0</code> = all interfaces, <code>127.0.0.1</code> = localhost only)</li> <li>port: Server port</li> <li>auto_open_browser: Automatically open browser when starting server</li> <li>page_size: Default number of books per page</li> </ul>"},{"location":"getting-started/configuration/#cli-configuration","title":"CLI Configuration","text":"<p>Default CLI behavior settings:</p> <pre><code>{\n  \"cli\": {\n    \"verbose\": false,\n    \"color\": true,\n    \"page_size\": 50\n  }\n}\n</code></pre> <ul> <li>verbose: Enable verbose logging by default</li> <li>color: Enable colored output (uses Rich)</li> <li>page_size: Default page size for list commands</li> </ul>"},{"location":"getting-started/configuration/#library-configuration","title":"Library Configuration","text":"<p>Library-related preferences:</p> <pre><code>{\n  \"library\": {\n    \"default_path\": null\n  }\n}\n</code></pre> <ul> <li>default_path: Default library path (can be used with commands that accept an optional path)</li> </ul>"},{"location":"getting-started/configuration/#managing-configuration","title":"Managing Configuration","text":""},{"location":"getting-started/configuration/#initialize-configuration","title":"Initialize Configuration","text":"<p>Create a configuration file with default values:</p> <pre><code>ebk config init\n</code></pre> <p>This creates <code>~/.config/ebk/config.json</code> if it doesn't exist.</p>"},{"location":"getting-started/configuration/#view-configuration","title":"View Configuration","text":"<p>View the entire configuration:</p> <pre><code>ebk config show\n</code></pre> <p>View a specific section:</p> <pre><code>ebk config show --section llm\nebk config show --section server\n</code></pre>"},{"location":"getting-started/configuration/#edit-configuration","title":"Edit Configuration","text":"<p>Edit the configuration file in your default editor:</p> <pre><code>ebk config edit\n</code></pre> <p>This opens the JSON file in the editor specified by your <code>EDITOR</code> environment variable.</p>"},{"location":"getting-started/configuration/#set-configuration-values","title":"Set Configuration Values","text":"<p>Set individual configuration values:</p> <pre><code># Set LLM provider\nebk config set llm.provider ollama\nebk config set llm.model llama3.2\nebk config set llm.host localhost\n\n# Set server options\nebk config set server.port 8080\nebk config set server.auto_open_browser true\n\n# Set CLI defaults\nebk config set cli.verbose true\nebk config set cli.page_size 100\n\n# Set library defaults\nebk config set library.default_path ~/my-ebooks\n</code></pre>"},{"location":"getting-started/configuration/#get-configuration-values","title":"Get Configuration Values","text":"<p>Retrieve specific configuration values:</p> <pre><code>ebk config get llm.model\nebk config get server.port\nebk config get library.default_path\n</code></pre>"},{"location":"getting-started/configuration/#common-configuration-scenarios","title":"Common Configuration Scenarios","text":""},{"location":"getting-started/configuration/#local-ollama-setup","title":"Local Ollama Setup","text":"<p>For running LLM features with a local Ollama instance:</p> <pre><code>ebk config init\nebk config set llm.provider ollama\nebk config set llm.model llama3.2\nebk config set llm.host localhost\nebk config set llm.port 11434\n</code></pre> <p>Then install and start Ollama:</p> <pre><code># Install Ollama from https://ollama.com\n# Pull the model\nollama pull llama3.2\n\n# Ollama runs automatically on port 11434\n</code></pre>"},{"location":"getting-started/configuration/#remote-gpu-server","title":"Remote GPU Server","text":"<p>For using a remote GPU server (e.g., basement server with NVIDIA GPU):</p> <pre><code>ebk config set llm.host 192.168.1.100\nebk config set llm.model llama3.2\n</code></pre> <p>Or use hostname:</p> <pre><code>ebk config set llm.host basement-gpu.local\n</code></pre>"},{"location":"getting-started/configuration/#web-server-for-local-access-only","title":"Web Server for Local Access Only","text":"<p>For security, bind the web server to localhost only:</p> <pre><code>ebk config set server.host 127.0.0.1\nebk config set server.port 8000\n</code></pre>"},{"location":"getting-started/configuration/#web-server-for-network-access","title":"Web Server for Network Access","text":"<p>To allow access from other devices on your network:</p> <pre><code>ebk config set server.host 0.0.0.0\nebk config set server.port 8000\n</code></pre> <p>Then access from other devices at <code>http://your-ip:8000</code></p>"},{"location":"getting-started/configuration/#development-mode","title":"Development Mode","text":"<p>For development with verbose output:</p> <pre><code>ebk config set cli.verbose true\nebk config set cli.color true\n</code></pre>"},{"location":"getting-started/configuration/#cli-overrides","title":"CLI Overrides","text":"<p>All configuration settings can be overridden via CLI arguments:</p> <pre><code># Override server settings\nebk serve ~/library --host 127.0.0.1 --port 9000\n\n# Override LLM settings\nebk enrich ~/library --host 192.168.1.50 --model mistral\n\n# Enable verbose mode for single command\nebk --verbose import book.pdf ~/library\n</code></pre> <p>CLI arguments always take precedence over configuration file values.</p>"},{"location":"getting-started/configuration/#environment-variables","title":"Environment Variables","text":"<p>Some settings can also be controlled via environment variables:</p> <pre><code># Ollama settings\nexport OLLAMA_HOST=192.168.1.100\nexport OLLAMA_PORT=11434\n\n# Editor for config edit\nexport EDITOR=vim\n</code></pre>"},{"location":"getting-started/configuration/#configuration-best-practices","title":"Configuration Best Practices","text":"<ol> <li> <p>Set default library path: If you primarily work with one library, set it as default:    <pre><code>ebk config set library.default_path ~/my-ebooks\n</code></pre></p> </li> <li> <p>Use remote GPU for better performance: If you have a machine with a GPU, configure it as the LLM host:    <pre><code>ebk config set llm.host gpu-server.local\n</code></pre></p> </li> <li> <p>Enable auto-open for convenience: If you frequently use the web interface:    <pre><code>ebk config set server.auto_open_browser true\n</code></pre></p> </li> <li> <p>Lower temperature for metadata: For consistent metadata generation:    <pre><code>ebk config set llm.temperature 0.3\n</code></pre></p> </li> <li> <p>Adjust page size for your screen: Larger screens can show more items:    <pre><code>ebk config set cli.page_size 100\nebk config set server.page_size 100\n</code></pre></p> </li> </ol>"},{"location":"getting-started/configuration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/configuration/#configuration-file-not-found","title":"Configuration file not found","text":"<p>If commands don't use your configuration:</p> <pre><code># Check if config exists\nls -la ~/.config/ebk/config.json\n\n# Create if missing\nebk config init\n</code></pre>"},{"location":"getting-started/configuration/#invalid-json","title":"Invalid JSON","text":"<p>If you manually edited the config and broke it:</p> <pre><code># Backup and recreate\nmv ~/.config/ebk/config.json ~/.config/ebk/config.json.bak\nebk config init\n</code></pre>"},{"location":"getting-started/configuration/#llm-connection-issues","title":"LLM connection issues","text":"<p>If metadata enrichment fails:</p> <pre><code># Test Ollama connection\ncurl http://localhost:11434/api/tags\n\n# Or remote server\ncurl http://192.168.1.100:11434/api/tags\n\n# Check configuration\nebk config get llm.host\nebk config get llm.port\n</code></pre>"},{"location":"getting-started/configuration/#server-wont-start","title":"Server won't start","text":"<p>If the web server fails to start:</p> <pre><code># Check if port is in use\nlsof -i :8000\n\n# Try different port\nebk serve ~/library --port 8080\n\n# Or update config\nebk config set server.port 8080\n</code></pre>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Start using ebk</li> <li>LLM Features - Learn about AI-powered features</li> <li>Web Server Guide - Use the web interface</li> <li>CLI Reference - Complete command reference</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.10 or higher</li> <li>pip package manager</li> </ul>"},{"location":"getting-started/installation/#basic-installation","title":"Basic Installation","text":"<p>Install the core ebk package:</p> <pre><code>pip install ebk\n</code></pre>"},{"location":"getting-started/installation/#installation-with-optional-features","title":"Installation with Optional Features","text":""},{"location":"getting-started/installation/#web-dashboard","title":"Web Dashboard","text":"<pre><code>pip install ebk[streamlit]\n</code></pre>"},{"location":"getting-started/installation/#visualization-tools","title":"Visualization Tools","text":"<pre><code>pip install ebk[viz]\n</code></pre>"},{"location":"getting-started/installation/#all-features","title":"All Features","text":"<pre><code>pip install ebk[all]\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<pre><code>pip install ebk[dev]\n</code></pre>"},{"location":"getting-started/installation/#installing-from-source","title":"Installing from Source","text":"<ol> <li> <p>Clone the repository: <pre><code>git clone https://github.com/queelius/ebk.git\ncd ebk\n</code></pre></p> </li> <li> <p>Create a virtual environment (recommended): <pre><code>python -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n</code></pre></p> </li> <li> <p>Install in development mode: <pre><code>pip install -e \".[dev]\"\n</code></pre></p> </li> </ol>"},{"location":"getting-started/installation/#using-the-makefile","title":"Using the Makefile","text":"<p>The project includes a Makefile for common development tasks:</p> <pre><code># Set up complete development environment\nmake setup\n\n# Run tests\nmake test\n\n# Check code coverage\nmake test-coverage\n\n# Format code\nmake format\n\n# Run linting\nmake lint\n</code></pre>"},{"location":"getting-started/installation/#verifying-installation","title":"Verifying Installation","text":"<p>Check that ebk is installed correctly:</p> <pre><code>ebk --version\nebk --help\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Follow the Quick Start Guide to create your first library</li> <li>Read about Configuration options</li> <li>Explore the CLI Reference</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start Guide","text":"<p>This guide will help you get started with ebk in just a few minutes.</p>"},{"location":"getting-started/quickstart/#1-initialize-configuration","title":"1. Initialize Configuration","text":"<p>First, set up your configuration:</p> <pre><code># Create default configuration file\nebk config init\n\n# View current configuration\nebk config show\n\n# Set default library path (optional)\nebk config set library.default_path ~/my-ebooks\n</code></pre>"},{"location":"getting-started/quickstart/#2-create-your-first-library","title":"2. Create Your First Library","text":""},{"location":"getting-started/quickstart/#initialize-a-new-library","title":"Initialize a New Library","text":"<pre><code># Create new library\nebk init ~/my-ebooks\n</code></pre> <p>This creates a directory structure with: - <code>library.db</code> - SQLite database - <code>files/</code> - Ebook storage (hash-prefixed) - <code>covers/</code> - Cover images and thumbnails</p>"},{"location":"getting-started/quickstart/#from-calibre","title":"From Calibre","text":"<p>If you have an existing Calibre library:</p> <pre><code>ebk import-calibre ~/Calibre/Library --output ~/my-ebooks\n</code></pre>"},{"location":"getting-started/quickstart/#from-raw-ebooks","title":"From Raw eBooks","text":"<p>If you have a folder of PDF/EPUB files:</p> <pre><code># Import single file\nebk import book.pdf ~/my-ebooks\n\n# Import multiple files\nebk import ~/Downloads/*.pdf ~/my-ebooks\n\n# Import directory\nebk import ~/Downloads/ebooks ~/my-ebooks --recursive\n</code></pre>"},{"location":"getting-started/quickstart/#3-basic-operations","title":"3. Basic Operations","text":""},{"location":"getting-started/quickstart/#list-books","title":"List Books","text":"<pre><code># List all books\nebk list ~/my-ebooks\n\n# List with filters\nebk list ~/my-ebooks --author \"Knuth\" --language en\nebk list ~/my-ebooks --format pdf --rating 4\n\n# Limit results\nebk list ~/my-ebooks --limit 20\n</code></pre>"},{"location":"getting-started/quickstart/#search-books","title":"Search Books","text":"<pre><code># Full-text search (searches title, description, extracted text)\nebk search \"Python programming\" ~/my-ebooks\n\n# Search specific fields\nebk search \"machine learning\" ~/my-ebooks --fields title,description\n\n# Advanced filters\nebk search \"algorithms\" ~/my-ebooks --language en --author Knuth\n</code></pre>"},{"location":"getting-started/quickstart/#view-statistics","title":"View Statistics","text":"<pre><code># Show library statistics\nebk stats ~/my-ebooks\n\n# JSON output\nebk stats ~/my-ebooks --format json\n</code></pre>"},{"location":"getting-started/quickstart/#4-manage-reading-status","title":"4. Manage Reading Status","text":"<pre><code># Rate a book (0-5 stars)\nebk rate ~/my-ebooks &lt;book-id&gt; 5\n\n# Mark as favorite\nebk favorite ~/my-ebooks &lt;book-id&gt;\n\n# Add personal tags\nebk tag ~/my-ebooks &lt;book-id&gt; --add \"must-read\" \"technical\"\n\n# Remove tags\nebk tag ~/my-ebooks &lt;book-id&gt; --remove \"to-read\"\n</code></pre>"},{"location":"getting-started/quickstart/#5-web-interface","title":"5. Web Interface","text":"<p>Launch the web server to browse your library:</p> <pre><code># Start server\nebk serve ~/my-ebooks\n\n# Custom port\nebk serve ~/my-ebooks --port 8080\n\n# Auto-open browser\nebk serve ~/my-ebooks --auto-open\n\n# Configure defaults\nebk config set server.port 8000\nebk config set server.auto_open_browser true\n</code></pre> <p>Then open <code>http://localhost:8000</code> in your browser.</p>"},{"location":"getting-started/quickstart/#6-ai-powered-features-optional","title":"6. AI-Powered Features (Optional)","text":"<p>Enrich your library metadata using LLMs:</p>"},{"location":"getting-started/quickstart/#setup-ollama","title":"Setup Ollama","text":"<pre><code># Install Ollama from https://ollama.com\ncurl https://ollama.ai/install.sh | sh\n\n# Pull a model\nollama pull llama3.2\n</code></pre>"},{"location":"getting-started/quickstart/#configure-ebk","title":"Configure ebk","text":"<pre><code># Set up LLM provider\nebk config set llm.provider ollama\nebk config set llm.model llama3.2\nebk config set llm.host localhost\n</code></pre>"},{"location":"getting-started/quickstart/#enrich-metadata","title":"Enrich Metadata","text":"<pre><code># Generate tags for all books\nebk enrich ~/my-ebooks --generate-tags\n\n# Full enrichment\nebk enrich ~/my-ebooks \\\n  --generate-tags \\\n  --categorize \\\n  --enhance-descriptions\n\n# Preview changes (dry run)\nebk enrich ~/my-ebooks --generate-tags --dry-run\n</code></pre>"},{"location":"getting-started/quickstart/#using-the-python-api","title":"Using the Python API","text":"<pre><code>from pathlib import Path\nfrom ebk.library_db import Library\n\n# Open library\nlib = Library.open(Path(\"~/my-ebooks\"))\n\n# Search for books\nresults = lib.search(\"Python programming\")\nfor book in results:\n    print(f\"{book.title} by {', '.join([a.name for a in book.authors])}\")\n\n# Fluent query interface\nresults = (lib.query()\n    .filter_by_language(\"en\")\n    .filter_by_author(\"Knuth\")\n    .order_by(\"title\")\n    .limit(10)\n    .all())\n\n# Update reading status\nlib.update_reading_status(book_id=42, status=\"reading\", rating=4)\n\n# Add tags\nlib.add_tags(book_id=42, tags=[\"must-read\", \"algorithms\"])\n\n# Get statistics\nstats = lib.stats()\nprint(f\"Total books: {stats['total_books']}\")\n\n# Always close\nlib.close()\n</code></pre>"},{"location":"getting-started/quickstart/#quick-reference-card","title":"Quick Reference Card","text":""},{"location":"getting-started/quickstart/#common-commands","title":"Common Commands","text":"<pre><code># Initialize\nebk init ~/library\n\n# Import\nebk import book.pdf ~/library\nebk import-calibre ~/Calibre ~/library\n\n# Browse\nebk list ~/library\nebk search \"query\" ~/library\nebk stats ~/library\n\n# Web interface\nebk serve ~/library\n\n# AI enrichment\nebk enrich ~/library --generate-tags\n\n# Configuration\nebk config show\nebk config set key value\n</code></pre>"},{"location":"getting-started/quickstart/#library-structure","title":"Library Structure","text":"<pre><code>~/my-ebooks/\n\u251c\u2500\u2500 library.db           # SQLite database\n\u251c\u2500\u2500 files/               # Ebook files (hash-prefixed)\n\u2502   \u251c\u2500\u2500 ab/\n\u2502   \u2502   \u2514\u2500\u2500 abc123...pdf\n\u2502   \u2514\u2500\u2500 cd/\n\u2502       \u2514\u2500\u2500 cde456...epub\n\u251c\u2500\u2500 covers/              # Cover images\n\u2502   \u251c\u2500\u2500 ab/\n\u2502   \u2502   \u2514\u2500\u2500 abc123.jpg\n\u2502   \u2514\u2500\u2500 thumbnails/\n\u2502       \u2514\u2500\u2500 abc123_thumb.jpg\n\u2514\u2500\u2500 vectors/             # Vector embeddings (future)\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration Guide - Customize settings</li> <li>LLM Features - AI-powered enrichment</li> <li>Web Server - Web interface details</li> <li>CLI Reference - Complete command reference</li> <li>Python API - Programmatic access</li> <li>Import/Export - Data portability</li> </ul>"},{"location":"integrations/","title":"Integrations","text":"<p>Optional integrations for extended functionality.</p>"},{"location":"integrations/#available-integrations","title":"Available Integrations","text":"<ul> <li>Streamlit Dashboard - Web UI</li> <li>MCP Server - AI assistant integration</li> <li>Visualizations - Network graphs</li> </ul>"},{"location":"integrations/mcp/","title":"MCP Server","text":"<p>Model Context Protocol server for AI assistants.</p> <p>See integrations/mcp/README.md for details.</p>"},{"location":"integrations/streamlit/","title":"Streamlit Dashboard","text":"<p>Interactive web interface for ebk.</p>"},{"location":"integrations/streamlit/#installation","title":"Installation","text":"<pre><code>pip install ebk[streamlit]\n</code></pre> <p>See integrations/streamlit-dashboard/README.md for details.</p>"},{"location":"integrations/visualizations/","title":"Visualizations","text":"<p>Network analysis and visualization tools.</p> <p>See integrations/network/README.md for details.</p>"},{"location":"user-guide/api/","title":"Python API","text":"<p>Comprehensive guide to ebk's Python API for programmatic library management.</p>"},{"location":"user-guide/api/#overview","title":"Overview","text":"<p>ebk provides a powerful SQLAlchemy-based API for working with ebook libraries programmatically. The API follows modern Python conventions and supports context managers, fluent queries, and async operations (for LLM features).</p>"},{"location":"user-guide/api/#basic-usage","title":"Basic Usage","text":""},{"location":"user-guide/api/#opening-a-library","title":"Opening a Library","text":"<pre><code>from pathlib import Path\nfrom ebk.library_db import Library\n\n# Open existing library\nlib = Library.open(Path(\"~/my-library\"))\n\n# Use context manager (recommended)\nwith Library.open(Path(\"~/my-library\")) as lib:\n    # Work with library\n    results = lib.search(\"Python\")\n\n# Library is automatically closed\n</code></pre> <p>See the API Guide for complete documentation.</p>"},{"location":"user-guide/api/#core-classes","title":"Core Classes","text":"<ul> <li><code>Library</code> - Main library class</li> <li><code>Book</code> - Book model (SQLAlchemy ORM)</li> <li><code>Author</code> - Author model</li> <li><code>Subject</code> - Subject/tag model</li> <li><code>File</code> - File model</li> <li><code>Cover</code> - Cover image model</li> </ul>"},{"location":"user-guide/api/#further-reading","title":"Further Reading","text":"<ul> <li>API Guide - Complete API reference</li> <li>LLM Features - AI-powered features</li> <li>CLI Reference - Command-line interface</li> </ul>"},{"location":"user-guide/cli/","title":"CLI Reference","text":"<p>Complete reference for all ebk commands.</p>"},{"location":"user-guide/cli/#global-options","title":"Global Options","text":"<pre><code>ebk --help              # Show help\nebk --verbose           # Enable verbose output\nebk --version           # Show version\n</code></pre>"},{"location":"user-guide/cli/#library-management-commands","title":"Library Management Commands","text":""},{"location":"user-guide/cli/#init","title":"init","text":"<p>Initialize a new library:</p> <pre><code>ebk init &lt;library-path&gt;\n</code></pre> <p>Creates a new ebk library with database and directory structure.</p>"},{"location":"user-guide/cli/#import","title":"import","text":"<p>Import ebook files:</p> <pre><code>ebk import &lt;file&gt; &lt;library-path&gt;\nebk import &lt;file1&gt; &lt;file2&gt; ... &lt;library-path&gt;\nebk import ~/books/*.pdf &lt;library-path&gt;\n</code></pre> <p>Options: - <code>--extract-text</code> - Extract text for FTS (default: true) - <code>--extract-cover</code> - Extract cover image (default: true) - <code>--recursive</code> - Import directories recursively</p>"},{"location":"user-guide/cli/#import-calibre","title":"import-calibre","text":"<p>Import from Calibre library:</p> <pre><code>ebk import-calibre &lt;calibre-library&gt; --output &lt;ebk-library&gt;\n</code></pre> <p>Options: - <code>--output</code> - Output library path (required) - <code>--formats</code> - File formats to import (default: all)</p>"},{"location":"user-guide/cli/#list","title":"list","text":"<p>List books in library:</p> <pre><code>ebk list &lt;library-path&gt;\n</code></pre> <p>Options: - <code>--author &lt;name&gt;</code> - Filter by author - <code>--language &lt;code&gt;</code> - Filter by language (e.g., en, de) - <code>--format &lt;format&gt;</code> - Filter by file format (pdf, epub, mobi) - <code>--rating &lt;number&gt;</code> - Filter by minimum rating (0-5) - <code>--tag &lt;tag&gt;</code> - Filter by personal tag - <code>--limit &lt;number&gt;</code> - Limit results (default: 50) - <code>--sort-by &lt;field&gt;</code> - Sort by field (title, author, date, rating) - <code>--format json</code> - Output as JSON</p>"},{"location":"user-guide/cli/#search","title":"search","text":"<p>Full-text search:</p> <pre><code>ebk search &lt;query&gt; &lt;library-path&gt;\n</code></pre> <p>Searches across: - Book title - Description - Extracted text content</p> <p>Options: - <code>--fields &lt;field1,field2&gt;</code> - Limit search to specific fields - <code>--language &lt;code&gt;</code> - Filter by language - <code>--author &lt;name&gt;</code> - Filter by author - <code>--limit &lt;number&gt;</code> - Limit results</p>"},{"location":"user-guide/cli/#stats","title":"stats","text":"<p>Show library statistics:</p> <pre><code>ebk stats &lt;library-path&gt;\n</code></pre> <p>Options: - <code>--format json</code> - Output as JSON</p> <p>Displays: - Total books, authors, subjects - File formats and counts - Languages - Storage size</p>"},{"location":"user-guide/cli/#reading-management","title":"Reading Management","text":""},{"location":"user-guide/cli/#rate","title":"rate","text":"<p>Rate a book:</p> <pre><code>ebk rate &lt;library-path&gt; &lt;book-id&gt; &lt;rating&gt;\n</code></pre> <p>Rating: 0-5 (0 = unrated)</p>"},{"location":"user-guide/cli/#favorite","title":"favorite","text":"<p>Toggle favorite status:</p> <pre><code>ebk favorite &lt;library-path&gt; &lt;book-id&gt;\n</code></pre>"},{"location":"user-guide/cli/#tag","title":"tag","text":"<p>Manage personal tags:</p> <pre><code># Add tags\nebk tag &lt;library-path&gt; &lt;book-id&gt; --add \"tag1\" \"tag2\"\n\n# Remove tags\nebk tag &lt;library-path&gt; &lt;book-id&gt; --remove \"tag1\"\n\n# List tags\nebk tag &lt;library-path&gt; &lt;book-id&gt; --list\n</code></pre>"},{"location":"user-guide/cli/#purge","title":"purge","text":"<p>Remove books from library:</p> <pre><code>ebk purge &lt;library-path&gt; [options]\n</code></pre> <p>Options: - <code>--rating &lt;n&gt;</code> - Remove books with rating &lt;= n - <code>--unread</code> - Remove unread books - <code>--format &lt;fmt&gt;</code> - Remove specific format - <code>--confirm</code> - Skip confirmation prompt</p> <p>Warning: This permanently removes books!</p>"},{"location":"user-guide/cli/#web-server","title":"Web Server","text":""},{"location":"user-guide/cli/#serve","title":"serve","text":"<p>Start web server:</p> <pre><code>ebk serve &lt;library-path&gt;\n</code></pre> <p>Options: - <code>--host &lt;host&gt;</code> - Bind address (default: from config) - <code>--port &lt;port&gt;</code> - Port number (default: from config) - <code>--auto-open</code> - Open browser automatically</p>"},{"location":"user-guide/cli/#ai-powered-features","title":"AI-Powered Features","text":""},{"location":"user-guide/cli/#enrich","title":"enrich","text":"<p>Enrich metadata using LLM:</p> <pre><code>ebk enrich &lt;library-path&gt;\n</code></pre> <p>Options: - <code>--generate-tags</code> - Generate descriptive tags - <code>--categorize</code> - Assign hierarchical categories - <code>--enhance-descriptions</code> - Improve descriptions - <code>--assess-difficulty</code> - Determine reading level - <code>--book-id &lt;id&gt;</code> - Enrich specific book - <code>--host &lt;host&gt;</code> - LLM server host - <code>--model &lt;model&gt;</code> - LLM model name - <code>--dry-run</code> - Preview changes without saving - <code>--batch-size &lt;n&gt;</code> - Process n books at a time</p>"},{"location":"user-guide/cli/#configuration","title":"Configuration","text":""},{"location":"user-guide/cli/#config","title":"config","text":"<p>Manage configuration:</p> <pre><code># Initialize\nebk config init\n\n# View all\nebk config show\n\n# View section\nebk config show --section llm\n\n# Edit\nebk config edit\n\n# Set value\nebk config set &lt;key&gt; &lt;value&gt;\n\n# Get value\nebk config get &lt;key&gt;\n</code></pre> <p>Configuration keys: - <code>llm.provider</code> - LLM provider (ollama, openai) - <code>llm.model</code> - Model name - <code>llm.host</code> - Server host - <code>llm.port</code> - Server port - <code>llm.temperature</code> - Sampling temperature - <code>server.host</code> - Web server host - <code>server.port</code> - Web server port - <code>server.auto_open_browser</code> - Auto-open browser - <code>server.page_size</code> - Results per page - <code>cli.verbose</code> - Verbose output - <code>cli.color</code> - Colored output - <code>library.default_path</code> - Default library path</p>"},{"location":"user-guide/cli/#export-and-utilities","title":"Export and Utilities","text":""},{"location":"user-guide/cli/#export","title":"export","text":"<p>Export library:</p> <pre><code># Export to ZIP\nebk export zip &lt;library-path&gt; &lt;output.zip&gt;\n\n# Export to JSON\nebk export json &lt;library-path&gt; &lt;output.json&gt;\n</code></pre>"},{"location":"user-guide/cli/#vlib","title":"vlib","text":"<p>Manage virtual libraries (filtered views):</p> <pre><code># Create virtual library\nebk vlib create &lt;library-path&gt; &lt;name&gt; [filters]\n\n# List virtual libraries\nebk vlib list &lt;library-path&gt;\n\n# Delete virtual library\nebk vlib delete &lt;library-path&gt; &lt;name&gt;\n</code></pre>"},{"location":"user-guide/cli/#note","title":"note","text":"<p>Manage book notes and annotations:</p> <pre><code># Add note\nebk note add &lt;library-path&gt; &lt;book-id&gt; \"&lt;note text&gt;\"\n\n# List notes\nebk note list &lt;library-path&gt; &lt;book-id&gt;\n\n# Delete note\nebk note delete &lt;library-path&gt; &lt;note-id&gt;\n</code></pre>"},{"location":"user-guide/cli/#view","title":"view","text":"<p>View book content:</p> <pre><code>ebk view &lt;library-path&gt; &lt;book-id&gt;\n</code></pre> <p>Opens the book in the default application for its format.</p>"},{"location":"user-guide/cli/#about","title":"about","text":"<p>Show information about ebk:</p> <pre><code>ebk about\n</code></pre> <p>Displays version, installation path, and configuration location.</p>"},{"location":"user-guide/cli/#examples","title":"Examples","text":""},{"location":"user-guide/cli/#import-and-organize","title":"Import and Organize","text":"<pre><code># Create library\nebk init ~/my-library\n\n# Import Calibre collection\nebk import-calibre ~/Calibre/Library --output ~/my-library\n\n# Import additional files\nebk import ~/Downloads/*.pdf ~/my-library\n\n# Generate tags\nebk enrich ~/my-library --generate-tags\n</code></pre>"},{"location":"user-guide/cli/#search-and-filter","title":"Search and Filter","text":"<pre><code># Search for Python books\nebk search \"Python programming\" ~/my-library\n\n# List highly rated books\nebk list ~/my-library --rating 4\n\n# Find books by Knuth\nebk list ~/my-library --author Knuth\n</code></pre>"},{"location":"user-guide/cli/#web-interface-workflow","title":"Web Interface Workflow","text":"<pre><code># Configure server\nebk config set server.port 8000\nebk config set server.auto_open_browser true\n\n# Start server\nebk serve ~/my-library\n\n# Browse at http://localhost:8000\n</code></pre>"},{"location":"user-guide/cli/#batch-processing","title":"Batch Processing","text":"<pre><code># Import multiple directories\nfind ~/Downloads -name \"*.pdf\" -exec ebk import {} ~/my-library \\;\n\n# Enrich all books\nebk enrich ~/my-library --generate-tags --categorize --batch-size 10\n\n# Export for backup\nebk export zip ~/my-library ~/backup-$(date +%Y%m%d).zip\n</code></pre>"},{"location":"user-guide/cli/#see-also","title":"See Also","text":"<ul> <li>Configuration Guide - Configure defaults</li> <li>LLM Features - AI-powered enrichment</li> <li>Web Server - Web interface details</li> <li>Python API - Programmatic access</li> </ul>"},{"location":"user-guide/import-export/","title":"Import/Export","text":"<p>Guide to importing and exporting ebook libraries.</p>"},{"location":"user-guide/import-export/#importing-books","title":"Importing Books","text":""},{"location":"user-guide/import-export/#from-individual-files","title":"From Individual Files","text":"<pre><code># Import a single ebook\nebk import book.pdf ~/my-library\n\n# Import multiple files with glob patterns\nebk import ~/books/*.epub ~/my-library\n\n# Import with text extraction\nebk import book.pdf ~/my-library --extract-text\n</code></pre>"},{"location":"user-guide/import-export/#from-calibre","title":"From Calibre","text":"<pre><code># Import entire Calibre library\nebk import-calibre ~/Calibre/Library --output ~/my-library\n\n# Import with filters\nebk import-calibre ~/Calibre/Library --output ~/my-library --language en\n</code></pre>"},{"location":"user-guide/import-export/#exporting-libraries","title":"Exporting Libraries","text":""},{"location":"user-guide/import-export/#html-export","title":"HTML Export","text":"<p>Export your library as a self-contained HTML file with pagination and interactive features:</p> <pre><code># Basic HTML export (50 books per page)\nebk export html ~/my-library ~/library.html\n\n# Export for web deployment (copies files and covers)\nebk export html ~/my-library ~/site/library.html \\\n  --base-url /library \\\n  --copy\n\n# Export with filters\nebk export html ~/my-library ~/library.html \\\n  --language en \\\n  --format pdf \\\n  --min-rating 4\n</code></pre> <p>HTML Export Features:</p> <ul> <li>Pagination: Automatically pages through books (50 per page)</li> <li>URL State Tracking: Bookmarkable pages with filters and page numbers in URL</li> <li>Client-side Filtering: Fast filtering by language, format, series, favorites, rating</li> <li>Sorting: Sort by title, author, rating, or date added</li> <li>Search Bar: Basic text search across titles, authors, and subjects</li> <li>Responsive Design: Works on desktop and mobile</li> <li>Offline Capable: Fully self-contained, no server required</li> </ul> <p>File Copying with <code>--copy</code>:</p> <p>The <code>--copy</code> flag copies both ebook files AND cover images to the output directory:</p> <pre><code># Copies to: ~/site/library/ (based on --base-url)\nebk export html ~/my-library ~/site/library.html \\\n  --base-url /library \\\n  --copy\n</code></pre> <p>This creates: <pre><code>~/site/\n\u251c\u2500\u2500 library.html           # HTML catalog\n\u2514\u2500\u2500 library/               # Copied files (based on --base-url)\n    \u251c\u2500\u2500 files/            # Ebook files\n    \u2502   \u251c\u2500\u2500 ab/\n    \u2502   \u2502   \u2514\u2500\u2500 abc123.pdf\n    \u2502   \u2514\u2500\u2500 cd/\n    \u2502       \u2514\u2500\u2500 cde456.epub\n    \u2514\u2500\u2500 covers/           # Cover images\n        \u251c\u2500\u2500 ab/\n        \u2502   \u2514\u2500\u2500 abc123.jpg\n        \u2514\u2500\u2500 thumbnails/\n            \u2514\u2500\u2500 abc123_thumb.jpg\n</code></pre></p> <p>Important: HTML export uses simple client-side filtering, not advanced search syntax. For advanced search (field-specific queries, boolean logic), use:</p> <ul> <li>CLI: <code>ebk search \"title:Python rating:&gt;=4\"</code></li> <li>Web server: <code>ebk serve ~/my-library</code></li> <li>Python API: <code>lib.search(\"title:Python rating:&gt;=4\")</code></li> </ul>"},{"location":"user-guide/import-export/#json-export","title":"JSON Export","text":"<pre><code># Export metadata to JSON\nebk export json ~/my-library ~/metadata.json\n\n# Pretty-printed JSON\nebk export json ~/my-library ~/metadata.json --indent 2\n</code></pre>"},{"location":"user-guide/import-export/#csv-export","title":"CSV Export","text":"<pre><code># Export to CSV format\nebk export csv ~/my-library ~/books.csv\n\n# Export with specific columns\nebk export csv ~/my-library ~/books.csv --columns title,author,isbn\n</code></pre>"},{"location":"user-guide/import-export/#zip-archive","title":"ZIP Archive","text":"<pre><code># Create backup archive\nebk export zip ~/my-library ~/backup.zip\n\n# Include covers in archive\nebk export zip ~/my-library ~/backup.zip --include-covers\n</code></pre>"},{"location":"user-guide/import-export/#importexport-use-cases","title":"Import/Export Use Cases","text":""},{"location":"user-guide/import-export/#backup-and-migration","title":"Backup and Migration","text":"<pre><code># Full backup\nebk export zip ~/my-library ~/backup-$(date +%Y%m%d).zip\n\n# Restore to new location\nebk init ~/new-library\nebk import ~/backup.zip ~/new-library\n</code></pre>"},{"location":"user-guide/import-export/#web-deployment","title":"Web Deployment","text":"<pre><code># Export for Hugo static site\nebk export html ~/my-library ~/hugo/static/library.html \\\n  --base-url /library \\\n  --copy \\\n  --language en \\\n  --has-files\n\n# Deploy to web server\nrsync -av ~/hugo/ user@server:/var/www/site/\n</code></pre>"},{"location":"user-guide/import-export/#library-sharing","title":"Library Sharing","text":"<pre><code># Export filtered subset\nebk export html ~/my-library ~/shared.html \\\n  --subject \"Computer Science\" \\\n  --format pdf \\\n  --min-rating 4\n\n# Share the single HTML file (no server needed)\n</code></pre>"},{"location":"user-guide/import-export/#data-analysis","title":"Data Analysis","text":"<pre><code># Export to JSON for analysis\nebk export json ~/my-library ~/data.json\n\n# Use with jq, pandas, or other tools\ncat ~/data.json | jq '.books[] | select(.rating &gt;= 4) | .title'\n</code></pre>"},{"location":"user-guide/import-export/#see-also","title":"See Also","text":"<ul> <li>CLI Reference - Full import/export command options</li> <li>Search &amp; Query - Filtering books before export</li> <li>Server - Web server for dynamic browsing</li> </ul>"},{"location":"user-guide/library-management/","title":"Library Management","text":"<p>Managing your ebook library.</p>"},{"location":"user-guide/library-management/#see-also","title":"See Also","text":"<ul> <li>CLI Reference - Management commands</li> </ul>"},{"location":"user-guide/llm-features/","title":"LLM-Powered Features","text":"<p>ebk includes AI-powered features for metadata enrichment using Large Language Models (LLMs). These features can automatically generate tags, categorize books, enhance descriptions, and more.</p>"},{"location":"user-guide/llm-features/#overview","title":"Overview","text":"<p>The LLM features are built on an abstract provider system that supports multiple backends:</p> <ul> <li>Ollama - Local and remote models (currently supported)</li> <li>OpenAI - GPT models (planned)</li> <li>Anthropic - Claude models (planned)</li> <li>Custom providers - Extend with your own</li> </ul>"},{"location":"user-guide/llm-features/#quick-start","title":"Quick Start","text":""},{"location":"user-guide/llm-features/#1-install-ollama","title":"1. Install Ollama","text":"<p>First, install Ollama from https://ollama.com</p> <pre><code># On macOS/Linux\ncurl https://ollama.ai/install.sh | sh\n\n# Or download installer from website for Windows\n</code></pre>"},{"location":"user-guide/llm-features/#2-pull-a-model","title":"2. Pull a Model","text":"<pre><code># Pull the recommended model\nollama pull llama3.2\n\n# Or try other models\nollama pull mistral\nollama pull codellama\nollama pull phi3\n</code></pre>"},{"location":"user-guide/llm-features/#3-configure-ebk","title":"3. Configure ebk","text":"<pre><code>ebk config init\nebk config set llm.provider ollama\nebk config set llm.model llama3.2\nebk config set llm.host localhost\n</code></pre>"},{"location":"user-guide/llm-features/#4-enrich-your-library","title":"4. Enrich Your Library","text":"<pre><code># Basic enrichment\nebk enrich ~/my-library\n\n# Full enrichment with all features\nebk enrich ~/my-library \\\n  --generate-tags \\\n  --categorize \\\n  --enhance-descriptions\n</code></pre>"},{"location":"user-guide/llm-features/#metadata-enrichment-features","title":"Metadata Enrichment Features","text":""},{"location":"user-guide/llm-features/#generate-tags","title":"Generate Tags","text":"<p>Automatically generate relevant tags based on book metadata and content:</p> <pre><code># Generate tags for all books\nebk enrich ~/library --generate-tags\n\n# Generate tags for specific book\nebk enrich ~/library --book-id 42 --generate-tags\n</code></pre> <p>Example output: - Input: \"Introduction to Algorithms\" by Cormen et al. - Generated tags: <code>algorithms</code>, <code>computer-science</code>, <code>textbook</code>, <code>data-structures</code>, <code>complexity-theory</code></p>"},{"location":"user-guide/llm-features/#categorize-books","title":"Categorize Books","text":"<p>Automatically assign books to hierarchical categories:</p> <pre><code># Categorize all books\nebk enrich ~/library --categorize\n\n# Categorize specific book\nebk enrich ~/library --book-id 42 --categorize\n</code></pre> <p>Example categories: - <code>Technology &gt; Computer Science &gt; Algorithms</code> - <code>Technology &gt; Programming &gt; Python</code> - <code>Science &gt; Mathematics &gt; Statistics</code></p>"},{"location":"user-guide/llm-features/#enhance-descriptions","title":"Enhance Descriptions","text":"<p>Generate or improve book descriptions based on content samples:</p> <pre><code># Enhance descriptions\nebk enrich ~/library --enhance-descriptions\n\n# For specific book\nebk enrich ~/library --book-id 42 --enhance-descriptions\n</code></pre> <p>This feature: - Creates descriptions for books without them - Expands brief descriptions with more detail - Extracts key themes and topics - Maintains professional tone</p>"},{"location":"user-guide/llm-features/#assess-difficulty-level","title":"Assess Difficulty Level","text":"<p>Automatically determine the reading difficulty level:</p> <pre><code>ebk enrich ~/library --assess-difficulty\n</code></pre> <p>Difficulty levels: - <code>beginner</code> - Introductory material - <code>intermediate</code> - Requires some background - <code>advanced</code> - Specialized knowledge required - <code>expert</code> - Research-level content</p>"},{"location":"user-guide/llm-features/#full-enrichment","title":"Full Enrichment","text":"<p>Run all enrichment features at once:</p> <pre><code># Complete enrichment\nebk enrich ~/library \\\n  --generate-tags \\\n  --categorize \\\n  --enhance-descriptions \\\n  --assess-difficulty\n</code></pre>"},{"location":"user-guide/llm-features/#provider-configuration","title":"Provider Configuration","text":""},{"location":"user-guide/llm-features/#local-ollama","title":"Local Ollama","text":"<p>The default configuration uses a local Ollama instance:</p> <pre><code>ebk config set llm.provider ollama\nebk config set llm.model llama3.2\nebk config set llm.host localhost\nebk config set llm.port 11434\n</code></pre>"},{"location":"user-guide/llm-features/#remote-gpu-server","title":"Remote GPU Server","text":"<p>For faster processing, use a remote machine with GPU:</p> <pre><code># By IP address\nebk config set llm.host 192.168.1.100\n\n# Or by hostname\nebk config set llm.host gpu-server.local\n\n# Test connection\ncurl http://192.168.1.100:11434/api/tags\n</code></pre> <p>Setup remote Ollama:</p> <p>On the remote machine:</p> <pre><code># Install Ollama\ncurl https://ollama.ai/install.sh | sh\n\n# Pull models\nollama pull llama3.2\n\n# Ollama automatically listens on 0.0.0.0:11434\n</code></pre>"},{"location":"user-guide/llm-features/#cli-overrides","title":"CLI Overrides","text":"<p>Override config settings for individual commands:</p> <pre><code># Use different host\nebk enrich ~/library --host 192.168.1.100\n\n# Use different model\nebk enrich ~/library --model mistral\n\n# Combine options\nebk enrich ~/library \\\n  --host gpu-server.local \\\n  --model llama3.2:70b \\\n  --generate-tags \\\n  --categorize\n</code></pre>"},{"location":"user-guide/llm-features/#model-selection","title":"Model Selection","text":""},{"location":"user-guide/llm-features/#recommended-models","title":"Recommended Models","text":"Model Size Speed Quality Use Case <code>llama3.2</code> 7B Fast Good General purpose, recommended <code>llama3.2:1b</code> 1B Very fast Fair Quick processing, limited resources <code>llama3.2:70b</code> 70B Slow Excellent Best quality, requires GPU <code>mistral</code> 7B Fast Good Alternative to llama3.2 <code>phi3</code> 3.8B Fast Good Balanced speed/quality <code>codellama</code> 7B Fast Good Technical books"},{"location":"user-guide/llm-features/#model-parameters","title":"Model Parameters","text":"<p>Adjust model behavior:</p> <pre><code># Lower temperature for consistent results\nebk config set llm.temperature 0.3\n\n# Higher temperature for creative descriptions\nebk config set llm.temperature 0.9\n\n# Limit output length\nebk config set llm.max_tokens 500\n</code></pre> <p>Temperature guide: - <code>0.0-0.3</code> - Very consistent, factual (recommended for tags/categories) - <code>0.4-0.7</code> - Balanced (default) - <code>0.8-1.0</code> - Creative, varied (for descriptions)</p>"},{"location":"user-guide/llm-features/#python-api","title":"Python API","text":"<p>Use LLM features programmatically:</p> <pre><code>from ebk.ai.llm_providers.ollama import OllamaProvider\nfrom ebk.ai.metadata_enrichment import MetadataEnrichmentService\n\n# Initialize provider\nprovider = OllamaProvider.local(model=\"llama3.2\")\n\n# Or remote\nprovider = OllamaProvider.remote(\n    host=\"192.168.1.100\",\n    model=\"llama3.2\"\n)\n\n# Create enrichment service\nservice = MetadataEnrichmentService(provider)\n\n# Use async context manager\nasync with provider:\n    # Generate tags\n    tags = await service.generate_tags(\n        title=\"The Pragmatic Programmer\",\n        authors=[\"Hunt\", \"Thomas\"],\n        description=\"From journeyman to master\"\n    )\n    print(f\"Generated tags: {tags}\")\n\n    # Categorize\n    categories = await service.categorize(\n        title=\"Introduction to Algorithms\",\n        subjects=[\"Algorithms\", \"Computer Science\"]\n    )\n    print(f\"Categories: {categories}\")\n\n    # Enhance description\n    enhanced = await service.enhance_description(\n        title=\"Clean Code\",\n        text_sample=\"Chapter 1: Clean Code...\"\n    )\n    print(f\"Enhanced: {enhanced}\")\n</code></pre>"},{"location":"user-guide/llm-features/#batch-processing","title":"Batch Processing","text":"<p>Process multiple books efficiently:</p> <pre><code>from ebk.library_db import Library\nfrom ebk.ai.llm_providers.ollama import OllamaProvider\nfrom ebk.ai.metadata_enrichment import MetadataEnrichmentService\nfrom pathlib import Path\n\n# Open library\nlib = Library.open(Path(\"~/my-library\"))\n\n# Initialize provider\nprovider = OllamaProvider.local(model=\"llama3.2\")\nservice = MetadataEnrichmentService(provider)\n\nasync with provider:\n    # Get books without tags\n    books = lib.query().limit(10).all()\n\n    for book in books:\n        # Generate tags\n        tags = await service.generate_tags(\n            title=book.title,\n            authors=[a.name for a in book.authors],\n            description=book.description\n        )\n\n        # Add to library\n        lib.add_tags(book.id, tags)\n        print(f\"Added tags to {book.title}: {tags}\")\n\nlib.close()\n</code></pre>"},{"location":"user-guide/llm-features/#advanced-usage","title":"Advanced Usage","text":""},{"location":"user-guide/llm-features/#dry-run-mode","title":"Dry Run Mode","text":"<p>Preview changes without saving:</p> <pre><code># See what would be changed\nebk enrich ~/library --generate-tags --dry-run\n</code></pre> <p>This outputs proposed changes but doesn't modify the library.</p>"},{"location":"user-guide/llm-features/#selective-enrichment","title":"Selective Enrichment","text":"<p>Enrich only books matching criteria:</p> <pre><code># Only books without descriptions\nebk enrich ~/library --enhance-descriptions --filter \"description:null\"\n\n# Only books in specific language\nebk enrich ~/library --generate-tags --filter \"language:en\"\n\n# Only specific author\nebk enrich ~/library --categorize --filter \"author:Knuth\"\n</code></pre>"},{"location":"user-guide/llm-features/#custom-prompts","title":"Custom Prompts","text":"<p>Customize the prompts used for enrichment:</p> <pre><code>from ebk.ai.metadata_enrichment import MetadataEnrichmentService\n\nservice = MetadataEnrichmentService(provider)\n\n# Custom tag generation prompt\ncustom_prompt = \"\"\"\nBased on this book:\nTitle: {title}\nAuthors: {authors}\nDescription: {description}\n\nGenerate 5-7 specific technical tags focusing on:\n1. Programming languages mentioned\n2. Specific technologies or frameworks\n3. Target audience level\n4. Book format (reference, tutorial, guide)\n\nReturn as comma-separated list.\n\"\"\"\n\ntags = await service.generate_tags_with_prompt(\n    title=\"Python Crash Course\",\n    custom_prompt=custom_prompt\n)\n</code></pre>"},{"location":"user-guide/llm-features/#performance-optimization","title":"Performance Optimization","text":""},{"location":"user-guide/llm-features/#use-remote-gpu","title":"Use Remote GPU","text":"<p>10-100x speedup by using a machine with NVIDIA GPU:</p> <pre><code># Configure remote GPU server\nebk config set llm.host gpu-server.local\n\n# Verify GPU is being used\nssh gpu-server.local nvidia-smi\n</code></pre>"},{"location":"user-guide/llm-features/#batch-size","title":"Batch Size","text":"<p>Process multiple books in parallel:</p> <pre><code># Process 10 books at a time\nebk enrich ~/library --batch-size 10\n</code></pre>"},{"location":"user-guide/llm-features/#model-selection_1","title":"Model Selection","text":"<p>Choose model based on speed/quality tradeoff:</p> <pre><code># Fastest (1B parameters)\nebk enrich ~/library --model llama3.2:1b\n\n# Balanced (7B parameters, recommended)\nebk enrich ~/library --model llama3.2\n\n# Best quality (70B parameters, slow)\nebk enrich ~/library --model llama3.2:70b\n</code></pre>"},{"location":"user-guide/llm-features/#text-sampling","title":"Text Sampling","text":"<p>Limit text analyzed for speed:</p> <pre><code># Use first 5000 chars of extracted text\nebk enrich ~/library --text-sample-size 5000\n</code></pre>"},{"location":"user-guide/llm-features/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/llm-features/#connection-refused","title":"Connection Refused","text":"<p>If ebk can't connect to Ollama:</p> <pre><code># Check if Ollama is running\ncurl http://localhost:11434/api/tags\n\n# Start Ollama (if needed)\nollama serve\n\n# Check configuration\nebk config get llm.host\nebk config get llm.port\n</code></pre>"},{"location":"user-guide/llm-features/#model-not-found","title":"Model Not Found","text":"<p>If the model isn't available:</p> <pre><code># List available models\nollama list\n\n# Pull the required model\nollama pull llama3.2\n\n# Verify model is available\ncurl http://localhost:11434/api/tags\n</code></pre>"},{"location":"user-guide/llm-features/#slow-performance","title":"Slow Performance","text":"<p>If enrichment is too slow:</p> <ol> <li> <p>Use remote GPU server: <pre><code>ebk config set llm.host gpu-server.local\n</code></pre></p> </li> <li> <p>Use smaller model: <pre><code>ebk config set llm.model llama3.2:1b\n</code></pre></p> </li> <li> <p>Reduce text sample size: <pre><code>ebk enrich ~/library --text-sample-size 2000\n</code></pre></p> </li> <li> <p>Process in batches: <pre><code>ebk enrich ~/library --batch-size 5\n</code></pre></p> </li> </ol>"},{"location":"user-guide/llm-features/#out-of-memory","title":"Out of Memory","text":"<p>If Ollama runs out of memory:</p> <ol> <li> <p>Use smaller model: <pre><code>ollama pull llama3.2:1b\nebk config set llm.model llama3.2:1b\n</code></pre></p> </li> <li> <p>Reduce context size: <pre><code>ebk config set llm.max_tokens 500\n</code></pre></p> </li> <li> <p>Close other applications consuming memory</p> </li> <li> <p>Use remote server with more RAM</p> </li> </ol>"},{"location":"user-guide/llm-features/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Start with dry run to preview changes:    <pre><code>ebk enrich ~/library --generate-tags --dry-run\n</code></pre></p> </li> <li> <p>Use appropriate temperature:</p> </li> <li>Tags/categories: 0.3 (consistent)</li> <li> <p>Descriptions: 0.7 (balanced)</p> </li> <li> <p>Process in batches for large libraries:    <pre><code>ebk enrich ~/library --batch-size 10\n</code></pre></p> </li> <li> <p>Use remote GPU for speed:    <pre><code>ebk config set llm.host gpu-server.local\n</code></pre></p> </li> <li> <p>Review and refine generated metadata periodically</p> </li> <li> <p>Backup library before bulk enrichment:    <pre><code>ebk export zip ~/library ~/backup.zip\n</code></pre></p> </li> </ol>"},{"location":"user-guide/llm-features/#examples","title":"Examples","text":""},{"location":"user-guide/llm-features/#enrich-new-import","title":"Enrich New Import","text":"<p>After importing books, enrich their metadata:</p> <pre><code># Import from Calibre\nebk import-calibre ~/Calibre/Library --output ~/my-library\n\n# Generate tags for all books\nebk enrich ~/my-library --generate-tags\n\n# Categorize\nebk enrich ~/my-library --categorize\n</code></pre>"},{"location":"user-guide/llm-features/#improve-existing-metadata","title":"Improve Existing Metadata","text":"<p>Enhance metadata for existing library:</p> <pre><code># Enhance descriptions for books without them\nebk enrich ~/library --enhance-descriptions --filter \"description:null\"\n\n# Add tags to all books\nebk enrich ~/library --generate-tags\n</code></pre>"},{"location":"user-guide/llm-features/#target-specific-books","title":"Target Specific Books","text":"<p>Enrich specific subset of books:</p> <pre><code># Only Python books\nebk enrich ~/library --generate-tags --filter \"subject:Python\"\n\n# Only books from specific author\nebk enrich ~/library --categorize --filter \"author:Knuth\"\n\n# Only recent books\nebk enrich ~/library --enhance-descriptions --filter \"year:2020-\"\n</code></pre>"},{"location":"user-guide/llm-features/#future-features","title":"Future Features","text":"<p>Planned LLM-powered features:</p> <ul> <li>Similarity detection - Find duplicate books with different metadata</li> <li>Summary generation - Create book summaries from content</li> <li>Reading level assessment - Determine appropriate audience</li> <li>Topic extraction - Identify key topics and themes</li> <li>Citation extraction - Extract and link referenced works</li> <li>Question generation - Create study questions</li> <li>Translation - Translate metadata between languages</li> </ul>"},{"location":"user-guide/llm-features/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration Guide - Set up LLM provider</li> <li>CLI Reference - Complete command reference</li> <li>Python API - Programmatic access</li> <li>LLM Providers README - Provider details</li> </ul>"},{"location":"user-guide/search/","title":"Search &amp; Query","text":"<p>ebk provides powerful search capabilities with field-specific queries, boolean logic, and full-text search powered by SQLite FTS5.</p>"},{"location":"user-guide/search/#quick-start","title":"Quick Start","text":"<pre><code># Simple full-text search\nebk search \"machine learning\" ~/my-library\n\n# Field-specific search\nebk search \"title:Python rating:&gt;=4\" ~/my-library\n\n# Multiple criteria\nebk search \"author:Knuth format:pdf\" ~/my-library\n</code></pre>"},{"location":"user-guide/search/#advanced-search-syntax","title":"Advanced Search Syntax","text":""},{"location":"user-guide/search/#field-specific-searches","title":"Field-Specific Searches","text":"<p>Search within specific fields using <code>field:value</code> syntax:</p> Field Description Example <code>title:</code> Search in book titles <code>title:Python</code> <code>author:</code> Search by author name <code>author:Knuth</code> <code>tag:</code> or <code>subject:</code> Search subjects/tags <code>tag:programming</code> <code>description:</code> Search in book descriptions <code>description:algorithms</code> <code>text:</code> Search in extracted text <code>text:recursion</code> <code>series:</code> Search by series name <code>series:TAOCP</code> <p>Examples:</p> <pre><code># Books with \"intelligence\" in the title\nebk search \"title:intelligence\" ~/my-library\n\n# Books by Donald Knuth\nebk search \"author:Knuth\" ~/my-library\n\n# Books tagged with \"programming\"\nebk search \"tag:programming\" ~/my-library\n\n# Search book descriptions for \"algorithm\"\nebk search \"description:algorithm\" ~/my-library\n</code></pre>"},{"location":"user-guide/search/#filter-fields","title":"Filter Fields","text":"<p>Apply exact filters using the same syntax:</p> Filter Description Example <code>language:</code> Filter by language code <code>language:en</code> <code>format:</code> Filter by file format <code>format:pdf</code> <code>rating:</code> Filter by rating (with operators) <code>rating:&gt;=4</code> <code>favorite:</code> Filter favorites only <code>favorite:true</code> <code>status:</code> Filter by reading status <code>status:reading</code> <p>Examples:</p> <pre><code># English books only\nebk search \"python language:en\" ~/my-library\n\n# PDF files only\nebk search \"algorithms format:pdf\" ~/my-library\n\n# Books rated 4 stars or higher\nebk search \"title:learning rating:&gt;=4\" ~/my-library\n\n# Favorite books\nebk search \"programming favorite:true\" ~/my-library\n</code></pre>"},{"location":"user-guide/search/#rating-comparisons","title":"Rating Comparisons","text":"<p>The <code>rating:</code> filter supports comparison operators:</p> <pre><code>rating:5           # Exactly 5 stars\nrating:&gt;=4         # 4 stars or higher\nrating:&gt;3          # Greater than 3 stars\nrating:&lt;4          # Less than 4 stars\nrating:3-5         # Between 3 and 5 stars (range)\n</code></pre> <p>Examples:</p> <pre><code># Highly rated Python books\nebk search \"title:Python rating:&gt;=4\" ~/my-library\n\n# Books rated between 3 and 4 stars\nebk search \"rating:3-4\" ~/my-library\n</code></pre>"},{"location":"user-guide/search/#boolean-operators","title":"Boolean Operators","text":"<p>Combine search terms with boolean logic:</p> Operator Behavior Example (space) Implicit AND <code>python programming</code> <code>OR</code> Explicit OR <code>python OR java</code> <code>NOT</code> Exclude term <code>programming NOT java</code> <code>-</code> prefix Exclude (shorthand) <code>programming -java</code> <p>Examples:</p> <pre><code># Books about both Python AND machine learning\nebk search \"python machine learning\" ~/my-library\n\n# Books about Python OR JavaScript\nebk search \"python OR javascript\" ~/my-library\n\n# Programming books excluding Java\nebk search \"programming NOT java\" ~/my-library\n\n# Same as above, using shorthand\nebk search \"programming -java\" ~/my-library\n</code></pre>"},{"location":"user-guide/search/#phrase-searches","title":"Phrase Searches","text":"<p>Use quotes for exact phrase matching:</p> <pre><code># Exact phrase\nebk search '\"machine learning\"' ~/my-library\n\n# Phrase in specific field\nebk search 'title:\"deep learning\"' ~/my-library\n\n# Phrase with filters\nebk search '\"artificial intelligence\" language:en format:pdf' ~/my-library\n</code></pre>"},{"location":"user-guide/search/#combined-queries","title":"Combined Queries","text":"<p>Mix field searches, filters, and boolean logic:</p> <pre><code># Python books, 4+ stars, PDF format\nebk search \"title:Python rating:&gt;=4 format:pdf\" ~/my-library\n\n# Books by Knuth in his TAOCP series\nebk search \"author:Knuth series:TAOCP\" ~/my-library\n\n# Favorite programming books (not Java)\nebk search \"tag:programming favorite:true NOT java\" ~/my-library\n\n# Machine learning books in English, highly rated\nebk search '\"machine learning\" language:en rating:&gt;=4' ~/my-library\n</code></pre>"},{"location":"user-guide/search/#full-text-search-fts5","title":"Full-Text Search (FTS5)","text":"<p>ebk uses SQLite FTS5 for fast full-text indexing across:</p> <ul> <li>Book titles</li> <li>Descriptions</li> <li>Extracted text from PDFs, EPUBs, and plaintext files</li> </ul> <p>The FTS5 engine provides:</p> <ul> <li>Porter stemming: Searches for \"running\" also match \"run\", \"runs\", etc.</li> <li>Unicode support: Full support for international characters</li> <li>Ranking: Results ordered by relevance</li> <li>Fast performance: Indexed searches even on large libraries</li> </ul>"},{"location":"user-guide/search/#search-in-different-contexts","title":"Search in Different Contexts","text":""},{"location":"user-guide/search/#cli-search","title":"CLI Search","text":"<pre><code># Basic search\nebk search \"query\" ~/my-library\n\n# Limit results\nebk search \"query\" ~/my-library --limit 20\n</code></pre>"},{"location":"user-guide/search/#web-server-search","title":"Web Server Search","text":"<p>The web server (<code>ebk serve</code>) provides advanced search via REST API:</p> <pre><code># Start server\nebk serve ~/my-library\n\n# Search via API\ncurl \"http://localhost:8000/api/search?q=title:Python+rating:&gt;=4\"\n</code></pre> <p>The web UI includes a search bar with the same advanced syntax.</p>"},{"location":"user-guide/search/#python-api","title":"Python API","text":"<pre><code>from ebk.library_db import Library\nfrom pathlib import Path\n\nlib = Library.open(Path(\"~/my-library\"))\n\n# Simple search\nresults = lib.search(\"machine learning\", limit=50)\n\n# Advanced search\nresults = lib.search(\"title:Python rating:&gt;=4 format:pdf\", limit=50)\n\nfor book in results:\n    print(f\"{book.title} by {', '.join(a.name for a in book.authors)}\")\n\nlib.close()\n</code></pre>"},{"location":"user-guide/search/#search-limitations","title":"Search Limitations","text":"<p>HTML Export: The exported HTML files use client-side JavaScript filtering, not the advanced search parser. For advanced search features, use:</p> <ul> <li>CLI: <code>ebk search</code></li> <li>Web server: <code>ebk serve</code></li> <li>Python API: <code>Library.search()</code></li> </ul>"},{"location":"user-guide/search/#tips-and-best-practices","title":"Tips and Best Practices","text":"<ol> <li>Start broad, refine: Begin with simple queries, then add filters</li> <li>Use field searches: More precise than full-text when you know what field to search</li> <li>Combine filters: Multiple filters are ANDed together by default</li> <li>Quote phrases: Always quote multi-word phrases for exact matching</li> <li>Test queries: Use <code>--limit 5</code> when testing complex queries</li> </ol>"},{"location":"user-guide/search/#see-also","title":"See Also","text":"<ul> <li>CLI Reference - Full command documentation</li> <li>Server - Web server search API</li> </ul>"},{"location":"user-guide/server/","title":"Web Server","text":"<p>ebk includes a FastAPI-based web server that provides a modern web interface for browsing and managing your ebook library.</p>"},{"location":"user-guide/server/#quick-start","title":"Quick Start","text":""},{"location":"user-guide/server/#basic-usage","title":"Basic Usage","text":"<p>Start the server with default settings:</p> <pre><code>ebk serve ~/my-library\n</code></pre> <p>The server will start at <code>http://localhost:8000</code> (or the configured host/port).</p>"},{"location":"user-guide/server/#custom-host-and-port","title":"Custom Host and Port","text":"<pre><code># Listen on specific port\nebk serve ~/library --port 8080\n\n# Localhost only (more secure)\nebk serve ~/library --host 127.0.0.1 --port 8000\n\n# Listen on all interfaces (network access)\nebk serve ~/library --host 0.0.0.0 --port 8000\n</code></pre>"},{"location":"user-guide/server/#auto-open-browser","title":"Auto-Open Browser","text":"<pre><code># Open browser automatically\nebk serve ~/library --auto-open\n\n# Or configure as default\nebk config set server.auto_open_browser true\nebk serve ~/library\n</code></pre>"},{"location":"user-guide/server/#configuration","title":"Configuration","text":"<p>Configure server defaults in <code>~/.config/ebk/config.json</code>:</p> <pre><code># Set default port\nebk config set server.port 8080\n\n# Set default host\nebk config set server.host 0.0.0.0\n\n# Enable auto-open\nebk config set server.auto_open_browser true\n\n# Set page size\nebk config set server.page_size 50\n</code></pre> <p>View current configuration:</p> <pre><code>ebk config show --section server\n</code></pre>"},{"location":"user-guide/server/#web-interface-features","title":"Web Interface Features","text":""},{"location":"user-guide/server/#book-browsing","title":"Book Browsing","text":"<p>The web interface provides:</p> <ul> <li>Grid view with book covers</li> <li>List view with detailed information</li> <li>Pagination for large libraries</li> <li>Sorting by title, author, date, rating</li> <li>Filtering by author, language, format, rating, tags</li> </ul>"},{"location":"user-guide/server/#navigation","title":"Navigation","text":"<p>Use URL parameters for direct navigation:</p> <pre><code># Pagination\nhttp://localhost:8000/?page=2\n\n# Filtering\nhttp://localhost:8000/?author=Knuth\nhttp://localhost:8000/?language=en\nhttp://localhost:8000/?format=pdf\n\n# Sorting\nhttp://localhost:8000/?sort_by=title\nhttp://localhost:8000/?sort_by=date&amp;sort_order=desc\n\n# Combine filters\nhttp://localhost:8000/?author=Knuth&amp;language=en&amp;sort_by=title\n</code></pre>"},{"location":"user-guide/server/#search","title":"Search","text":"<p>Full-text search across title, author, and description:</p> <pre><code>http://localhost:8000/search?q=python+programming\n</code></pre>"},{"location":"user-guide/server/#book-details","title":"Book Details","text":"<p>Click on any book to view:</p> <ul> <li>Complete metadata</li> <li>All available formats</li> <li>Cover image</li> <li>Description</li> <li>Authors and subjects</li> <li>Reading status and rating</li> <li>Personal tags and notes</li> </ul>"},{"location":"user-guide/server/#file-access","title":"File Access","text":"<p>Click on format badges to:</p> <ul> <li>Open files directly in browser (PDF)</li> <li>Download files (EPUB, MOBI, etc.)</li> <li>View cover in full size</li> </ul>"},{"location":"user-guide/server/#rest-api","title":"REST API","text":"<p>The server provides a REST API for programmatic access.</p>"},{"location":"user-guide/server/#endpoints","title":"Endpoints","text":""},{"location":"user-guide/server/#list-books","title":"List Books","text":"<pre><code># Get all books (paginated)\ncurl http://localhost:8000/api/books\n\n# With filters\ncurl \"http://localhost:8000/api/books?author=Knuth&amp;language=en\"\n\n# With pagination\ncurl \"http://localhost:8000/api/books?page=2&amp;limit=50\"\n</code></pre> <p>Response:</p> <pre><code>{\n  \"books\": [\n    {\n      \"id\": 1,\n      \"title\": \"The Art of Computer Programming, Vol. 1\",\n      \"authors\": [\"Donald E. Knuth\"],\n      \"language\": \"en\",\n      \"publisher\": \"Addison-Wesley\",\n      \"publication_date\": \"1997-07-23\",\n      \"subjects\": [\"Computer Science\", \"Algorithms\"],\n      \"files\": [\n        {\"format\": \"pdf\", \"size\": 15728640, \"path\": \"...\"}\n      ],\n      \"rating\": 5.0,\n      \"favorite\": true,\n      \"reading_status\": \"read\",\n      \"tags\": [\"must-read\", \"reference\"]\n    }\n  ],\n  \"total\": 150,\n  \"page\": 1,\n  \"limit\": 50\n}\n</code></pre>"},{"location":"user-guide/server/#get-book-details","title":"Get Book Details","text":"<pre><code># Get specific book\ncurl http://localhost:8000/api/books/42\n</code></pre> <p>Response:</p> <pre><code>{\n  \"id\": 42,\n  \"title\": \"Introduction to Algorithms\",\n  \"subtitle\": \"Third Edition\",\n  \"authors\": [\"Cormen\", \"Leiserson\", \"Rivest\", \"Stein\"],\n  \"language\": \"en\",\n  \"publisher\": \"MIT Press\",\n  \"publication_date\": \"2009-07-31\",\n  \"series\": null,\n  \"series_index\": null,\n  \"description\": \"Comprehensive algorithms textbook...\",\n  \"subjects\": [\"Algorithms\", \"Computer Science\", \"Data Structures\"],\n  \"files\": [\n    {\"format\": \"pdf\", \"size\": 20971520, \"path\": \"files/ab/abc123.pdf\"},\n    {\"format\": \"epub\", \"size\": 10485760, \"path\": \"files/cd/cde456.epub\"}\n  ],\n  \"rating\": 5.0,\n  \"favorite\": true,\n  \"reading_status\": \"reading\",\n  \"tags\": [\"textbook\", \"algorithms\", \"must-read\"],\n  \"cover_path\": \"covers/ab/abc123.jpg\"\n}\n</code></pre>"},{"location":"user-guide/server/#search-books","title":"Search Books","text":"<pre><code># Full-text search\ncurl \"http://localhost:8000/api/search?q=machine+learning\"\n</code></pre>"},{"location":"user-guide/server/#update-book","title":"Update Book","text":"<pre><code># Update book metadata\ncurl -X PATCH http://localhost:8000/api/books/42 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"rating\": 5,\n    \"favorite\": true,\n    \"reading_status\": \"read\",\n    \"tags\": [\"must-read\", \"reference\"]\n  }'\n</code></pre>"},{"location":"user-guide/server/#upload-book","title":"Upload Book","text":"<pre><code># Import new book\ncurl -X POST http://localhost:8000/api/books \\\n  -F \"file=@book.pdf\" \\\n  -F \"title=My Book\" \\\n  -F \"authors=Author Name\"\n</code></pre>"},{"location":"user-guide/server/#get-statistics","title":"Get Statistics","text":"<pre><code># Library statistics\ncurl http://localhost:8000/api/stats\n</code></pre> <p>Response:</p> <pre><code>{\n  \"total_books\": 250,\n  \"total_authors\": 180,\n  \"total_subjects\": 45,\n  \"total_files\": 320,\n  \"total_size_mb\": 15360.5,\n  \"languages\": [\"en\", \"de\", \"fr\"],\n  \"formats\": [\"pdf\", \"epub\", \"mobi\"]\n}\n</code></pre>"},{"location":"user-guide/server/#api-authentication","title":"API Authentication","text":"<p>Currently the API is open (no authentication). For production use, consider:</p> <ol> <li>Reverse proxy with authentication (nginx, Apache)</li> <li>VPN for secure access</li> <li>Firewall rules to restrict access</li> </ol> <p>Future versions will support API keys and OAuth.</p>"},{"location":"user-guide/server/#network-access","title":"Network Access","text":""},{"location":"user-guide/server/#local-access-only","title":"Local Access Only","text":"<p>For security, bind to localhost:</p> <pre><code>ebk serve ~/library --host 127.0.0.1\n</code></pre> <p>Access from same machine only: <code>http://localhost:8000</code></p>"},{"location":"user-guide/server/#lan-access","title":"LAN Access","text":"<p>To access from other devices on your network:</p> <pre><code>ebk serve ~/library --host 0.0.0.0 --port 8000\n</code></pre> <p>Find your IP address:</p> <pre><code># Linux/Mac\nifconfig | grep inet\n\n# Windows\nipconfig\n</code></pre> <p>Access from other devices: <code>http://your-ip:8000</code></p>"},{"location":"user-guide/server/#public-access-not-recommended","title":"Public Access (Not Recommended)","text":"<p>For internet access, use a reverse proxy with authentication:</p> <pre><code># nginx configuration\nserver {\n    listen 80;\n    server_name books.example.com;\n\n    location / {\n        proxy_pass http://localhost:8000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n\n        # Basic authentication\n        auth_basic \"eBook Library\";\n        auth_basic_user_file /etc/nginx/.htpasswd;\n    }\n}\n</code></pre>"},{"location":"user-guide/server/#production-deployment","title":"Production Deployment","text":""},{"location":"user-guide/server/#using-systemd-linux","title":"Using systemd (Linux)","text":"<p>Create service file: <code>/etc/systemd/system/ebk-server.service</code></p> <pre><code>[Unit]\nDescription=ebk Web Server\nAfter=network.target\n\n[Service]\nType=simple\nUser=your-username\nWorkingDirectory=/home/your-username\nExecStart=/home/your-username/.local/bin/ebk serve /home/your-username/library --host 0.0.0.0 --port 8000\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Enable and start:</p> <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable ebk-server\nsudo systemctl start ebk-server\nsudo systemctl status ebk-server\n</code></pre>"},{"location":"user-guide/server/#using-docker","title":"Using Docker","text":"<p>Create <code>Dockerfile</code>:</p> <pre><code>FROM python:3.11-slim\n\nWORKDIR /app\n\n# Install ebk\nRUN pip install ebk\n\n# Expose port\nEXPOSE 8000\n\n# Mount library as volume\nVOLUME [\"/library\"]\n\n# Start server\nCMD [\"ebk\", \"serve\", \"/library\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]\n</code></pre> <p>Build and run:</p> <pre><code># Build image\ndocker build -t ebk-server .\n\n# Run container\ndocker run -d \\\n  -p 8000:8000 \\\n  -v ~/my-library:/library \\\n  --name ebk \\\n  ebk-server\n\n# View logs\ndocker logs -f ebk\n</code></pre>"},{"location":"user-guide/server/#using-docker-compose","title":"Using docker-compose","text":"<p>Create <code>docker-compose.yml</code>:</p> <pre><code>version: '3.8'\n\nservices:\n  ebk:\n    image: ebk-server\n    build: .\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - ~/my-library:/library:ro\n    restart: unless-stopped\n    environment:\n      - EBK_HOST=0.0.0.0\n      - EBK_PORT=8000\n</code></pre> <p>Start:</p> <pre><code>docker-compose up -d\n</code></pre>"},{"location":"user-guide/server/#security-considerations","title":"Security Considerations","text":""},{"location":"user-guide/server/#file-system-access","title":"File System Access","text":"<p>The web server requires:</p> <ul> <li>Read access to library files</li> <li>Write access for uploads and metadata updates</li> <li>Execute access for opening files</li> </ul> <p>Set appropriate permissions:</p> <pre><code># Set library ownership\nchown -R your-username:your-username ~/library\n\n# Set secure permissions\nchmod -R 755 ~/library/files\nchmod 644 ~/library/library.db\n</code></pre>"},{"location":"user-guide/server/#network-security","title":"Network Security","text":"<ol> <li> <p>Firewall: Only allow access from trusted networks    <pre><code># Allow from local network only\nsudo ufw allow from 192.168.1.0/24 to any port 8000\n</code></pre></p> </li> <li> <p>HTTPS: Use reverse proxy with SSL/TLS for production</p> </li> <li> <p>Authentication: Implement via reverse proxy or VPN</p> </li> </ol>"},{"location":"user-guide/server/#file-uploads","title":"File Uploads","text":"<p>If allowing uploads:</p> <ol> <li>Validate file types (only ebooks)</li> <li>Limit file size (prevent DoS)</li> <li>Scan for malware if accepting external files</li> <li>Use dedicated upload directory with restricted permissions</li> </ol>"},{"location":"user-guide/server/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/server/#port-already-in-use","title":"Port Already in Use","text":"<p>If port 8000 is already used:</p> <pre><code># Check what's using the port\nlsof -i :8000\n\n# Use different port\nebk serve ~/library --port 8080\n</code></pre>"},{"location":"user-guide/server/#permission-denied","title":"Permission Denied","text":"<p>If server can't read library:</p> <pre><code># Check permissions\nls -la ~/library\n\n# Fix permissions\nchmod -R 755 ~/library\n</code></pre>"},{"location":"user-guide/server/#cant-access-from-network","title":"Can't Access from Network","text":"<p>If other devices can't connect:</p> <ol> <li> <p>Check firewall:    <pre><code>sudo ufw status\nsudo ufw allow 8000\n</code></pre></p> </li> <li> <p>Verify host binding:    <pre><code># Must be 0.0.0.0 for network access\nebk serve ~/library --host 0.0.0.0\n</code></pre></p> </li> <li> <p>Check network:    <pre><code># Test from other device\nping your-ip\ntelnet your-ip 8000\n</code></pre></p> </li> </ol>"},{"location":"user-guide/server/#slow-performance","title":"Slow Performance","text":"<p>If web interface is slow:</p> <ol> <li> <p>Check database size:    <pre><code>du -h ~/library/library.db\n</code></pre></p> </li> <li> <p>Optimize database:    <pre><code>sqlite3 ~/library/library.db \"VACUUM;\"\n</code></pre></p> </li> <li> <p>Reduce page size:    <pre><code>ebk config set server.page_size 20\n</code></pre></p> </li> <li> <p>Generate thumbnails for faster loading:    <pre><code>ebk generate-thumbnails ~/library\n</code></pre></p> </li> </ol>"},{"location":"user-guide/server/#advanced-configuration","title":"Advanced Configuration","text":""},{"location":"user-guide/server/#custom-static-files","title":"Custom Static Files","text":"<p>Serve additional static files:</p> <pre><code>from fastapi.staticfiles import StaticFiles\nfrom ebk.server import app\n\n# Mount custom static directory\napp.mount(\"/static\", StaticFiles(directory=\"/path/to/static\"), name=\"static\")\n</code></pre>"},{"location":"user-guide/server/#custom-templates","title":"Custom Templates","text":"<p>Override default templates:</p> <pre><code>from fastapi.templating import Jinja2Templates\n\ntemplates = Jinja2Templates(directory=\"/path/to/templates\")\n</code></pre>"},{"location":"user-guide/server/#cors-configuration","title":"CORS Configuration","text":"<p>Enable CORS for API access from web apps:</p> <pre><code>from fastapi.middleware.cors import CORSMiddleware\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"http://localhost:3000\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n</code></pre>"},{"location":"user-guide/server/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration Guide - Configure server defaults</li> <li>CLI Reference - All server options</li> <li>Python API - Programmatic server control</li> <li>Python API Documentation - Complete API reference</li> </ul>"}]}