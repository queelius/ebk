<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - EBK Library</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            color: #333;
        }
        
        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Left Sidebar */
        .left-sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 20px;
            flex-shrink: 0;
        }
        .header h1 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        .stats {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* Search and Controls */
        .controls {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        .search-box {
            width: 100%;
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }
        .search-box:focus {
            outline: none;
            border-color: #3498db;
        }
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .filter-group label {
            font-size: 14px;
            color: #666;
        }
        .filter-select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .view-toggle {
            display: flex;
            gap: 10px;
        }
        .view-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        .view-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        /* Content Area */
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        /* Facet Sections in Sidebar */
        .facet-section {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        .facet-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .facet-title .count {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: normal;
        }
        .facet-content {
            max-height: 300px;
            overflow-y: auto;
        }
        .facet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 2px 0;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        .facet-item:hover {
            background: #e9ecef;
            transform: translateX(2px);
        }
        .facet-item.active {
            background: #3498db;
            color: white;
        }
        .facet-item .name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .facet-item .count {
            margin-left: 10px;
            font-size: 12px;
            opacity: 0.8;
        }
        .show-more {
            display: block;
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            text-align: center;
            transition: all 0.2s;
        }
        .show-more:hover {
            background: #e9ecef;
        }
        
        /* Book Grid View */
        .books-grid {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .books-grid.active {
            display: grid;
        }
        .book-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        .book-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        .book-cover {
            width: 100%;
            height: 280px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .book-formats {
            position: absolute;
            bottom: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }
        .format-badge {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            text-decoration: none;
        }
        .book-info {
            padding: 15px;
        }
        .book-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 15px;
            line-height: 1.4;
            height: 2.8em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .book-author {
            color: #7f8c8d;
            font-size: 13px;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* List View */
        .books-list {
            display: none;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .books-list.active {
            display: block;
        }
        .book-list-item {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            gap: 20px;
            transition: background 0.3s;
            cursor: pointer;
        }
        .book-list-item:hover {
            background: #f8f9fa;
        }
        
        /* Pagination */
        .pagination {
            margin: 40px 0;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .page-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        .page-btn:hover:not(:disabled) {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            max-width: 800px;
            border-radius: 8px;
            position: relative;
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            color: #999;
            cursor: pointer;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .left-sidebar {
                width: 240px;
            }
        }
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            .left-sidebar {
                width: 100%;
                height: auto;
                max-height: 40vh;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
        }
        
        /* Active filters display */
        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .filter-tag {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            background: #3498db;
            color: white;
            border-radius: 4px;
            font-size: 13px;
        }
        .filter-tag .remove {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        .filter-tag .remove:hover {
            opacity: 0.8;
        }
        
        /* Clear all filters button */
        .clear-filters {
            padding: 5px 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .clear-filters:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Left Sidebar with Facets -->
        <div class="left-sidebar">
            {% for facet_name, facet_data in facets.items() %}
            <div class="facet-section">
                <h3 class="facet-title" onclick="toggleFacet('{{ facet_name }}')">
                    {{ facet_data.display_name }}
                    <span class="count">({{ facet_data['items']|length }})</span>
                </h3>
                <div class="facet-content" id="facet-{{ facet_name }}">
                    {% set sorted_items = facet_data['items'].items()|sort(attribute='1', reverse=true) %}
                    {% for item, count in sorted_items[:20] %}
                    <div class="facet-item" onclick="toggleFacetItem('{{ facet_name }}', '{{ item|e }}')">
                        <span class="name" title="{{ item }}">{{ item }}</span>
                        <span class="count">{{ count }}</span>
                    </div>
                    {% endfor %}
                    {% if facet_data['items']|length > 20 %}
                    <button class="show-more" onclick="showAllFacetItems('{{ facet_name }}')">
                        Show all {{ facet_data['items']|length }}
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <div class="header">
                <h1>{{ title }}</h1>
                <div class="stats">
                    <span id="bookCount">{{ entries|length }}</span> books
                    <span id="filteredCount" style="display: none;">• Showing <span></span></span>
                </div>
            </div>
            
            <div class="controls">
                <div class="active-filters" id="activeFilters" style="display: none;">
                    <button class="clear-filters" onclick="clearAllFilters()">Clear all filters</button>
                </div>
                
                <input type="text" class="search-box" placeholder="Search books by title, author, subject..." id="searchBox">
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Language:</label>
                        <select class="filter-select" id="langFilter">
                            <option value="">All Languages</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Year:</label>
                        <select class="filter-select" id="yearFilter">
                            <option value="">All Years</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Format:</label>
                        <select class="filter-select" id="formatFilter">
                            <option value="">All Formats</option>
                        </select>
                    </div>
                </div>
                
                <div class="view-toggle">
                    <button class="view-btn active" onclick="setView('grid')">Grid View</button>
                    <button class="view-btn" onclick="setView('list')">List View</button>
                </div>
            </div>
            
            <div class="content-wrapper">
                <div id="booksContainer">
                    <div class="books-grid active" id="gridView"></div>
                    <div class="books-list" id="listView"></div>
                    <div class="no-results" id="noResults" style="display: none;">
                        <h3>No books found</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                </div>
                
                <!-- Pagination -->
                <div class="pagination" id="pagination" style="display: none;">
                    <button class="page-btn" onclick="goToPage(1)" id="firstPage">« First</button>
                    <button class="page-btn" onclick="previousPage()" id="prevPage">‹ Previous</button>
                    <span class="page-info">
                        Page <span id="currentPageNum">1</span> of <span id="totalPageNum">1</span>
                    </span>
                    <button class="page-btn" onclick="nextPage()" id="nextPage">Next ›</button>
                    <button class="page-btn" onclick="goToPage(totalPages)" id="lastPage">Last »</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for book details -->
    <div class="modal" id="bookModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>
    
    <script>
        // Book data
        const allBooks = {{ entries_json|safe }};  // Pre-sanitized by backend
        let filteredBooks = [...allBooks];
        let currentView = 'grid';
        
        // Pagination settings
        const BOOKS_PER_PAGE = 50;
        let currentPage = 1;
        let totalPages = 1;
        
        // Active facet filters
        const activeFacets = {};
        
        // Path to _books directory
        const isSubdir = {{ is_subdir|lower }};
        function getBooksPath() {
            return isSubdir ? '../_books/' : '_books/';
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeFilters();
            renderBooks();
        });
        
        function initializeFilters() {
            // Extract unique values for filters
            const languages = new Set();
            const years = new Set();
            const formats = new Set();
            
            allBooks.forEach(book => {
                if (book.language) languages.add(book.language);
                if (book.date) {
                    const year = new Date(book.date).getFullYear();
                    if (!isNaN(year)) years.add(year);
                }
                if (book.file_paths) {
                    book.file_paths.forEach(path => {
                        const ext = path.split('.').pop().toUpperCase();
                        formats.add(ext);
                    });
                }
            });
            
            // Populate filters
            populateSelect('langFilter', Array.from(languages).sort());
            populateSelect('yearFilter', Array.from(years).sort((a, b) => b - a));
            populateSelect('formatFilter', Array.from(formats).sort());
        }
        
        function populateSelect(id, options) {
            const select = document.getElementById(id);
            options.forEach(option => {
                const optEl = document.createElement('option');
                optEl.value = option;
                optEl.textContent = option;
                select.appendChild(optEl);
            });
        }
        
        function toggleFacet(facetName) {
            const content = document.getElementById(`facet-${facetName}`);
            content.style.display = content.style.display === 'none' ? 'block' : 'none';
        }
        
        function toggleFacetItem(facetName, itemValue) {
            if (!activeFacets[facetName]) {
                activeFacets[facetName] = new Set();
            }
            
            if (activeFacets[facetName].has(itemValue)) {
                activeFacets[facetName].delete(itemValue);
                if (activeFacets[facetName].size === 0) {
                    delete activeFacets[facetName];
                }
            } else {
                activeFacets[facetName].add(itemValue);
            }
            
            updateFacetUI();
            filterBooks();
        }
        
        function updateFacetUI() {
            // Update facet items visual state
            document.querySelectorAll('.facet-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Update active filters display
            const activeFiltersDiv = document.getElementById('activeFilters');
            const hasActiveFilters = Object.keys(activeFacets).length > 0;
            
            if (hasActiveFilters) {
                activeFiltersDiv.style.display = 'flex';
                let html = '<button class="clear-filters" onclick="clearAllFilters()">Clear all filters</button>';
                
                for (const [facetName, items] of Object.entries(activeFacets)) {
                    items.forEach(item => {
                        html += `<div class="filter-tag">
                            ${facetName}: ${item}
                            <span class="remove" onclick="toggleFacetItem('${facetName}', '${item}')">&times;</span>
                        </div>`;
                    });
                }
                
                activeFiltersDiv.innerHTML = html;
            } else {
                activeFiltersDiv.style.display = 'none';
            }
        }
        
        function clearAllFilters() {
            for (const facetName in activeFacets) {
                delete activeFacets[facetName];
            }
            updateFacetUI();
            filterBooks();
        }
        
        function filterBooks() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const langFilter = document.getElementById('langFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;
            const formatFilter = document.getElementById('formatFilter').value;
            
            filteredBooks = allBooks.filter(book => {
                // Facet filters
                for (const [facetName, activeItems] of Object.entries(activeFacets)) {
                    const bookValues = book[facetName] || [];
                    const bookValueArray = Array.isArray(bookValues) ? bookValues : [bookValues];
                    
                    const hasMatch = bookValueArray.some(value => activeItems.has(value));
                    if (!hasMatch) return false;
                }
                
                // Search filter
                if (searchTerm) {
                    const searchIn = [
                        book.title || '',
                        ...(book.creators || []),
                        ...(book.subjects || []),
                        book.description || ''
                    ].join(' ').toLowerCase();
                    
                    if (!searchIn.includes(searchTerm)) return false;
                }
                
                // Other filters
                if (langFilter && book.language !== langFilter) return false;
                
                if (yearFilter && book.date) {
                    const bookYear = new Date(book.date).getFullYear();
                    if (bookYear != yearFilter) return false;
                }
                
                if (formatFilter && book.file_paths) {
                    const hasFormat = book.file_paths.some(path => 
                        path.toUpperCase().endsWith('.' + formatFilter)
                    );
                    if (!hasFormat) return false;
                }
                
                return true;
            });
            
            currentPage = 1;
            renderBooks();
            updateStats();
        }
        
        // Add event listeners
        document.getElementById('searchBox').addEventListener('input', filterBooks);
        document.getElementById('langFilter').addEventListener('change', filterBooks);
        document.getElementById('yearFilter').addEventListener('change', filterBooks);
        document.getElementById('formatFilter').addEventListener('change', filterBooks);
        
        function updateStats() {
            const filteredSpan = document.getElementById('filteredCount');
            if (filteredBooks.length < allBooks.length) {
                filteredSpan.style.display = 'inline';
                const startIndex = (currentPage - 1) * BOOKS_PER_PAGE + 1;
                const endIndex = Math.min(currentPage * BOOKS_PER_PAGE, filteredBooks.length);
                if (totalPages > 1) {
                    filteredSpan.querySelector('span').textContent = 
                        `${startIndex}-${endIndex} of ${filteredBooks.length}`;
                } else {
                    filteredSpan.querySelector('span').textContent = filteredBooks.length;
                }
            } else if (totalPages > 1) {
                filteredSpan.style.display = 'inline';
                const startIndex = (currentPage - 1) * BOOKS_PER_PAGE + 1;
                const endIndex = Math.min(currentPage * BOOKS_PER_PAGE, allBooks.length);
                filteredSpan.querySelector('span').textContent = 
                    `${startIndex}-${endIndex} of ${allBooks.length}`;
            } else {
                filteredSpan.style.display = 'none';
            }
        }
        
        function setView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(view));
            });
            document.getElementById('gridView').classList.toggle('active', view === 'grid');
            document.getElementById('listView').classList.toggle('active', view === 'list');
            renderBooks();
        }
        
        function renderBooks() {
            const noResults = document.getElementById('noResults');
            const pagination = document.getElementById('pagination');
            
            if (filteredBooks.length === 0) {
                document.getElementById('gridView').innerHTML = '';
                document.getElementById('listView').innerHTML = '';
                noResults.style.display = 'block';
                pagination.style.display = 'none';
                return;
            }
            
            noResults.style.display = 'none';
            
            // Calculate pagination
            totalPages = Math.ceil(filteredBooks.length / BOOKS_PER_PAGE);
            if (currentPage > totalPages) currentPage = totalPages;
            if (currentPage < 1) currentPage = 1;
            
            // Get books for current page
            const startIndex = (currentPage - 1) * BOOKS_PER_PAGE;
            const endIndex = startIndex + BOOKS_PER_PAGE;
            const booksToShow = filteredBooks.slice(startIndex, endIndex);
            
            // Show/hide pagination
            if (totalPages > 1) {
                pagination.style.display = 'flex';
                updatePaginationControls();
            } else {
                pagination.style.display = 'none';
            }
            
            if (currentView === 'grid') {
                renderGridView(booksToShow);
            } else {
                renderListView(booksToShow);
            }
        }
        
        function renderGridView(booksToShow) {
            const grid = document.getElementById('gridView');
            grid.innerHTML = booksToShow.map(book => {
                const coverPath = book.cover_path || '';
                const entryId = book._entry_id || book.unique_id;
                const booksPath = getBooksPath();
                const coverSrc = coverPath && entryId ? `${booksPath}${entryId}/${coverPath.split('/').pop()}` : '';
                const fileFormats = (book.file_paths || []).map(path => 
                    path.split('.').pop().toUpperCase()
                );
                
                return `
                    <div class="book-card" onclick="showBookDetails(${JSON.stringify(book).replace(/"/g, '&quot;')})">
                        <div class="book-cover">
                            ${coverSrc ? 
                                `<img src="${coverSrc}" alt="${book.title} cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<div>No Cover</div>'">` :
                                '<div>No Cover</div>'
                            }
                            <div class="book-formats">
                                ${fileFormats.map(fmt => `<span class="format-badge">${fmt}</span>`).join('')}
                            </div>
                        </div>
                        <div class="book-info">
                            <div class="book-title" title="${book.title || 'Unknown Title'}">${book.title || 'Unknown Title'}</div>
                            <div class="book-author" title="${(book.creators || []).join(', ')}">by ${(book.creators || ['Unknown']).join(', ')}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderListView(booksToShow) {
            const list = document.getElementById('listView');
            list.innerHTML = booksToShow.map(book => {
                const coverPath = book.cover_path || '';
                const entryId = book._entry_id || book.unique_id;
                const booksPath = getBooksPath();
                const coverSrc = coverPath && entryId ? `${booksPath}${entryId}/${coverPath.split('/').pop()}` : '';
                const description = book.description ? 
                    book.description.replace(/<[^>]*>/g, '').substring(0, 200) + '...' : '';
                
                return `
                    <div class="book-list-item" onclick="showBookDetails(${JSON.stringify(book).replace(/"/g, '&quot;')})">
                        <div class="book-list-cover">
                            ${coverSrc ? 
                                `<img src="${coverSrc}" alt="${book.title} cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<div>No<br>Cover</div>'">` :
                                '<div>No<br>Cover</div>'
                            }
                        </div>
                        <div class="book-list-info">
                            <div class="book-list-title">${book.title || 'Unknown Title'}</div>
                            <div class="book-list-author">by ${(book.creators || ['Unknown']).join(', ')}</div>
                            ${description ? `<div class="book-list-description">${description}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function showBookDetails(book) {
            const modal = document.getElementById('bookModal');
            const content = document.getElementById('modalContent');
            
            const coverPath = book.cover_path || '';
            const entryId = book._entry_id || book.unique_id;
            const booksPath = getBooksPath();
            const coverSrc = coverPath && entryId ? `${booksPath}${entryId}/${coverPath.split('/').pop()}` : '';
            
            // Get primary PDF and other files
            const files = book.file_paths || [];
            const pdfFile = files.find(f => f.toLowerCase().endsWith('.pdf'));
            const primaryFile = pdfFile || files[0];
            
            content.innerHTML = `
                <div class="modal-header">
                    <div class="modal-cover">
                        ${coverSrc ? 
                            `<img src="${coverSrc}" alt="${book.title} cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<div>No Cover</div>'">` :
                            '<div>No Cover</div>'
                        }
                    </div>
                    <div class="modal-info">
                        <h2>${book.title || 'Unknown Title'}</h2>
                        <div class="author">by ${(book.creators || ['Unknown']).join(', ')}</div>
                        
                        <div class="modal-section">
                            <h3>Download</h3>
                            <div class="download-links">
                                ${primaryFile ? `<a href="${booksPath}${entryId}/${primaryFile.split('/').pop()}" class="download-btn">📖 Open Primary (${primaryFile.split('.').pop().toUpperCase()})</a>` : ''}
                                ${files.filter(f => f !== primaryFile).map(file => 
                                    `<a href="${booksPath}${entryId}/${file.split('/').pop()}" class="download-btn">${file.split('.').pop().toUpperCase()}</a>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                ${book.description ? `
                    <div class="modal-section">
                        <h3>Description</h3>
                        <div class="description">${book.description}</div>
                    </div>
                ` : ''}
                
                <div class="modal-section">
                    <h3>Details</h3>
                    <p>
                        ${book.date ? `<strong>Published:</strong> ${new Date(book.date).toLocaleDateString()}<br>` : ''}
                        ${book.language ? `<strong>Language:</strong> ${book.language}<br>` : ''}
                        ${book.subjects && book.subjects.length > 0 ? `<strong>Subjects:</strong> ${book.subjects.join(', ')}<br>` : ''}
                    </p>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('bookModal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('bookModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // Pagination functions
        function updatePaginationControls() {
            document.getElementById('currentPageNum').textContent = currentPage;
            document.getElementById('totalPageNum').textContent = totalPages;
            
            document.getElementById('firstPage').disabled = currentPage === 1;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
            document.getElementById('lastPage').disabled = currentPage === totalPages;
        }
        
        function goToPage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderBooks();
                document.querySelector('.content-wrapper').scrollTo(0, 0);
            }
        }
        
        function previousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }
        
        function nextPage() {
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        }
        
        function showAllFacetItems(facetName) {
            // This would show all items in a modal or expand the facet
            alert(`Show all items for ${facetName} - to be implemented`);
        }
    </script>
</body>
</html>